<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Myna Experiment Experimenter</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://cdn.mynaweb.com/clients/myna-1.latest.min.js"></script>


    <link href="bootstrap.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/js/google-code-prettify/prettify.css" rel="stylesheet">
    <link href="demo.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>
  <body>
    <div class="container">

      <header class="embiggen">
        <h1>The Myna Experiment Experimenter</h1>
      </header>

      <section>
        <h2>Enter Your Experiment</h2>
        <form class="well form-inline">
          <label>Experiment UUID</label>
          <input id="uuid" type="text" class="input-xlarge" value="45923780-80ed-47c6-aa46-15e2ae7a0e8c">
          <button id="suggest" type="submit" class="btn btn-primary">Get a suggestion</button>
        </form>
      </section>

      <section>
        <h2>Suggestions</h2>
        <p>Click on the <em>button</em> to reward a suggestion and stay right here. Click on the <em>link</em> to test the <code>rewardOnClick</code> method on <code>Suggestion</code> and go to a different page.</p>
        <ul id="suggestions">
        </ul>
      </section>

    </div>

    <script type="text/javascript">
      var counter = 0;

      function problemToString(problem) {
        return JSON.stringify(problem)
      }

      function doSuggestion(uuid) {
        var experiment = new Myna.Experiment(uuid);

        experiment.suggest(
          function(suggestion) {
            var name = 'suggest-'+counter;
            var selector = '#'+name;
            counter++;
            $('#suggestions').prepend('<li id='+name+'><span class="suggestion">' + suggestion.choice + '</span> <span class="token">' + suggestion.token + '</span><a href="fail.html">Reward this</a> <button class="btn btn-mini btn-success">Reward this</button></li>');

            $(selector+' a').each(function(idx, elt) {
              suggestion.rewardOnClick(elt, "success.html");
            });

            $(selector + ' button').click(function(evt) { suggestion.reward(
                1.0,

                function(ok) {
                  $(selector).replaceWith('<li class="success">Successfully rewarded</li>')
                },

                function(problem) {
                  $(selector).replaceWith('<li class="problem">Problem rewarding. '+problemToString(problem)+'</li>');
                }
              );
            });
          },

          function(problem) {
            $('#suggestions').prepend('<li class="problem">Problem obtaining a suggestion '+problemToString(problem)+'</li>');
          });
      }

      $(function() {
        $('#suggest').click(function(evt) {
          evt.preventDefault();

          var uuid = $('#uuid').val();
          if(uuid.length == 0) {
            alert("You need to enter a UUID before we can get a suggestion from Myna.");
          } else {
            doSuggestion(uuid);
          }
        });
      })
    </script>
  </body>
</html>
