<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Myna Div Switching Demo</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://cdn.mynaweb.com/clients/myna-1.latest.min.js"></script>
    <script type="text/javascript" src="../javascripts/spin.min.js"></script>

    <link href="bootstrap.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/js/google-code-prettify/prettify.css" rel="stylesheet">
    <link href="demo.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>
  <body>
    <div class="container">

      <header class="embiggen">
        <h1>The Myna Div Switching Demo</h1>
      </header>

      <section>
        <p>This demo shows how to use Myna to choose a piece of content to display. While we're waiting for a suggestion from Myna we show a spinner. Note that we delay calling Myna to give you time to see the spinner. Normally Myna is fast enough that you won't notice it loading!</p>
      </section>

      <section>
        <div id="wrapper" style="width: 100%; height: 517px; margin: 5px;">
        </div>
        <p><strong>Status: </strong><span id="status"></span></p>
        <button id="button" class="btn btn-primary">Yes, this is the content I wanted!</button>
        <div id="variant1" style="display: none;">
          <img src="http://www.untyped.com/styles/images/untyped-background.jpg">
        </div>
        <div id="variant2" style="display: none;">
          <img src="http://www.untyped.com/styles/images/untyping-background.jpg">
        </div>
      </section>

      <script type="text/javascript">
        var wrapper = $("#wrapper")
        var button = $("#button");
        var status = $("#status");

        // Create a spinner while we wait for Myna
        function doSpinner() {
          var opts = {
            lines: 12,
            length: 10,
            width: 4,
            radius: 8
          };

          new Spinner(opts).spin(wrapper.get(0));
        };

        function doSwitch() {
          var experiment = new Myna.Experiment("45923780-80ed-47c6-aa46-15e2ae7a0e8c");

          experiment.suggest(
            // If we're successful display the variant and enable the reward button
            function(suggestion) {
              var variant = $("#" + suggestion.choice);
              status.text("Choice is "+suggestion.choice);

              wrapper.html(variant.html());
              button.on("click", function() {
               suggestion.reward();
               status.text("Reward sent");
               button.off("click");
              });
            },

            // On error display a default
            function(error) {
               status.text("Error getting suggestion. Displaying default.");
               wrapper.html($("#variant1").html());
            }
          );
        }

        // Do everything when the document is ready.
        $(function () {
          doSpinner();
          status.text("Loading...");
          // Delay the call by 2s to give the spinner a chance to rotate.
          window.setTimeout(doSwitch, 2000) });
      </script>
  </body>
</html>
