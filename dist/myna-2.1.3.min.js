(function(){var t,n,e,r=[].slice;null==(t=window.Myna)&&(window.Myna={}),null==(n=Myna.debug)&&(Myna.debug=!1),Myna.log=function(){var t,n;t=arguments.length>=1?r.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.log(t)},Myna.error=function(){var t,n;throw t=arguments.length>=1?r.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.error(t),t},Myna.trim=function(t){return null===t?"":t.replace(/^\s+|\s+$/g,"")},Myna.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Myna.isObject=function(t){return t===Object(t)},Myna.extend=function(){var t,n,e,i,a,o,s;for(t=arguments[0],e=arguments.length>=2?r.call(arguments,1):[],o=0,s=e.length;s>o;o++){i=e[o];for(n in i)a=i[n],t[n]=a}return t},Myna.deleteKeys=function(){var t,n,e,i,a,o;for(i=arguments[0],e=arguments.length>=2?r.call(arguments,1):[],t=Myna.extend({},i),a=0,o=e.length;o>a;a++)n=e[a],delete t[n];return t},Myna.dateToString=function(t){var n,e,r,i,a,o,s,u;return Date.prototype.toISOString?t.toISOString():(o=function(t,n){var e;for(e=""+t;n>e.length;)e="0"+e;return e},u=o(t.getUTCFullYear(),4),a=o(t.getUTCMonth()+1,2),n=o(t.getUTCDate(),2),e=o(t.getUTCHours(),2),i=o(t.getUTCMinutes(),2),s=o(t.getUTCSeconds(),2),r=o(t.getUTCMilliseconds(),2),""+u+"-"+a+"-"+n+"T"+e+":"+i+":"+s+"."+r+"Z")},Myna.problem=function(t){return t},Myna.redirect=function(t){return window.location.replace(t)},Myna.$=null!=(e=window.jQuery)?e:null}).call(this),function(){Myna.parseHashParams=function(t){var n,e,r,i,a,o,s,u;for(null==t&&(t=window.location.hash),t=t?"#"===t[0]?t.substring(1):t:"",n={},s=t.split("&"),a=0,o=s.length;o>a;a++)r=s[a],""!==r&&(u=r.split("="),e=u[0],i=u[1],n[decodeURIComponent(e)]=decodeURIComponent(null!=i?i:e));return Myna.log("parseHashParams",n),n},Myna.hashParams=Myna.parseHashParams(),Myna.hashParams.debug&&(Myna.debug=!0),Myna.preview=function(){return Myna.hashParams.preview?(Myna.cache.save("myna-preview",!0),!0):!!Myna.cache.load("myna-preview")},Myna.setPreview=function(t){Myna.cache.save("myna-preview",!!t)}}.call(this),function(){Myna.jsonp={callbacks:{},counter:0,createScriptElem:function(t,n){var e;return e=document.createElement("script"),e.setAttribute("type","text/javascript"),e.setAttribute("async","true"),e.setAttribute("src",t),e.setAttribute("class","myna-jsonp"),e.setAttribute("data-callback",n),e.onload=e.onreadystatechange=function(){return Myna.jsonp.remove(n,e)},e},request:function(t){var n,e,r,i,a,o,s,u,l,c,h,y,d,p,g,f,v,w,M;null==t&&(t={}),d=null!=(g=t.url)?g:Myna.error("Myna.jsonp.request","no url in options",t),l=null!=(f=t.success)?f:function(){},e=null!=(v=t.error)?v:function(){},c=null!=(w=t.timeout)?w:1e4,o=null!=(M=t.params)?M:{},n="callback"+Myna.jsonp.counter++,s=!1,y=""+d+"?";for(r in o)p=o[r],y+=""+r+"="+p+"&";y+="callback=Myna.jsonp.callbacks."+n,Myna.log("Myna.jsonp.request",y,l,e,c),u=Myna.jsonp.createScriptElem(y,n),a=function(){return s?Myna.log("Myna.jsonp.request.onTimeout",n,c,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onTimeout",n,c),Myna.jsonp.remove(n,u),e({typename:"problem",status:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:n}]}))},h=c>0?window.setTimeout(a,c):null,i=function(t){return s?Myna.log("Myna.jsonp.request.onComplete",n,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onComplete",n,t.typename,"problem"===t.typename,t),window.clearTimeout(h),Myna.jsonp.remove(n,u),"problem"===t.typename?e(t):l(t))},Myna.jsonp.callbacks[n]=i,document.getElementsByTagName("head")[0].appendChild(u)},remove:function(t,n){var e;if(null==t&&(t=null),null==n&&(n=null),e=null!=n?n.readyState:void 0,!e||"complete"===e||"loaded"===e)try{n&&(n.onload=null,n.parentNode.removeChild(n))}finally{t&&delete Myna.jsonp.callbacks[t]}}}}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n=[].slice;Myna.Events=function(){function e(){this.off=t(this.off,this),this.on=t(this.on,this),this.triggerAsync=t(this.triggerAsync,this),this.trigger=t(this.trigger,this),this.eventHandlers={}}return e.prototype.trigger=function(){var t,e,r,i,a,o,s,u;for(r=arguments[0],t=arguments.length>=2?n.call(arguments,1):[],Myna.log.apply(Myna,["Myna.Events.trigger",r].concat(n.call(t))),e=!1,u=null!=(s=this.eventHandlers[r])?s:[],a=0,o=u.length;o>a;a++)i=u[a],e=e||i.apply(this,t)===!1;return e?!1:void 0},e.prototype.triggerAsync=function(){var t,e,r,i,a,o,s,u=this;return r=arguments[0],t=arguments.length>=4?n.call(arguments,1,o=arguments.length-2):(o=1,[]),i=arguments[o++],e=arguments[o++],Myna.log.apply(Myna,["Myna.Events.triggerAsync",r].concat(n.call(t))),a=function(r){var o,s;return Myna.log("Myna.Events.triggerAsync.triggerAll",r),0===r.length?i():(o=r[0],s=r.length>=2?n.call(r,1):[],o.call.apply(o,[u].concat(n.call(t),[function(){return a(s)}],[e])))},a(null!=(s=this.eventHandlers[r])?s:[])},e.prototype.on=function(t,n){var e;return this.eventHandlers[t]=(null!=(e=this.eventHandlers[t])?e:[]).concat([n]),Myna.log("Myna.Events.on",t,n,this.eventHandlers[t])},e.prototype.off=function(t,n){var e;switch(null==n&&(n=null),arguments.length){case 0:this.eventHandlers={};break;case 1:delete this.eventHandlers[arguments[0]];break;default:t=arguments[0],n=arguments[1],this.eventHandlers[t]=function(){var r,i,a,o;for(a=this.eventHandlers[t],o=[],r=0,i=a.length;i>r;r++)e=a[r],e!==n&&o.push(e);return o}.call(this)}return Myna.log("Myna.Events.off",t,n,this.eventHandlers[t])},e}()}.call(this),function(){"use strict";var t,n=function(t,n){return function(){return t.apply(n,arguments)}},e=[].slice,r={}.hasOwnProperty,i=function(t,n){function e(){this.constructor=t}for(var i in n)r.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};t=function(){function t(e){this.toString=n(this.toString,this),this.drop=n(this.drop,this),this.take=n(this.take,this),this.isPrefixOf=n(this.isPrefixOf,this),this.prefixes=n(this.prefixes,this),this.unset=n(this.unset,this),this.set=n(this.set,this),this.get=n(this.get,this),this.path=n(this.path,this),this.quote=n(this.quote,this),this.nodes="string"==typeof e?t.parse(e):e}return t.identifierRegex=/^[a-z_$][a-z0-9_$]*/i,t.integerRegex=/^[0-9]+/,t.completeIdentifierRegex=/^[a-z_$][a-z0-9_$]*$/i,t.permissiveIdentifierRegex=/^[^[.]+/,t.isValid=function(n){var e;try{return t.parse(n),!0}catch(r){return e=r,!1}},t.normalize=function(n){var e;try{return""+new t(n)}catch(r){return e=r,n}},t.parse=function(n){var e,r,i,a,o,s,u,l,c;return a=n,o=function(t){if(t>a.length)throw"bad settings path: "+n;a=a.substring(t)},u=function(t){var e;if(t>a.length)throw"bad settings path: "+n;return e=a.substring(0,t),a=a.substring(t),e},l=function(t){return a=a.substring(t.length),t},e=function(){var e;if(e=a.match(t.permissiveIdentifierRegex))return l(e[0]);throw"bad settings path: "+n},i=function(){var e;if(e=a.match(t.integerRegex))return parseInt(l(e[0]));throw"bad settings path: "+n},s=function(t){var n,e;for(o(1),n="",e=!1;!e;)a[0]===t?e=!0:"\\"===a[0]?(o(1),n+=u(1)):n+=u(1);return o(1),n},r=function(){var t;return o(1),t="'"===a[0]?s("'"):'"'===a[0]?s('"'):i(),o(1),t},c=function(){var t;for(t=[];a.length>0;)"."===a[0]?(o(1),t.push(e())):"["===a[0]?t.push(r()):t.push(e());return t},a=Myna.trim(a),""===a?[]:"."===a[0]||"["===a[0]?c():(a="."+a,c())},t.prototype.quote=function(t){return t.replace(/['\"\\]/g,function(t){return"\\"+t})},t.prototype.path=function(n){var e,r,i,a;for(null==n&&(n=this.nodes),e="",i=0,a=n.length;a>i;i++)r=n[i],e+="number"==typeof r?"["+r+"]":t.completeIdentifierRegex.test(r)?"."+r:'["'+this.quote(r)+'"]';return"."===e[0]?e.substring(1):e},t.prototype.get=function(t){var n,e,r,i;for(i=this.nodes,e=0,r=i.length;r>e;e++)n=i[e],t=null!=t?t[n]:void 0;return t},t.prototype.set=function(t,n){var r,i,a,o,s,u,l,c;if(null!=n){if(0===this.nodes.length)return n;for(o=t,c=this.nodes,r=c.length>=2?e.call(c,0,s=c.length-1):(s=0,[]),i=c[s++],u=0,l=r.length;l>u;u++)a=r[u],"object"!=typeof o[a]&&(o[a]={}),o=o[a];return o[i]=n,t}return this.unset(t)},t.prototype.unset=function(t){var n,r,i,a,o,s,u,l;if(0===this.nodes.length)return void 0;for(a=t,l=this.nodes,n=l.length>=2?e.call(l,0,o=l.length-1):(o=0,[]),r=l[o++],s=0,u=n.length;u>s;s++){if(i=n[s],null==a[i])return t;a=a[i]}return delete a[r],t},t.prototype.prefixes=function(){var t,n,e,r,i;for(e=this.nodes,t=[],n=r=1,i=e.length;i>=1?i>=r:r>=i;n=i>=1?++r:--r)t.push(this.path(e.slice(0,n)));return t},t.prototype.isPrefixOf=function(t){var n,e,r,i,a;if(n=this.nodes,e=t.nodes,n.length>e.length)return!1;for(r=i=0,a=n.length;a>=0?a>i:i>a;r=a>=0?++i:--i)if(n[r]!==e[r])return!1;return!0},t.prototype.take=function(n){return new t(_.take(this.nodes,n))},t.prototype.drop=function(n){return new t(_.drop(this.nodes,n))},t.prototype.toString=function(){return this.path()},t}.call(this),Myna.Settings=function(e){function r(t){null==t&&(t={}),this.toJSON=n(this.toJSON,this),this.triggerChange=n(this.triggerChange,this),this.paths=n(this.paths,this),this.pathValuePairs=n(this.pathValuePairs,this),this.unset=n(this.unset,this),this.set=n(this.set,this),this.get=n(this.get,this),r.__super__.constructor.call(this),this.data={},this.set(t)}return i(r,e),r.Path=t,r.defaultSetOptions={silent:!1},r.prototype.get=function(t,n){var e;return null==n&&(n=void 0),null!=(e=new Myna.Settings.Path(t).get(this.data))?e:n},r.prototype.set=function(){var t,n,e,r,i,a,o;if(0===arguments.length)throw["Myna.Settings.set","not enough arguments",arguments];if("object"==typeof arguments[0]){i=arguments[0],t=Myna.extend({},Myna.Settings.defaultSetOptions,null!=(o=arguments[1])?o:{}),r=[];for(e in i)a=i[e],n=new Myna.Settings.Path(e),this.data=n.set(this.data,a),r.push(n);t.silent||this.triggerChange(r)}else i={},i[arguments[0]]=arguments[1],t=arguments[2],this.set(i,t);return this},r.prototype.unset=function(t,n){var e;return e={},e[t]=void 0,this.set(e,n)},r.prototype.pathValuePairs=function(){var t,n,e;return t=[],n=function(t){return"."===t[0]?t.substring(1):t},e=function(r,i){var a,o,s,u,l,c,h;if(null==i&&(i=""),Myna.isArray(r)){for(c=[],s=u=0,l=r.length;l>u;s=++u)a=r[s],c.push(e(s,i+"["+a+"]"));return c}if(Myna.isObject(r)){h=[];for(o in r)s=r[o],h.push(e(s,i+"."+o));return h}return t.push({path:n(i),value:r})},e(this.data),t},r.prototype.paths=function(){return _.map(this.pathValuePairs(),function(t){return t.path})},r.prototype.triggerChange=function(t){var n,e,r,i,a,o,s;for(r=0,a=t.length;a>r;r++)for(n=t[r],s=n.prefixes(),i=0,o=s.length;o>i;i++)e=s[i],this.trigger("change:"+e,this.get(e));return this.trigger("change")},r.prototype.toJSON=function(t){return null==t&&(t={}),this.data},r}(Myna.Events)}.call(this),function(){var t,n,e,r,i,a,o,s,u,l;null==(l=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return e=t,!1}}(),Myna.cache.localStorageEnabled=!0,i=function(t){var n;if(n=window.localStorage.getItem("myna-"+t),null==n)return null;try{return JSON.parse(n)}catch(r){return e=r,null}},u=function(t,n){null!=n?window.localStorage.setItem("myna-"+t,JSON.stringify(n)):window.localStorage.removeItem("myna-"+t)},o=function(t){window.localStorage.removeItem("myna-"+t)},n=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return t=0===t.indexOf('"')?t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):t,JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},s=function(t,e,r){var i,a,o,s;null==r&&(r=365),s="myna-"+t+"="+n(e),a=r?(i=new Date,i.setTime(i.getTime()+1e3*60*60*24*r),"; expires="+i.toGMTString()):"",o="; path=/",document.cookie=""+s+a+o},r=function(n){var e,r,i,a,o,s,u,l;for(o="myna-"+n+"=",a=function(t){var n;return n=t.indexOf(o),n>=0&&t.substring(0,n).match("^\\s*$")},r=function(t){var n;return n=t.indexOf(o),t.substring(n+o.length,t.length)},i=document.cookie.split(";"),u=0,l=i.length;l>u;u++)if(e=i[u],a(e)&&null!=(s=r(e)))return t(s);return null},a=function(t){s(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?i(t):r(t)},Myna.cache.save=function(t,n){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,n):s(t,n)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?o(t):a(t)}}.call(this),function(){Myna.Variant=function(){function t(t){var n,e,r,i;null==t&&(t={}),this.id=null!=(n=t.id)?n:Myna.error("Myna.Variant.constructor","no id in options",t),this.name=null!=(e=t.name)?e:this.id,this.weight=null!=(r=t.weight)?r:Myna.error("Myna.Variant.constructor","no weight in options",t),this.settings=new Myna.Settings(null!=(i=t.settings)?i:{})}return t}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Myna.BaseExperiment=function(n){function r(n){var e,i,a,o,s,u,l,c;for(null==n&&(n={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearVariant=t(this.clearVariant,this),this.saveVariant=t(this.saveVariant,this),this.loadVariant=t(this.loadVariant,this),this.clearLastReward=t(this.clearLastReward,this),this.saveLastReward=t(this.saveLastReward,this),this.loadLastReward=t(this.loadLastReward,this),this.clearLastView=t(this.clearLastView,this),this.saveLastView=t(this.saveLastView,this),this.loadLastView=t(this.loadLastView,this),this.randomVariant=t(this.randomVariant,this),this.totalWeight=t(this.totalWeight,this),this.saveVariantFromReward=t(this.saveVariantFromReward,this),this.rewardVariant=t(this.rewardVariant,this),this.loadVariantsForReward=t(this.loadVariantsForReward,this),this.reward=t(this.reward,this),this.saveVariantFromView=t(this.saveVariantFromView,this),this.viewVariant=t(this.viewVariant,this),this.loadVariantsForView=t(this.loadVariantsForView,this),this.view=t(this.view,this),this.loadVariantsForSuggest=t(this.loadVariantsForSuggest,this),this.suggest=t(this.suggest,this),r.__super__.constructor.call(this,n),Myna.log("Myna.BaseExperiment.constructor",n),this.uuid=null!=(o=n.uuid)?o:Myna.error("Myna.BaseExperiment.constructor",this.id,"no uuid in options",n),this.id=null!=(s=n.id)?s:Myna.error("Myna.BaseExperiment.constructor",this.id,"no id in options",n),this.settings=new Myna.Settings(null!=(u=n.settings)?u:{}),this.variants={},c=null!=(l=n.variants)?l:[],i=0,a=c.length;a>i;i++)e=c[i],this.variants[e.id]=new Myna.Variant(e)}return e(r,n),r.prototype.suggest=function(t,n){var e,r,i;null==t&&(t=function(){}),null==n&&(n=function(){}),e=this.loadVariantsForSuggest(),Myna.log("Myna.BaseExperiment.suggest",this.id,null!=(r=e.variant)?r.id:void 0,null!=(i=e.viewed)?i.id:void 0),this.viewVariant(Myna.extend({success:t,error:n},e))},r.prototype.loadVariantsForSuggest=function(){return{variant:this.randomVariant(),viewed:this.loadLastView()}},r.prototype.view=function(t,n,e){var r,i,a;null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForView(t),Myna.log("Myna.BaseExperiment.view",this.id,null!=(i=r.variant)?i.id:void 0,null!=(a=r.viewed)?a.id:void 0),this.viewVariant(Myna.extend({success:n,error:e},r))},r.prototype.loadVariantsForView=function(t){return{variant:t instanceof Myna.Variant?t:this.variants[t],viewed:null}},r.prototype.viewVariant=function(t){var n,e,r,i,a,o;r=t.variant,i=t.viewed,e=null!=(a=t.success)?a:function(){},n=null!=(o=t.error)?o:function(){},Myna.log("Myna.BaseExperiment.viewVariant",this.id,null!=r?r.id:void 0,null!=i?i.id:void 0),null!=i?this.trigger("beforeView",i,!1)!==!1&&(e.call(this,i,!1),this.trigger("view",i,!1)):null!=r?this.trigger("beforeView",r,!0)!==!1&&(this.saveVariantFromView(r),e.call(this,r,!0),this.trigger("view",r,!0),this.trigger("recordView",r)):n(Myna.problem("no-variant"))},r.prototype.saveVariantFromView=function(t){return this.saveLastView(t),this.clearLastReward()},r.prototype.reward=function(t,n,e){var r,i,a;null==t&&(t=1),null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForReward(),Myna.log("Myna.BaseExperiment.reward",this.id,null!=(i=r.variant)?i.id:void 0,null!=(a=r.rewarded)?a.id:void 0,t),this.rewardVariant(Myna.extend({amount:t,success:n,error:e},r))},r.prototype.loadVariantsForReward=function(){return{variant:this.loadLastView(),rewarded:this.loadLastReward()}},r.prototype.rewardVariant=function(t){var n,e,r,i,a,o,s,u,l=this;null==t&&(t={}),Myna.log("Myna.BaseExperiment.rewardVariant",this.id,t),a=t.variant,r=t.rewarded,n=null!=(o=t.amount)?o:1,i=null!=(s=t.success)?s:function(){},e=null!=(u=t.error)?u:function(){},null!=r?this.trigger("beforeReward",r,n,!1)!==!1&&(i.call(this,r,n,!1),this.trigger("reward",r,n,!1)):null!=a?this.trigger("beforeReward",a,n,!0)!==!1&&this.triggerAsync("recordReward",a,n,function(){return l.saveVariantFromReward(a),i.call(l,a,n,!0),l.trigger("reward",a,n,!0)},function(){l.saveVariantFromReward(a),e.call(l)}):e(Myna.problem("no-variant"))},r.prototype.saveVariantFromReward=function(t){return this.clearLastView(),this.saveLastReward(t)},r.prototype.totalWeight=function(){var t,n,e,r;t=0,r=this.variants;for(n in r)e=r[n],t+=e.weight;return t},r.prototype.randomVariant=function(){var t,n,e,r,i;e=this.totalWeight(),n=Math.random()*e,i=this.variants;for(t in i)if(r=i[t],e-=r.weight,n>=e)return Myna.log("Myna.BaseExperiment.randomVariant",this.id,r.id),r;return Myna.log("Myna.BaseExperiment.randomVariant",this.id,null),null},r.prototype.loadLastView=function(){return this.loadVariant("lastView")},r.prototype.saveLastView=function(t){return this.saveVariant("lastView",t),this.clearVariant("lastReward")},r.prototype.clearLastView=function(){return this.clearVariant("lastView")},r.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},r.prototype.saveLastReward=function(t){return this.saveVariant("lastReward",t)},r.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},r.prototype.loadVariant=function(t){var n,e;return n=null!=(e=this.load())?e[t]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",this.id,t,n),null!=n?this.variants[n]:null},r.prototype.saveVariant=function(t,n){var e=this;return this.loadAndSave(function(r){return Myna.log("Myna.BaseExperiment.saveVariant",e.id,t,n,r),null!=n?r[t]=n.id:delete r[t],r})},r.prototype.clearVariant=function(t){return this.saveVariant(t,null)},r.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},r.prototype.load=function(){return Myna.cache.load(this.uuid)},r.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},r}(Myna.Events)}.call(this),function(){var t,n=function(t,n){return function(){return t.apply(n,arguments)}},e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Experiment=function(e){function i(){return this.clearStickyReward=n(this.clearStickyReward,this),this.saveStickyReward=n(this.saveStickyReward,this),this.loadStickyReward=n(this.loadStickyReward,this),this.clearStickySuggestion=n(this.clearStickySuggestion,this),this.saveStickySuggestion=n(this.saveStickySuggestion,this),this.loadStickySuggestion=n(this.loadStickySuggestion,this),this.unstick=n(this.unstick,this),this.saveVariantFromReward=n(this.saveVariantFromReward,this),this.loadVariantsForReward=n(this.loadVariantsForReward,this),this.saveVariantFromView=n(this.saveVariantFromView,this),this.loadVariantsForView=n(this.loadVariantsForView,this),this.loadVariantsForSuggest=n(this.loadVariantsForSuggest,this),this.sticky=n(this.sticky,this),t=i.__super__.constructor.apply(this,arguments)}return r(i,e),i.prototype.sticky=function(){return!!this.settings.get("myna.web.sticky",!0)},i.prototype.loadVariantsForSuggest=function(){var t;return t=this.loadStickySuggestion(),{variant:null!=t?t:this.randomVariant(),viewed:null!=t?t:null}},i.prototype.loadVariantsForView=function(t){return i.__super__.loadVariantsForView.call(this,t)},i.prototype.saveVariantFromView=function(t){return this.sticky()&&this.saveStickySuggestion(t),i.__super__.saveVariantFromView.call(this,t)},i.prototype.loadVariantsForReward=function(){return this.sticky()?{variant:this.loadLastView(),rewarded:this.loadStickyReward()}:i.__super__.loadVariantsForReward.call(this)},i.prototype.saveVariantFromReward=function(t){return this.sticky()&&this.saveStickyReward(t),i.__super__.saveVariantFromReward.call(this,t)},i.prototype.unstick=function(){return Myna.log("Myna.Experiment.unstick",this.id),this.clearLastView(),this.clearLastReward(),this.clearStickySuggestion(),this.clearStickyReward()},i.prototype.loadStickySuggestion=function(){return this.sticky()?this.loadVariant("stickySuggestion"):null},i.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t),this.clearVariant("stickyReward")},i.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},i.prototype.loadStickyReward=function(){return this.sticky()?this.loadVariant("stickyReward"):null},i.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},i.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},i}(Myna.BaseExperiment)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},r=[].slice;Myna.Recorder=function(n){function i(n){this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearQueuedEvents=t(this.clearQueuedEvents,this),this.requeueEvents=t(this.requeueEvents,this),this.queueEvent=t(this.queueEvent,this),this.queuedEvents=t(this.queuedEvents,this),this.sync=t(this.sync,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),this.init=t(this.init,this);var e,r;i.__super__.constructor.call(this),Myna.log("Myna.Recorder.constructor",n),this.client=n,this.apiKey=null!=(e=n.apiKey)?e:Myna.error("Myna.Recorder.constructor","no apiKey in options",options),this.apiRoot=null!=(r=n.apiRoot)?r:"//api.mynaweb.com",this.storageKey=n.settings.get("myna.web.storageKey","myna"),this.timeout=n.settings.get("myna.web.timeout",1e3),this.autoSync=n.settings.get("myna.web.autoSync",!0),this.semaphore=0,this.waiting=[]}return e(i,n),i.prototype.init=function(){var t,n,e,r;e=this.client.experiments,r=[];for(n in e)t=e[n],r.push(this.listenTo(t));return r},i.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.Recorder.listenTo",t.id),t.on("recordView",function(e,r,i){return n.recordView(t,e,r,i)}),t.on("recordReward",function(e,r,i,a){return n.recordReward(t,e,r,i,a)})},i.prototype.recordView=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),Myna.log("Myna.Recorder.recordView",t.id,n.id),this.queueEvent({typename:"view",experiment:t.uuid,variant:n.id,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(e,r):e()},i.prototype.recordReward=function(t,n,e,r,i){return null==r&&(r=function(){}),null==i&&(i=function(){}),Myna.log("Myna.Recorder.recordReward",t.id,n.id,e),this.queueEvent({typename:"reward",experiment:t.uuid,variant:n.id,amount:e,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(r,i):r()},i.prototype.sync=function(t,n){var e,i,a,o,s,u=this;return null==t&&(t=function(){}),null==n&&(n=function(){}),this.waiting.push({success:t,error:n}),this.semaphore>0?Myna.log("Myna.Recorder.sync","queued",this.waiting.length):(this.semaphore++,s=this.waiting,this.waiting=[],i=function(){var t;return t=u.clearQueuedEvents(),Myna.log("Myna.Recorder.sync.start",t,s.length),u.trigger("beforeSync",t)===!1?e([],[],t,!0):a(t,[],[],[])},a=function(t,n,i,a){var s,u;return Myna.log("Myna.Recorder.sync.syncAll",t,n,i,a),0===t.length?e(n,i,a):(s=t[0],u=t.length>=2?r.call(t,1):[],o(s,u,n,i,a))},o=function(t,n,e,r,i){var o;return Myna.log("Myna.Recorder.sync.syncOne",t,n,e,r,i),o=Myna.extend({},t,{apikey:u.apiKey}),o=Myna.deleteKeys(o,"experiment"),Myna.jsonp.request({url:""+u.apiRoot+"/v2/experiment/"+t.experiment+"/record",success:function(){return a(n,e.concat([t]),r,i)},error:function(o){return o.status&&o.status>=500?a(n,e,r,i.concat([t])):a(n,e,r.concat([t]),i)},timeout:u.timeout,params:o})},e=function(t,n,e,r){var i,a,o,l,c;if(null==r&&(r=!1),Myna.log("Myna.Recorder.sync.finish",t,n,e,u.waiting.length),e.length>0&&u.requeueEvents(e),n.length>0||e.length>0)for(a=0,l=s.length;l>a;a++)i=s[a],i.error(t,n,e);else for(o=0,c=s.length;c>o;o++)i=s[o],i.success(t,n,e);return r||u.trigger("sync",t,n,e),u.semaphore--,!r&&u.waiting.length>0?u.sync():void 0},i())},i.prototype.queuedEvents=function(){var t,n;return t=null!=(n=this.load().queuedEvents)?n:[],Myna.log("Myna.Recorder.queuedEvents",t),t},i.prototype.queueEvent=function(t){return Myna.log("Myna.Recorder.queueEvent",t),this.loadAndSave(function(n){var e;return n.queuedEvents=(null!=(e=n.queuedEvents)?e:[]).concat([t]),n})},i.prototype.requeueEvents=function(t){return Myna.log("Myna.Recorder.requeueEvents",t),this.loadAndSave(function(n){var e;return n.queuedEvents=t.concat(null!=(e=n.queuedEvents)?e:[]),n})},i.prototype.clearQueuedEvents=function(){var t;return Myna.log("Myna.Recorder.clearQueuedEvents"),t=[],this.loadAndSave(function(n){var e;return t=null!=(e=n.queuedEvents)?e:[],delete n.queuedEvents,n}),t},i.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},i.prototype.load=function(){return Myna.cache.load(this.storageKey)},i.prototype.save=function(t){return Myna.cache.save(this.storageKey,t)},i}(Myna.Events)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Myna.GoogleAnalytics=function(n){function r(n){this.rewardMultiplier=t(this.rewardMultiplier,this),this.eventName=t(this.eventName,this),this.enabled=t(this.enabled,this),this.rewardEvent=t(this.rewardEvent,this),this.viewEvent=t(this.viewEvent,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),this.init=t(this.init,this),Myna.log("Myna.GoogleAnalytics.constructor",n),this.client=n}return e(r,n),r.prototype.init=function(){var t,n,e,r;e=this.client.experiments,r=[];for(n in e)t=e[n],r.push(this.listenTo(t));return r},r.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.GoogleAnalytics.listenTo",t.id),t.on("recordView",function(e,r,i){return n.recordView(t,e,r,i)}),t.on("recordReward",function(e,r,i,a){return n.recordReward(t,e,r,i,a)})},r.prototype.recordView=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),Myna.log("Myna.GoogleAnalytics.recordView",t,n,e,r),this.enabled(t)&&"undefined"!=typeof _gaq&&null!==_gaq&&_gaq.push(this.viewEvent(t,n)),e()},r.prototype.recordReward=function(t,n,e,r,i){return null==r&&(r=function(){}),null==i&&(i=function(){}),Myna.log("Myna.GoogleAnalytics.recordReward",t,n,r,i),this.enabled(t)&&"undefined"!=typeof _gaq&&null!==_gaq&&_gaq.push(this.rewardEvent(t,n,e)),r()},r.prototype.viewEvent=function(t,n){return["_trackEvent","myna",this.eventName(t,"view"),n.id,null,!1]},r.prototype.rewardEvent=function(t,n,e){var r;return r=this.rewardMultiplier(t),["_trackEvent","myna",this.eventName(t,"reward"),n.id,Math.round(r*e),!0]},r.prototype.enabled=function(t){return t.settings.get("myna.web.googleAnalytics.enabled",!0)},r.prototype.eventName=function(t,n){var e;return null!=(e=t.settings.get("myna.web.googleAnalytics."+n+"Event"))?e:""+t.id+"-"+n},r.prototype.rewardMultiplier=function(t){return t.settings.get("myna.web.googleAnalytics.rewardMultiplier",100)},r}(Myna.Events)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Client=function(){function n(n){var e,r,i,a,o,s,u,l,c;for(null==n&&(n={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),Myna.log("Myna.Client.constructor",n),this.uuid=null!=(a=n.uuid)?a:null,this.apiKey=null!=(o=n.apiKey)?o:Myna.error("Myna.Deployment.constructor","no apiKey in options",n),this.apiRoot=null!=(s=n.apiRoot)?s:"//api.mynaweb.com",this.settings=new Myna.Settings(null!=(u=n.settings)?u:{}),this.experiments={},c=null!=(l=n.experiments)?l:[],r=0,i=c.length;i>r;r++)e=c[r],this.experiments[e.id]=e}return n.prototype.suggest=function(t,n,e){return null==n&&(n=function(){}),null==e&&(e=function(){}),this.experiments[t].suggest(n,e)},n.prototype.view=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].view(n,e,r)},n.prototype.reward=function(t,n,e,r){return null==n&&(n=1),null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].reward(n,e,r)},n}()}.call(this),function(){Myna.readyHandlers=[],Myna.ready=function(t){Myna.client?t(Myna.client):Myna.readyHandlers.push(t)},Myna.triggerReady=function(t){var n,e,r,i,a;for(i=Myna.readyHandlers,a=[],e=0,r=i.length;r>e;e++)n=i[e],a.push(n.call(Myna,t));return a},Myna.init=function(t){var n,e,r,i,a,o;if(Myna.log("Myna.init",t),Myna.preview()&&t.latest)Myna.initRemote({url:t.latest});else{i=null!=(a=t.success)?a:function(){},e=null!=(o=t.error)?o:function(){};try{n=Myna.initLocal(t),i(n)}catch(s){r=s,e(r)}}},Myna.initLocal=function(t){var n,e,r,i,a,o,s;return Myna.log("Myna.init",t),a=t.typename,"deployment"!==a&&Myna.error("Myna.Client.initLocal",'Myna needs a deployment to initialise. The given JSON is not a deployment.\nIt has a typename of "'+a+'". Check you are initialising Myna with the\ncorrect UUID if you are calling initRemote',t),n=null!=(o=t.apiKey)?o:Myna.error("Myna.init","no apiKey in options",t),e=null!=(s=t.apiRoot)?s:"//api.mynaweb.com",r=function(){var n,e,r,a,o;for(a=null!=(r=t.experiments)?r:[],o=[],n=0,e=a.length;e>n;n++)i=a[n],o.push(new Myna.Experiment(i));return o}(),Myna.client=new Myna.Client({apiKey:n,apiRoot:e,experiments:r}),Myna.recorder=new Myna.Recorder(Myna.client),Myna.googleAnalytics=new Myna.GoogleAnalytics(Myna.client),Myna.preview()?Myna.$&&(Myna.inspector=new Myna.Inspector(Myna.client),Myna.$(function(){return Myna.triggerReady(Myna.client),Myna.inspector.init()})):(Myna.triggerReady(Myna.client),Myna.recorder.init(),Myna.googleAnalytics.init()),Myna.client},Myna.initRemote=function(t){var n,e,r,i,a,o;Myna.log("Myna.initRemote",t),r=null!=(i=t.url)?i:Myna.error("Myna.Client.initRemote","no url specified in options",t),e=null!=(a=t.success)?a:function(){},n=null!=(o=t.error)?o:function(){},Myna.jsonp.request({url:r,success:function(t){var r,i;Myna.log("Myna.initRemote","response",t);try{return r=Myna.initLocal(t),e(r)}catch(a){return i=a,n(i)}},error:n})}}.call(this);