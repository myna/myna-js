window.Myna=null!=window.Myna?window.Myna:{};var Log,LogLevel;LogLevel={SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},Log=function(){function e(e){this.loglevel=e}return e.prototype.log=function(e,t){return window.console&&this.loglevel>=e?window.console.log(t):void 0},e}(),window.Myna.LogLevel=LogLevel;var extend;extend=function(e,t){var n,o;for(n in t)o=t[n],e[n]||(e[n]=o);return e};var Config;Config=function(){function e(e){var t;t="https:"===document.location.protocol?"https":"http",this.cookieLifespan=365,this.cookieName="myna"+e,this.timeout=1200,this.baseurl=""+t+"://api.mynaweb.com",this.loglevel=LogLevel.ERROR,this.rewardSuccess=function(){return void 0},this.error=function(){return void 0}}return e.prototype.extend=function(e){return extend(extend({},e),this)},e}();var Cookie;Cookie={create:function(e,t,n){var o,r;return r=n?(o=new Date,o.setTime(o.getTime()+1e3*60*60*24*n),"; expires="+o.toGMTString()):"",document.cookie=""+e+"="+(t+r)+"; path=/"},read:function(e){var t,n,o,r,i,s,l,a;for(s=e+"=",i=function(e){var t;return t=e.indexOf(s),t>=0&&e.substring(0,t).match("^\\s*$")},n=function(e){var t;return t=e.indexOf(s),e.substring(t+s.length,e.length)},o=document.cookie.split(";"),l=0,a=o.length;a>l;l++)t=o[l],i(t)&&(r=n(t));return r},erase:function(e){return Cookie.create(e,"",-1)}};var JsonP;window.Myna.callbacks=[],JsonP={callbackCounter:0,removeCallback:function(e){var t;if(this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState);else{this.onload=null;try{return this.parentNode.removeChild(this)}catch(n){t=n}finally{window.Myna.callbacks[e]=null}}},doJsonP:function(e){var t,n,o,r,i,s,l;r=!1,t="callback"+JsonP.callbackCounter++,window.Myna.callbacks[t]=function(){},window.Myna.callbacks[t]=function(t){switch(r||(r=!0),t.typename){case"problem":return e.error.call(this,t);default:return e.success.call(this,t)}},i=e.url+"?",l=e.data;for(o in l)s=l[o],i+=""+o+"="+s+"&";return i+="callback=window.Myna.callbacks."+t,e.timeout>0&&window.setTimeout(function(){return r?void 0:(r=!0,JsonP.removeCallback.call(n,t),e.error({typename:"problem",subtype:500,messages:[{typename:"timeout",item:"The server took longer than "+e.timeout+" ms to reply"}]}))},e.timeout),n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.setAttribute("async","true"),n.onload=n.onreadystatechange=function(){return JsonP.removeCallback.call(n,t)},n.setAttribute("src",i),document.getElementsByTagName("head")[0].appendChild(n)}};var Experiment,__bind=function(e,t){return function(){return e.apply(t,arguments)}};Experiment=function(){function e(e,t){this.uuid=e,null==t&&(t={}),this.recallOrSuggest=__bind(this.recallOrSuggest,this),this.forget=__bind(this.forget,this),this.recall=__bind(this.recall,this),this.suggest=__bind(this.suggest,this),this.config=new Config(this.uuid).extend(t),this.logger=new Log(this.config.loglevel)}return e.prototype.suggest=function(e,t){var n,o,r,i,s=this;return null==t&&(t=this.config.error),n=function(e){var t,n,o,r,i;for(r=Myna.onsuggest,i=[],n=0,o=r.length;o>n;n++)t=r[n],i.push(t(s,e));return i},i=function(t){var r;return s.logger.log(LogLevel.DEBUG,"Experiment.suggest successWrapper called"),s.logger.log(LogLevel.DEBUG,t),"suggestion"===t.typename?(s.logger.log(LogLevel.INFO,"Myna suggested "+t.choice),s.logger.log(LogLevel.DEBUG,"Response token is "+t.token),r=new Suggestion(s,t.choice,t.token),n(r),e?e(r):s.logger.log(LogLevel.WARN,"You should pass a success function to Experiment.suggest. See the docs for details.")):"problem"===t.typename?(s.logger.log(LogLevel.ERROR,"Experiment.suggest returned an API error: "+t.subtype+" "+t.messages),o(t)):(s.logger.log(LogLevel.ERROR,"Experiment.suggest did something unexpected"),s.logger.log(LogLevel.ERROR,t),o({typename:"problem",subtype:400,messages:[{typename:"unexpected",item:t}]}))},o=function(e){return s.logger.log(LogLevel.ERROR,"Experiment.suggest errorWrapper called"),s.logger.log(LogLevel.ERROR,e),n(e),t?t(e):void 0},r={url:this.config.baseurl+("/v1/experiment/"+this.uuid+"/suggest"),data:{},success:i,error:o},JsonP.doJsonP(extend(r,this.config))},e.prototype.recall=function(){var e,t,n,o;return t=Cookie.read(this.config.cookieName),t?(n=t.indexOf(":"),n>=0?(o=t.substring(0,n),e=t.substring(n+1,t.length),new Suggestion(this,e,o)):void 0):void 0},e.prototype.forget=function(){return Cookie.erase(this.config.cookieName)},e.prototype.recallOrSuggest=function(e,t){var n;return null==t&&(t=this.config.error),n=this.recall(),n?e(n):this.suggest(e,t)},e}(),window.Myna.Experiment=Experiment;var Suggestion;Suggestion=function(){function e(e,t,n){this.experiment=e,this.choice=t,this.token=n}return e.prototype.reward=function(e,t,n){var o,r,i,s,l,a=this;return null==e&&(e=1),null==t&&(t=this.experiment.config.rewardSuccess),null==n&&(n=this.experiment.config.error),r=function(t){var n,o,r,i,s;for(i=Myna.onreward,s=[],o=0,r=i.length;r>o;o++)n=i[o],s.push(n(a,e,t));return s},o={token:this.token,amount:e},l=function(e){return r(e),t(e)},i=function(e){return a.experiment.logger.log(LogLevel.ERROR,"Suggestion.reward errorWrapper called"),a.experiment.logger.log(LogLevel.ERROR,e),r(e),n?n(e):void 0},s={url:this.experiment.config.baseurl+("/v1/experiment/"+this.experiment.uuid+"/reward"),data:o,success:l,error:i},JsonP.doJsonP(extend(s,this.experiment.config))},e.prototype.remember=function(){return Cookie.create(this.experiment.config.cookieName,""+this.token+":"+this.choice,this.experiment.config.cookieLifespan)},e.prototype.rewardOnClick=function(e,t,n){var o,r,i=this;return null==n&&(n=1),r=function(){return window.location=t},o=function(e){return e||(e=window.event),e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),i.reward(n,r,r),!1},e.onclick=o},e}();var f,_i,_len,_ref,__slice=[].slice;for(extend(window.Myna,{onload:[],onsuggest:[],onreward:[]}),window.Myna.onload.push=function(){var e,t,n,o,r;for(e=arguments.length>=1?__slice.call(arguments,0):[],r=[],n=0,o=e.length;o>n;n++)t=e[n],r.push(t());return r},_ref=window.Myna.onload,_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],f();