(function(){var t,n,e=[].slice;null==(t=window.Myna)&&(window.Myna={}),Myna.debug=!0,Myna.log=function(){var t,n;t=arguments.length>=1?e.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.log(t)},Myna.error=function(){var t,n;throw t=arguments.length>=1?e.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.error(t),t},Myna.trim=function(t){return String.prototype.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},Myna.extend=function(){var t,n,r,i,a,s,o;for(t=arguments[0],r=arguments.length>=2?e.call(arguments,1):[],s=0,o=r.length;o>s;s++){i=r[s];for(n in i)a=i[n],t[n]=a}return t},Myna.deleteKeys=function(){var t,n,r,i,a,s;for(i=arguments[0],r=arguments.length>=2?e.call(arguments,1):[],t=Myna.extend({},i),a=0,s=r.length;s>a;a++)n=r[a],delete t[n];return t},Myna.dateToString=function(t){var n,e,r,i,a,s,o,u;return Date.prototype.toISOString?t.toISOString():(s=function(t,n){var e;for(e=""+t;n>e.length;)e="0"+e;return e},u=s(t.getUTCFullYear(),4),a=s(t.getUTCMonth()+1,2),n=s(t.getUTCDate(),2),e=s(t.getUTCHours(),2),i=s(t.getUTCMinutes(),2),o=s(t.getUTCSeconds(),2),r=s(t.getUTCMilliseconds(),2),""+u+"-"+a+"-"+n+"T"+e+":"+i+":"+o+"."+r+"Z")},Myna.problem=function(t){return t},Myna.$=null!=(n=window.jQuery)?n:null}).call(this),function(){Myna.jsonp={callbacks:{},counter:0,request:function(t){var n,e,r,i,a,s,o,u,l,c,h,y,d,p,g,f,v,w,m;null==t&&(t={}),d=null!=(g=t.url)?g:Myna.error("Myna.jsonp.request","no url in options",t),l=null!=(f=t.success)?f:function(){},e=null!=(v=t.error)?v:function(){},c=null!=(w=t.timeout)?w:0,s=null!=(m=t.params)?m:{},n="callback"+Myna.jsonp.counter++,o=!1,y=""+d+"?";for(r in s)p=s[r],y+=""+r+"="+p+"&";y+="callback=Myna.jsonp.callbacks."+n,Myna.log("Myna.jsonp.request",y,l,e,c),u=document.createElement("script"),u.setAttribute("type","text/javascript"),u.setAttribute("async","true"),u.setAttribute("src",y),u.setAttribute("class","myna-jsonp"),u.setAttribute("data-callback",n),u.onload=u.onreadystatechange=function(){return Myna.jsonp.remove(n,u)},a=function(){return o?Myna.log("Myna.jsonp.request.onTimeout",n,c,"already returned"):(o=!0,Myna.log("Myna.jsonp.request.onTimeout",n,c),Myna.jsonp.remove(n,u),e({typename:"problem",subtype:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:n}]}))},h=c>0?window.setTimeout(a,c):null,i=function(t){return o?Myna.log("Myna.jsonp.request.onComplete",n,"already returned"):(o=!0,Myna.log("Myna.jsonp.request.onComplete",n,t.typename,"problem"===t.typename,t),window.clearTimeout(h),Myna.jsonp.remove(n,u),"problem"===t.typename?e(t):l(t))},Myna.jsonp.callbacks[n]=i,document.getElementsByTagName("head")[0].appendChild(u)},remove:function(t,n){var e;if(null==t&&(t=null),null==n&&(n=null),e=null!=n?n.readyState:void 0,!e||"complete"===e||"loaded"===e)try{n&&(n.onload=null,n.parentNode.removeChild(n))}finally{t&&delete Myna.jsonp.callbacks[t]}}}}.call(this),function(){"use strict";var t,n,e,r,i,a,s=function(t,n){return function(){return t.apply(n,arguments)}},o={}.hasOwnProperty,u=function(t,n){function e(){this.constructor=t}for(var r in n)o.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},l=[].slice;e=function(){function t(t){null==t&&(t=null),this.next=t}return t}(),r=function(t){function n(t){this.prefixes=s(this.prefixes,this),this.unset=s(this.unset,this),this.set=s(this.set,this),this.get=s(this.get,this),this.path=s(this.path,this),n.__super__.constructor.call(this,t)}return u(n,t),n.prototype.path=function(){return this.next.path().substring(1)},n.prototype.get=function(t){return this.next.get(t)},n.prototype.set=function(t,n){return null!=n?this.next.set(t,n):this.next.unset(t)},n.prototype.unset=function(t){return this.next.unset(t)},n.prototype.prefixes=function(){return this.next.prefixes()},n}(e),t=function(t){function n(t,e){this.prefixes=s(this.prefixes,this),this.unset=s(this.unset,this),this.set=s(this.set,this),this.get=s(this.get,this),this.path=s(this.path,this),n.__super__.constructor.call(this,t),this.name=e}return u(n,t),n.prototype.path=function(){return"."+this.name+this.next.path()},n.prototype.get=function(t){return this.next.get(null!=t?t[this.name]:void 0)},n.prototype.set=function(t,n){var e,r,i;e={};for(r in t)i=t[r],e[r]=i;return e[this.name]=this.next.set(e[this.name],n),e},n.prototype.unset=function(t){var n,e,r,i;n={};for(e in t)i=t[e],n[e]=i;return r=this.next.unset(n[this.name]),null!=this.next.unset(n[this.name])?n[this.name]=r:delete n[this.name],n},n.prototype.prefixes=function(){var t;return[this.name].concat(l.call(function(){var n,e,r,i;for(r=this.next.prefixes(),i=[],n=0,e=r.length;e>n;n++)t=r[n],i.push(""+this.name+"."+t);return i}.call(this)))},n}(e),n=function(t){function n(){n.__super__.constructor.call(this,null)}return u(n,t),n.prototype.path=function(){return""},n.prototype.get=function(t){return t},n.prototype.set=function(t,n){return n},n.prototype.unset=function(){return void 0},n.prototype.prefixes=function(){return[]},n}(e),a=new n,i=function(){function e(t){null==t&&(t={}),this.toJson=s(this.toJson,this),this.unset=s(this.unset,this),this.set=s(this.set,this),this.get=s(this.get,this),this.data={},this.set(t)}return e.ast={Root:r,Field:t,Nil:n,nil:a},e.parse=function(n){var e,i,s,o;if(n=Myna.trim(n),e=a,""!==n)for(o=n.split("."),s=o.length-1;s>=0;s+=-1)i=o[s],e=new t(e,i);return new r(e)},e.prototype.get=function(t,n){var r;return null==n&&(n=null),null!=(r=e.parse(t).get(this.data))?r:n},e.prototype.set=function(){var t,n,r;switch(arguments.length){case 0:throw["Settings.set","not enough arguments",arguments];case 1:r=arguments[0];for(t in r)n=r[t],this.data=e.parse(t).set(this.data,n);break;default:t=arguments[0],n=arguments[1],this.data=e.parse(t).set(this.data,n)}return this},e.prototype.unset=function(t){return this.data=e.parse(t).unset(this.data),this},e.prototype.toJson=function(){return this.data},e}.call(this),Myna.Settings=i}.call(this),function(){var t,n,e,r,i,a,s,o,u,l;null==(l=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return e=t,!1}}(),Myna.cache.localStorageEnabled=!0,i=function(t){var n;if(n=window.localStorage.getItem("myna-"+t),null==n)return null;try{return JSON.parse(n)}catch(r){return e=r,null}},u=function(t,n){null!=n?window.localStorage.setItem("myna-"+t,JSON.stringify(n)):window.localStorage.removeItem("myna-"+t)},s=function(t){window.localStorage.removeItem("myna-"+t)},n=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return 0===t.indexOf('"')?JSON.parse(t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(t),JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},o=function(t,e,r){var i,a,s,o;null==r&&(r=365),o="myna-"+t+"="+n(e),a=r?(i=new Date,i.setTime(i.getTime()+1e3*60*60*24*r),"; expires="+i.toGMTString()):"",s="; path=/",document.cookie=""+o+a+s},r=function(n){var e,r,i,a,s,o,u,l;for(s="myna-"+n+"=",a=function(t){var n;return n=t.indexOf(s),n>=0&&t.substring(0,n).match("^\\s*$")},r=function(t){var n;return n=t.indexOf(s),t.substring(n+s.length,t.length)},i=document.cookie.split(";"),u=0,l=i.length;l>u;u++)if(e=i[u],a(e)&&null!=(o=r(e)))return t(o);return null},a=function(t){o(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?i(t):r(t)},Myna.cache.save=function(t,n){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,n):o(t,n)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?s(t):a(t)}}.call(this),function(){Myna.Variant=function(){function t(t){var n,e,r;null==t&&(t={}),this.id=null!=(n=t.id)?n:Myna.error("Myna.Variant.constructor","no id in options",t),this.weight=null!=(e=t.weight)?e:Myna.error("Myna.Variant.constructor","no weight in options",t),this.settings=new Myna.Settings(null!=(r=t.settings)?r:{})}return t}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n=[].slice;Myna.Events=function(){function e(){this.off=t(this.off,this),this.on=t(this.on,this),this.triggerAsync=t(this.triggerAsync,this),this.trigger=t(this.trigger,this),this.eventHandlers={}}return e.prototype.trigger=function(){var t,e,r,i,a,s,o,u;for(r=arguments[0],t=arguments.length>=2?n.call(arguments,1):[],Myna.log.apply(Myna,["Myna.Events.trigger",r].concat(n.call(t))),e=!1,u=null!=(o=this.eventHandlers[r])?o:[],a=0,s=u.length;s>a;a++)i=u[a],e=e||i.apply(this,t)===!1;return e?!1:void 0},e.prototype.triggerAsync=function(){var t,e,r,i,a,s,o,u=this;return r=arguments[0],t=arguments.length>=4?n.call(arguments,1,s=arguments.length-2):(s=1,[]),i=arguments[s++],e=arguments[s++],Myna.log.apply(Myna,["Myna.Events.triggerAsync",r].concat(n.call(t))),a=function(r){var s,o;return Myna.log("Myna.Events.triggerAsync.triggerAll",r),0===r.length?i():(s=r[0],o=r.length>=2?n.call(r,1):[],s.call.apply(s,[u].concat(n.call(t),[function(){return a(o)}],[e])))},a(null!=(o=this.eventHandlers[r])?o:[])},e.prototype.on=function(t,n){var e;return this.eventHandlers[t]=(null!=(e=this.eventHandlers[t])?e:[]).concat([n]),Myna.log("Myna.Events.on",t,n,this.eventHandlers[t])},e.prototype.off=function(t,n){var e;switch(null==n&&(n=null),arguments.length){case 0:this.eventHandlers={};break;case 1:delete this.eventHandlers[arguments[0]];break;default:t=arguments[0],n=arguments[1],this.eventHandlers[t]=function(){var r,i,a,s;for(a=this.eventHandlers[t],s=[],r=0,i=a.length;i>r;r++)e=a[r],e!==n&&s.push(e);return s}.call(this)}return Myna.log("Myna.Events.off",t,n,this.eventHandlers[t])},e}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},r=[].slice;Myna.BaseExperiment=function(n){function i(n){var e,r,a,s,o,u,l,c;for(null==n&&(n={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearVariant=t(this.clearVariant,this),this.saveVariant=t(this.saveVariant,this),this.loadVariant=t(this.loadVariant,this),this.clearLastReward=t(this.clearLastReward,this),this.saveLastReward=t(this.saveLastReward,this),this.loadLastReward=t(this.loadLastReward,this),this.clearLastView=t(this.clearLastView,this),this.saveLastView=t(this.saveLastView,this),this.loadLastView=t(this.loadLastView,this),this.randomVariant=t(this.randomVariant,this),this.totalWeight=t(this.totalWeight,this),this.saveVariantFromReward=t(this.saveVariantFromReward,this),this.rewardVariant=t(this.rewardVariant,this),this.loadVariantsForReward=t(this.loadVariantsForReward,this),this.reward=t(this.reward,this),this.saveVariantFromView=t(this.saveVariantFromView,this),this.viewVariant=t(this.viewVariant,this),this.loadVariantsForView=t(this.loadVariantsForView,this),this.view=t(this.view,this),this.loadVariantsForSuggest=t(this.loadVariantsForSuggest,this),this.suggest=t(this.suggest,this),i.__super__.constructor.call(this,n),Myna.log("Myna.BaseExperiment.constructor",n),this.uuid=null!=(s=n.uuid)?s:Myna.error("Myna.BaseExperiment.constructor",this.id,"no uuid in options",n),this.id=null!=(o=n.id)?o:Myna.error("Myna.BaseExperiment.constructor",this.id,"no id in options",n),this.settings=new Myna.Settings(null!=(u=n.settings)?u:{}),this.variants={},c=null!=(l=n.variants)?l:[],r=0,a=c.length;a>r;r++)e=c[r],this.variants[e.id]=new Myna.Variant(e)}return e(i,n),i.prototype.suggest=function(t,n){var e,r,i;null==t&&(t=function(){}),null==n&&(n=function(){}),e=this.loadVariantsForSuggest(),Myna.log("Myna.BaseExperiment.suggest",this.id,null!=(r=e.variant)?r.id:void 0,null!=(i=e.viewed)?i.id:void 0),this.viewVariant(Myna.extend({success:t,error:n},e))},i.prototype.loadVariantsForSuggest=function(){return{variant:this.randomVariant(),viewed:this.loadLastView()}},i.prototype.view=function(t,n,e){var r,i,a;null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForView(t),Myna.log("Myna.BaseExperiment.view",this.id,null!=(i=r.variant)?i.id:void 0,null!=(a=r.viewed)?a.id:void 0),this.viewVariant(Myna.extend({success:n,error:e},r))},i.prototype.loadVariantsForView=function(t){return{variant:t instanceof Myna.Variant?t:this.variants[t],viewed:null}},i.prototype.viewVariant=function(t){var n,e,r,i,a,s;r=t.variant,i=t.viewed,e=null!=(a=t.success)?a:function(){},n=null!=(s=t.error)?s:function(){},Myna.log("Myna.BaseExperiment.viewVariant",this.id,null!=r?r.id:void 0,null!=i?i.id:void 0),null!=i?this.trigger("beforeView",i,!1)!==!1&&(e.call(this,i,!1),this.trigger("view",i,!1)):null!=r?this.trigger("beforeView",r,!0)!==!1&&(this.saveVariantFromView(r),e.call(this,r,!0),this.trigger("view",r,!0),this.trigger("recordView",r)):n(Myna.problem("no-variant"))},i.prototype.saveVariantFromView=function(t){return this.saveLastView(t),this.clearLastReward()},i.prototype.reward=function(t,n,e){var r,i,a;null==t&&(t=1),null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForReward(),Myna.log("Myna.BaseExperiment.reward",this.id,null!=(i=r.variant)?i.id:void 0,null!=(a=r.rewarded)?a.id:void 0,t),this.rewardVariant(Myna.extend({amount:t,success:n,error:e},r))},i.prototype.loadVariantsForReward=function(){return{variant:this.loadLastView(),rewarded:this.loadLastReward()}},i.prototype.rewardVariant=function(t){var n,e,i,a,s,o,u,l,c=this;null==t&&(t={}),Myna.log("Myna.BaseExperiment.rewardVariant",this.id,t),s=t.variant,i=t.rewarded,n=null!=(o=t.amount)?o:1,a=null!=(u=t.success)?u:function(){},e=null!=(l=t.error)?l:function(){},null!=i?this.trigger("beforeReward",i,n,!1)!==!1&&(a.call(this,i,n,!1),this.trigger("reward",i,n,!1)):null!=s?this.trigger("beforeReward",s,n,!0)!==!1&&this.triggerAsync("recordReward",s,n,function(){return c.saveVariantFromReward(s),a.call(c,s,n,!0),c.trigger("reward",s,n,!0)},function(){var t;return t=arguments.length>=1?r.call(arguments,0):[],e.call.apply(e,[c].concat(r.call(t)))}):e(Myna.problem("no-variant"))},i.prototype.saveVariantFromReward=function(t){return this.clearLastView(),this.saveLastReward(t)},i.prototype.totalWeight=function(){var t,n,e,r;t=0,r=this.variants;for(n in r)e=r[n],t+=e.weight;return t},i.prototype.randomVariant=function(){var t,n,e,r,i;e=this.totalWeight(),n=Math.random()*e,i=this.variants;for(t in i)if(r=i[t],e-=r.weight,n>=e)return Myna.log("Myna.BaseExperiment.randomVariant",this.id,r.id),r;return Myna.log("Myna.BaseExperiment.randomVariant",this.id,null),null},i.prototype.loadLastView=function(){return this.loadVariant("lastView")},i.prototype.saveLastView=function(t){return this.saveVariant("lastView",t),this.clearVariant("lastReward")},i.prototype.clearLastView=function(){return this.clearVariant("lastView")},i.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},i.prototype.saveLastReward=function(t){return this.saveVariant("lastReward",t)},i.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},i.prototype.loadVariant=function(t){var n,e;return n=null!=(e=this.load())?e[t]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",this.id,t,n),null!=n?this.variants[n]:null},i.prototype.saveVariant=function(t,n){var e=this;return this.loadAndSave(function(r){return Myna.log("Myna.BaseExperiment.saveVariant",e.id,t,n,r),null!=n?r[t]=n.id:delete r[t],r})},i.prototype.clearVariant=function(t){return this.saveVariant(t,null)},i.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},i.prototype.load=function(){return Myna.cache.load(this.uuid)},i.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},i}(Myna.Events)}.call(this),function(){var t,n=function(t,n){return function(){return t.apply(n,arguments)}},e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Experiment=function(e){function i(){return this.clearStickyReward=n(this.clearStickyReward,this),this.saveStickyReward=n(this.saveStickyReward,this),this.loadStickyReward=n(this.loadStickyReward,this),this.clearStickySuggestion=n(this.clearStickySuggestion,this),this.saveStickySuggestion=n(this.saveStickySuggestion,this),this.loadStickySuggestion=n(this.loadStickySuggestion,this),this.unstick=n(this.unstick,this),this.saveVariantFromReward=n(this.saveVariantFromReward,this),this.loadVariantsForReward=n(this.loadVariantsForReward,this),this.saveVariantFromView=n(this.saveVariantFromView,this),this.loadVariantsForView=n(this.loadVariantsForView,this),this.loadVariantsForSuggest=n(this.loadVariantsForSuggest,this),this.sticky=n(this.sticky,this),t=i.__super__.constructor.apply(this,arguments)}return r(i,e),i.prototype.sticky=function(){return!!this.settings.get("myna.js.sticky",!0)},i.prototype.loadVariantsForSuggest=function(){var t;return this.sticky()?(t=this.loadStickySuggestion(),{variant:null!=t?t:this.randomVariant(),viewed:t}):i.__super__.loadVariantsForSuggest.call(this)},i.prototype.loadVariantsForView=function(t){return i.__super__.loadVariantsForView.call(this,t)},i.prototype.saveVariantFromView=function(t){return this.sticky()&&this.saveStickySuggestion(t),i.__super__.saveVariantFromView.call(this,t)},i.prototype.loadVariantsForReward=function(){return this.sticky()?{variant:this.loadLastView(),rewarded:this.loadStickyReward()}:i.__super__.loadVariantsForReward.call(this)},i.prototype.saveVariantFromReward=function(t){return this.sticky()&&this.saveStickyReward(t),i.__super__.saveVariantFromReward.call(this,t)},i.prototype.unstick=function(){return Myna.log("Myna.Experiment.unstick",this.id),this.clearLastView(),this.clearLastReward(),this.clearStickySuggestion(),this.clearStickyReward()},i.prototype.loadStickySuggestion=function(){return this.loadVariant("stickySuggestion")},i.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t),this.clearVariant("stickyReward")},i.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},i.prototype.loadStickyReward=function(){return this.loadVariant("stickyReward")},i.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},i.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},i}(Myna.BaseExperiment)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},r=[].slice;Myna.Recorder=function(n){function i(n){var e,r,a,s,o;null==n&&(n={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearQueuedEvents=t(this.clearQueuedEvents,this),this.requeueEvents=t(this.requeueEvents,this),this.queueEvent=t(this.queueEvent,this),this.queuedEvents=t(this.queuedEvents,this),this.sync=t(this.sync,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),i.__super__.constructor.call(this,n),Myna.log("Myna.Recorder.constructor",n),this.apiKey=null!=(e=n.apiKey)?e:Myna.error("Myna.Recorder.constructor","no apiKey in options",n),this.apiRoot=null!=(r=n.apiRoot)?r:"//api.mynaweb.com",this.storageKey=null!=(a=n.storageKey)?a:"myna",this.timeout=null!=(s=n.timeout)?s:1e3,this.autoSync=null!=(o=n.autoSync)?o:!0,this.semaphore=0,this.waiting=[]}return e(i,n),i.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.Recorder.listenTo",t.id),t.on("recordView",function(e,r,i){return n.recordView(t,e,r,i)}),t.on("recordReward",function(e,r,i,a){return n.recordReward(t,e,r,i,a)})},i.prototype.recordView=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),Myna.log("Myna.Recorder.recordView",t.id,n.id),this.queueEvent({typename:"view",experiment:t.uuid,variant:n.id,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(e,r):e()},i.prototype.recordReward=function(t,n,e,r,i){return null==r&&(r=function(){}),null==i&&(i=function(){}),Myna.log("Myna.Recorder.recordReward",t.id,n.id,e),this.queueEvent({typename:"reward",experiment:t.uuid,variant:n.id,amount:e,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(r,i):r()},i.prototype.sync=function(t,n){var e,i,a,s,o,u=this;return null==t&&(t=function(){}),null==n&&(n=function(){}),this.waiting.push({success:t,error:n}),this.semaphore>0?Myna.log("Myna.Recorder.sync","queued"):(this.semaphore++,o=this.waiting,this.waiting=[],i=function(){var t;return t=u.clearQueuedEvents(),Myna.log("Myna.Recorder.sync.start",t,o.length),u.trigger("beforeSync",t)===!1?u.requeueEvents(t):a(t,[],[])},a=function(t,n,i){var a,o;return Myna.log("Myna.Recorder.sync.syncAll",t,n,i),0===t.length?e(n,i):(a=t[0],o=t.length>=2?r.call(t,1):[],s(a,o,n,i))},s=function(t,n,e,r){var i;return Myna.log("Myna.Recorder.sync.syncOne",t,n,e,r),i=Myna.deleteKeys(t,"experiment"),Myna.jsonp.request({url:""+u.apiRoot+"/v2/experiment/"+t.experiment+"/record",success:function(){return a(n,e.concat([t]),r)},error:function(){return a(n,e,r.concat([t]))},timeout:u.timeout,params:Myna.extend({},i,{apikey:u.apiKey})})},e=function(t,n){var e,r,i,a,s;if(Myna.log("Myna.Recorder.sync.finish",t,n),n.length>0)for(u.requeueEvents(n),r=0,a=o.length;a>r;r++)e=o[r],e.error(t,n);else for(i=0,s=o.length;s>i;i++)e=o[i],e.success(t,n);return u.trigger("afterSync",t,n),u.semaphore--,u.waiting.length>0?u.sync():void 0},i())},i.prototype.queuedEvents=function(){var t,n;return t=null!=(n=this.load().queuedEvents)?n:[],Myna.log("Myna.Recorder.queuedEvents",t),t},i.prototype.queueEvent=function(t){return Myna.log("Myna.Recorder.queueEvent",t),this.loadAndSave(function(n){var e;return n.queuedEvents=(null!=(e=n.queuedEvents)?e:[]).concat([t]),n})},i.prototype.requeueEvents=function(t){return Myna.log("Myna.Recorder.requeueEvents",t),this.loadAndSave(function(n){var e;return n.queuedEvents=t.concat(null!=(e=n.queuedEvents)?e:[]),n})},i.prototype.clearQueuedEvents=function(){var t;return Myna.log("Myna.Recorder.clearQueuedEvents"),t=[],this.loadAndSave(function(n){var e;return t=null!=(e=n.queuedEvents)?e:[],delete n.queuedEvents,n}),t},i.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},i.prototype.load=function(){return Myna.cache.load(this.storageKey)},i.prototype.save=function(t){return Myna.cache.save(this.storageKey,t)},i}(Myna.Events)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Client=function(){function n(n){var e,r,i,a,s,o;for(null==n&&(n={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),Myna.log("Myna.Client.constructor",n),this.experiments={},o=null!=(s=n.experiments)?s:[],i=0,a=o.length;a>i;i++)e=o[i],r=e instanceof Myna.Experiment?e:new Myna.Experiment(e),this.experiments[r.id]=r}return n.prototype.suggest=function(t,n,e){return null==n&&(n=function(){}),null==e&&(e=function(){}),this.experiments[t].suggest(n,e)},n.prototype.view=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].view(n,e,r)},n.prototype.reward=function(t,n,e,r){return null==n&&(n=1),null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].reward(n,e,r)},n}()}.call(this),function(){Myna.initLocal=function(t){var n,e,r,i,a,s,o,u,l,c,h;if(Myna.log("Myna.initLocal",t),n=null!=(o=t.apiKey)?o:Myna.error("Myna.initLocal","no apiKey in options",t),e=null!=(u=t.apiRoot)?u:"//api.mynaweb.com",r=null!=(l=t.debug)?l:"#debug"===window.location.hash,i=null!=(c=t.experiments)?c:[],Myna.client=new Myna.Client({apiKey:n,apiRoot:e,experiments:i}),r)Myna.client.toolbar=new Myna.Toolbar(Myna.client),Myna.$(Myna.client.toolbar.init);else{Myna.client.recorder=new Myna.Recorder(t),h=Myna.client.experiments;for(s in h)a=h[s],Myna.client.recorder.listenTo(a)}return Myna.client},Myna.initApi=function(t){var n,e,r,i,a,s,o,u;return Myna.log("Myna.initRemote",t),n=null!=(a=t.apiKey)?a:Myna.error("Myna.Client.initApi","no apiKey in options",t),e=null!=(s=t.apiRoot)?s:"//api.mynaweb.com",i=null!=(o=t.success)?o:function(){},r=null!=(u=t.error)?u:function(){},Myna.jsonp.request({url:""+e+"/v2/experiment",params:{apikey:n},success:function(t){return Myna.log("Myna.initRemote","response",t),i(Myna.initLocal({apiKey:n,apiRoot:e,experiments:t.results}))},error:r})}}.call(this);