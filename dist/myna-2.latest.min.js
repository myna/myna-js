(function(){var t,n=[].slice;null==(t=window.Myna)&&(window.Myna={}),Myna.log=function(){var t,e,i;t=arguments.length>=1?n.call(arguments,0):[],null!=(i=window.console)&&i.log(function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(JSON.stringify(e));return r}())},Myna.error=function(){var t;throw t=arguments.length>=1?n.call(arguments,0):[]},Myna.extend=function(t,n){var e,i;for(e in n)i=n[e],t[e]||(t[e]=i);return t}}).call(this),function(){var t,n,e,i,r,s=function(t,n){return function(){return t.apply(n,arguments)}},o={}.hasOwnProperty,a=function(t,n){function e(){this.constructor=t}for(var i in n)o.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};e=function(){function t(t){null==t&&(t=null),this.next=t}return t}(),i=function(t){function n(t){this.set=s(this.set,this),this.get=s(this.get,this),this.path=s(this.path,this),n.__super__.constructor.call(this,t)}return a(n,t),n.prototype.path=function(){return this.next.path().substring(1)},n.prototype.get=function(t){return this.next.get(t)},n.prototype.set=function(t,n){return this.next.set(t,n)},n}(e),t=function(t){function n(t,e){this.set=s(this.set,this),this.get=s(this.get,this),this.path=s(this.path,this),n.__super__.constructor.call(this,t),this.name=e}return a(n,t),n.prototype.path=function(){return"."+this.name+this.next.path()},n.prototype.get=function(t){return this.next.get(null!=t?t[this.name]:void 0)},n.prototype.set=function(t,n){var e,i,r;e={};for(i in t)r=t[i],e[i]=r;return e[this.name]=this.next.set(e[this.name],n),e},n}(e),n=function(t){function n(){n.__super__.constructor.call(this,null)}return a(n,t),n.prototype.path=function(){return""},n.prototype.get=function(t){return t},n.prototype.set=function(t,n){return n},n}(e),r=new n,Myna.Settings=function(){function n(t){null==t&&(t={}),this.toJson=s(this.toJson,this),this.parse=s(this.parse,this),this.set=s(this.set,this),this.get=s(this.get,this),this.data={},this.set(t)}return n.prototype.get=function(t,n){var e;return null==n&&(n=null),Myna.log("Myna.Settings.get",t),null!=(e=this.parse(t).get(this.data))?e:n},n.prototype.set=function(){var t,n,e;switch(arguments.length){case 2:t=arguments[0],n=arguments[1],Myna.log("Myna.Settings.set",t,n),this.data=this.parse(t).set(this.data,n);break;case 1:e=arguments[0];for(t in e)n=e[t],Myna.log("Myna.Settings.set",t,n),this.data=this.parse(t).set(this.data,n);break;default:throw["wrong number of arguments",arguments]}return this},n.prototype.parse=function(n){var e,s,o,a;for(e=r,a=n.split("."),o=a.length-1;o>=0;o+=-1)s=a[o],e=new t(e,s);return new i(e)},n.prototype.toJson=function(){return this.data},n}(),Myna.cache=new Myna.Settings}.call(this),function(){var t,n,e,i,r,s,o,a,u,c,h;null==(h=Myna.cache)&&(Myna.cache={}),i=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return e=t,!1}}(),s=function(t){var n,i;return Myna.log("readLocalStorage",t),i=window.localStorage.getItem("myna-"+t),n=function(){if(null==i)return null;try{return JSON.parse(i)}catch(t){return e=t,null}}(),Myna.log(" - readLocalStorage",t,n),n},c=function(t,n){Myna.log("writeLocalStorage",t,n),null!=n?window.localStorage.setItem("myna-"+t,JSON.stringify(n)):window.localStorage.removeItem("myna-"+t)},a=function(t){window.localStorage.removeItem("myna-"+t)},n=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return 0===t.indexOf('"')?JSON.parse(t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(t),JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},u=function(t,e,i){var r,s,o,a;null==i&&(i=365),a="myna-"+t+"="+n(e),s=i?(r=new Date,r.setTime(r.getTime()+1e3*60*60*24*i),"; expires="+r.toGMTString()):"",o="; path=/",document.cookie=""+a+s+o},r=function(n){var e,i,r,s,o,a,u,c;for(o="myna-"+n+"=",s=function(t){var n;return n=t.indexOf(o),n>=0&&t.substring(0,n).match("^\\s*$")},i=function(t){var n;return n=t.indexOf(o),t.substring(n+o.length,t.length)},r=document.cookie.split(";"),u=0,c=r.length;c>u;u++)if(e=r[u],s(e)&&null!=(a=i(e)))return t(a);return null},o=function(t){u(t,"",-1)},Myna.cache.load=function(t){return i?s(t):r(t)},Myna.cache.save=function(t,n){i?c(t,n):u(t,n)},Myna.cache.remove=function(t){i?a(t):o(t)}}.call(this),function(){Myna.Variant=function(){function t(t,n){var e,i;this.name=t,null==n&&(n={}),this.settings=new Myna.Settings(null!=(e=n.settings)?e:{}),this.weight=function(){if(null!=(i=n.weight))return i;throw"no weight provided"}(),this.views=0,this.reward=0}return t}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Experiment=function(){function n(n){var e,i,r,s,o,a,u,c;null==n&&(n={}),this.loadAndSave=t(this.loadAndSave,this),this.save=t(this.save,this),this.load=t(this.load,this),this.clearStickyReward=t(this.clearStickyReward,this),this.saveStickyReward=t(this.saveStickyReward,this),this.loadStickyReward=t(this.loadStickyReward,this),this.clearStickySuggestion=t(this.clearStickySuggestion,this),this.saveStickySuggestion=t(this.saveStickySuggestion,this),this.loadStickySuggestion=t(this.loadStickySuggestion,this),this.clearLastSuggestion=t(this.clearLastSuggestion,this),this.loadLastSuggestion=t(this.loadLastSuggestion,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.randomVariant=t(this.randomVariant,this),this.reward=t(this.reward,this),this.suggest=t(this.suggest,this),this.totalWeight=t(this.totalWeight,this),this.sticky=t(this.sticky,this),this.uuid=null!=(s=n.uuid)?s:Myna.error("Myna.Experiment.constructor","no UUID in options",n),this.name=null!=(o=n.name)?o:"Unnamed experiment",this.settings=new Myna.Settings(null!=(a=n.settings)?a:{}),this.variants={},c=null!=(u=n.variants)?u:{};for(i in c)e=c[i],r=new Myna.Variant(i,e),this.variants[i]=r}return n.prototype.sticky=function(){return!!this.settings.get("myna.sticky",!0)},n.prototype.totalWeight=function(){var t,n,e,i;t=0,i=this.variants;for(n in i)e=i[n],t+=e.weight;return t},n.prototype.suggest=function(t,n){var e,i;null==t&&(t=function(){}),null==n&&(n=function(){}),Myna.log("Myna.Experiment.suggest",this.uuid);try{return this.sticky()?null!=(i=this.loadStickySuggestion())?t(i):(i=this.randomVariant(),this.saveStickySuggestion(i),this.recordView(i),t(i)):(i=this.randomVariant(),this.saveLastSuggestion(i),this.recordView(i),t(i))}catch(r){return e=r,n(e)}},n.prototype.reward=function(t,n,e){var i,r;null==t&&(t=1),null==n&&(n=function(){}),null==e&&(e=function(){}),Myna.log("Myna.Experiment.reward",this.uuid,t);try{return this.sticky()?null!=(r=this.loadStickyReward())?n():null!=(r=this.loadLastSuggestion())?(this.saveStickyReward(r),this.clearLastSuggestion(),this.recordReward(r,t),n()):e():null!=(r=this.loadLastSuggestion())?(this.clearLastSuggestion(),this.recordReward(r,t),n()):e()}catch(s){return i=s,e(i)}},n.prototype.randomVariant=function(){var t,n,e,i,r;e=this.totalWeight(),n=Math.random()*e,r=this.variants;for(t in r)if(i=r[t],e-=i.weight,n>=e)return i;return null},n.prototype.recordView=function(t){return Myna.log("Myna.Experiment.recordView",this.uuid,t)},n.prototype.recordReward=function(t,n){return Myna.log("Myna.Experiment.recordReward",this.uuid,t,n)},n.prototype.loadLastSuggestion=function(){var t;return this.variants[null!=(t=Myna.cache.load(this.uuid))?t.lastSuggestion:void 0]},n.prototype.clearLastSuggestion=function(){return this.loadAndSave(function(t){return delete t.lastSuggestion,t})},n.prototype.loadStickySuggestion=function(){var t,n,e;return t=null!=(e=Myna.cache.load(this.uuid))?e.stickySuggestion:void 0,n=null!=t?this.variants[t]:null},n.prototype.saveStickySuggestion=function(t){return this.loadAndSave(function(n){return Myna.log("BAZ2",n),n.stickySuggestion=t.name,n})},n.prototype.clearStickySuggestion=function(){return this.loadAndSave(function(t){return t.stickySuggestion=null,t})},n.prototype.loadStickyReward=function(){var t;return this.variants[null!=(t=Myna.cache.load(this.uuid))?t.stickyReward:void 0]},n.prototype.saveStickyReward=function(t){return this.loadAndSave(function(n){return n.stickyReward=t.name,n})},n.prototype.clearStickyReward=function(){return this.loadAndSave(function(t){return t.stickyReward=null,t})},n.prototype.load=function(){return Myna.cache.load(this.uuid)},n.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},n.prototype.loadAndSave=function(t){var n;return Myna.cache.save(this.uuid,t(null!=(n=Myna.cache.load(this.uuid))?n:{}))},n}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Client=function(){function n(n){var e,i,r,s,o,a,u,c;for(null==n&&(n={}),this.reward=t(this.reward,this),this.suggest=t(this.suggest,this),this.apiRoot=null!=(o=n.apiRoot)?o:"//api.mynaweb.com",this.apiKey=null!=(a=n.apiKey)?a:Myna.error("Myna.Client.constructor","no apiKey in options",n),this.cache=new Myna.Settings,this.experiments={},c=null!=(u=n.experiments)?u:[],r=0,s=c.length;s>r;r++)i=c[r],e=new Myna.Experiment(i),this.experiments[e.uuid]=e}return n.prototype.suggest=function(t,n,e){return null==n&&(n=function(){}),null==e&&(e=function(){}),this.experiments[t].suggest(n,e)},n.prototype.reward=function(t,n,e,i){return null==n&&(n=1),null==e&&(e=function(){}),null==i&&(i=function(){}),this.experiments[t].reward(n,e,i)},n}()}.call(this);