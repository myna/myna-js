(function(){var t,n,e=[].slice;null==(t=window.Myna)&&(window.Myna={}),Myna.debug=!0,Myna.log=function(){var t,n;t=arguments.length>=1?e.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.log(t)},Myna.error=function(){var t,n;throw t=arguments.length>=1?e.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.error(t),t},Myna.extend=function(){var t,n,r,a,i,o,s;for(t=arguments[0],r=arguments.length>=2?e.call(arguments,1):[],o=0,s=r.length;s>o;o++){a=r[o];for(n in a)i=a[n],t[n]=i}return t},Myna.deleteKeys=function(){var t,n,r,a,i,o;for(a=arguments[0],r=arguments.length>=2?e.call(arguments,1):[],t=Myna.extend({},a),i=0,o=r.length;o>i;i++)n=r[i],delete t[n];return t},Myna.dateToString=function(t){var n,e,r,a,i,o,s,u;return Date.prototype.toISOString?t.toISOString():(o=function(t,n){var e;for(e=""+t;n>e.length;)e="0"+e;return e},u=o(t.getUTCFullYear(),4),i=o(t.getUTCMonth()+1,2),n=o(t.getUTCDate(),2),e=o(t.getUTCHours(),2),a=o(t.getUTCMinutes(),2),s=o(t.getUTCSeconds(),2),r=o(t.getUTCMilliseconds(),2),""+u+"-"+i+"-"+n+"T"+e+":"+a+":"+s+"."+r+"Z")},Myna.problem=function(t){return t},Myna.$=null!=(n=window.jQuery)?n:null}).call(this),function(){Myna.jsonp={callbacks:{},counter:0,request:function(t){var n,e,r,a,i,o,s,u,l,c,h,y,d,p,g,f,v,w,m;null==t&&(t={}),d=null!=(g=t.url)?g:Myna.error("Myna.jsonp.request","no url in options",t),l=null!=(f=t.success)?f:function(){},e=null!=(v=t.error)?v:function(){},c=null!=(w=t.timeout)?w:0,o=null!=(m=t.params)?m:{},n="callback"+Myna.jsonp.counter++,s=!1,y=""+d+"?";for(r in o)p=o[r],y+=""+r+"="+p+"&";y+="callback=Myna.jsonp.callbacks."+n,Myna.log("Myna.jsonp.request",y,l,e,c),u=document.createElement("script"),u.setAttribute("type","text/javascript"),u.setAttribute("async","true"),u.setAttribute("src",y),u.setAttribute("class","myna-jsonp"),u.setAttribute("data-callback",n),u.onload=u.onreadystatechange=function(){return Myna.jsonp.remove(n,u)},i=function(){return s?Myna.log("Myna.jsonp.request.onTimeout",n,c,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onTimeout",n,c),Myna.jsonp.remove(n,u),e({typename:"problem",subtype:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:n}]}))},h=c>0?window.setTimeout(i,c):null,a=function(t){return s?Myna.log("Myna.jsonp.request.onComplete",n,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onComplete",n,t.typename,"problem"===t.typename,t),window.clearTimeout(h),Myna.jsonp.remove(n,u),"problem"===t.typename?e(t):l(t))},Myna.jsonp.callbacks[n]=a,document.getElementsByTagName("head")[0].appendChild(u)},remove:function(t,n){var e;if(null==t&&(t=null),null==n&&(n=null),e=null!=n?n.readyState:void 0,!e||"complete"===e||"loaded"===e)try{n&&(n.onload=null,n.parentNode.removeChild(n))}finally{t&&delete Myna.jsonp.callbacks[t]}}}}.call(this),function(){var t,n,e,r,a,i=function(t,n){return function(){return t.apply(n,arguments)}},o={}.hasOwnProperty,s=function(t,n){function e(){this.constructor=t}for(var r in n)o.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};e=function(){function t(t){null==t&&(t=null),this.next=t}return t}(),r=function(t){function n(t){this.set=i(this.set,this),this.get=i(this.get,this),this.path=i(this.path,this),n.__super__.constructor.call(this,t)}return s(n,t),n.prototype.path=function(){return this.next.path().substring(1)},n.prototype.get=function(t){return this.next.get(t)},n.prototype.set=function(t,n){return this.next.set(t,n)},n}(e),t=function(t){function n(t,e){this.set=i(this.set,this),this.get=i(this.get,this),this.path=i(this.path,this),n.__super__.constructor.call(this,t),this.name=e}return s(n,t),n.prototype.path=function(){return"."+this.name+this.next.path()},n.prototype.get=function(t){return this.next.get(null!=t?t[this.name]:void 0)},n.prototype.set=function(t,n){var e,r,a;e={};for(r in t)a=t[r],e[r]=a;return e[this.name]=this.next.set(e[this.name],n),e},n}(e),n=function(t){function n(){n.__super__.constructor.call(this,null)}return s(n,t),n.prototype.path=function(){return""},n.prototype.get=function(t){return t},n.prototype.set=function(t,n){return n},n}(e),a=new n,Myna.Settings=function(){function n(t){null==t&&(t={}),this.toJson=i(this.toJson,this),this.parse=i(this.parse,this),this.set=i(this.set,this),this.get=i(this.get,this),this.data={},this.set(t)}return n.prototype.get=function(t,n){var e,r;return null==n&&(n=null),e=null!=(r=this.parse(t).get(this.data))?r:n,Myna.log("Myna.Settings.get",t,e),e},n.prototype.set=function(){var t,n,e;switch(arguments.length){case 0:Myna.error("Myna.Settings.set","not enough arguments",arguments);break;case 1:e=arguments[0];for(t in e)n=e[t],Myna.log("Myna.Settings.set",t,n),this.data=this.parse(t).set(this.data,n);break;default:t=arguments[0],n=arguments[1],Myna.log("Myna.Settings.set",t,n),this.data=this.parse(t).set(this.data,n)}return this},n.prototype.parse=function(n){var e,i,o,s;for(e=a,s=n.split("."),o=s.length-1;o>=0;o+=-1)i=s[o],e=new t(e,i);return new r(e)},n.prototype.toJson=function(){return this.data},n}()}.call(this),function(){var t,n,e,r,a,i,o,s,u,l;null==(l=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return e=t,!1}}(),Myna.cache.localStorageEnabled=!0,a=function(t){var n;if(n=window.localStorage.getItem("myna-"+t),null==n)return null;try{return JSON.parse(n)}catch(r){return e=r,null}},u=function(t,n){null!=n?window.localStorage.setItem("myna-"+t,JSON.stringify(n)):window.localStorage.removeItem("myna-"+t)},o=function(t){window.localStorage.removeItem("myna-"+t)},n=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return 0===t.indexOf('"')?JSON.parse(t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(t),JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},s=function(t,e,r){var a,i,o,s;null==r&&(r=365),s="myna-"+t+"="+n(e),i=r?(a=new Date,a.setTime(a.getTime()+1e3*60*60*24*r),"; expires="+a.toGMTString()):"",o="; path=/",document.cookie=""+s+i+o},r=function(n){var e,r,a,i,o,s,u,l;for(o="myna-"+n+"=",i=function(t){var n;return n=t.indexOf(o),n>=0&&t.substring(0,n).match("^\\s*$")},r=function(t){var n;return n=t.indexOf(o),t.substring(n+o.length,t.length)},a=document.cookie.split(";"),u=0,l=a.length;l>u;u++)if(e=a[u],i(e)&&null!=(s=r(e)))return t(s);return null},i=function(t){s(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?a(t):r(t)},Myna.cache.save=function(t,n){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,n):s(t,n)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?o(t):i(t)}}.call(this),function(){Myna.Variant=function(){function t(t){var n,e,r;null==t&&(t={}),this.id=null!=(n=t.id)?n:Myna.error("Myna.Variant.constructor","no id in options",t),this.weight=null!=(e=t.weight)?e:Myna.error("Myna.Variant.constructor","no weight in options",t),this.settings=new Myna.Settings(null!=(r=t.settings)?r:{})}return t}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n=[].slice;Myna.Events=function(){function e(){this.off=t(this.off,this),this.on=t(this.on,this),this.triggerAsync=t(this.triggerAsync,this),this.trigger=t(this.trigger,this),this.eventHandlers={}}return e.prototype.trigger=function(){var t,e,r,a,i,o,s,u;for(r=arguments[0],t=arguments.length>=2?n.call(arguments,1):[],Myna.log.apply(Myna,["Myna.Events.trigger",r].concat(n.call(t))),e=!1,u=null!=(s=this.eventHandlers[r])?s:[],i=0,o=u.length;o>i;i++)a=u[i],e=e||a.apply(this,t)===!1;return e?!1:void 0},e.prototype.triggerAsync=function(){var t,e,r,a,i,o,s,u=this;return r=arguments[0],t=arguments.length>=4?n.call(arguments,1,o=arguments.length-2):(o=1,[]),a=arguments[o++],e=arguments[o++],Myna.log.apply(Myna,["Myna.Events.triggerAsync",r].concat(n.call(t))),i=function(r){var o,s;return Myna.log("Myna.Events.triggerAsync.triggerAll",r),0===r.length?a():(o=r[0],s=r.length>=2?n.call(r,1):[],o.call.apply(o,[u].concat(n.call(t),[function(){return i(s)}],[e])))},i(null!=(s=this.eventHandlers[r])?s:[])},e.prototype.on=function(t,n){var e;return this.eventHandlers[t]=(null!=(e=this.eventHandlers[t])?e:[]).concat([n]),Myna.log("Myna.Events.on",t,n,this.eventHandlers[t])},e.prototype.off=function(t,n){var e;switch(null==n&&(n=null),arguments.length){case 0:this.eventHandlers={};break;case 1:delete this.eventHandlers[arguments[0]];break;default:t=arguments[0],n=arguments[1],this.eventHandlers[t]=function(){var r,a,i,o;for(i=this.eventHandlers[t],o=[],r=0,a=i.length;a>r;r++)e=i[r],e!==n&&o.push(e);return o}.call(this)}return Myna.log("Myna.Events.off",t,n,this.eventHandlers[t])},e}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var a in e)n.call(e,a)&&(t[a]=e[a]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},r=[].slice;Myna.BaseExperiment=function(n){function a(n){var e,r,i,o,s,u,l,c;for(null==n&&(n={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearVariant=t(this.clearVariant,this),this.saveVariant=t(this.saveVariant,this),this.loadVariant=t(this.loadVariant,this),this.clearLastReward=t(this.clearLastReward,this),this.saveLastReward=t(this.saveLastReward,this),this.loadLastReward=t(this.loadLastReward,this),this.clearLastView=t(this.clearLastView,this),this.saveLastView=t(this.saveLastView,this),this.loadLastView=t(this.loadLastView,this),this.randomVariant=t(this.randomVariant,this),this.totalWeight=t(this.totalWeight,this),this.saveVariantFromReward=t(this.saveVariantFromReward,this),this.rewardVariant=t(this.rewardVariant,this),this.loadVariantsForReward=t(this.loadVariantsForReward,this),this.reward=t(this.reward,this),this.saveVariantFromView=t(this.saveVariantFromView,this),this.viewVariant=t(this.viewVariant,this),this.loadVariantsForView=t(this.loadVariantsForView,this),this.view=t(this.view,this),this.loadVariantsForSuggest=t(this.loadVariantsForSuggest,this),this.suggest=t(this.suggest,this),a.__super__.constructor.call(this,n),Myna.log("Myna.BaseExperiment.constructor",n),this.uuid=null!=(o=n.uuid)?o:Myna.error("Myna.BaseExperiment.constructor",this.id,"no uuid in options",n),this.id=null!=(s=n.id)?s:Myna.error("Myna.BaseExperiment.constructor",this.id,"no id in options",n),this.settings=new Myna.Settings(null!=(u=n.settings)?u:{}),this.variants={},c=null!=(l=n.variants)?l:[],r=0,i=c.length;i>r;r++)e=c[r],this.variants[e.id]=new Myna.Variant(e)}return e(a,n),a.prototype.suggest=function(t,n){var e,r,a;null==t&&(t=function(){}),null==n&&(n=function(){}),e=this.loadVariantsForSuggest(),Myna.log("Myna.BaseExperiment.suggest",this.id,null!=(r=e.variant)?r.id:void 0,null!=(a=e.viewed)?a.id:void 0),this.viewVariant(Myna.extend({success:t,error:n},e))},a.prototype.loadVariantsForSuggest=function(){return{variant:this.randomVariant(),viewed:this.loadLastView()}},a.prototype.view=function(t,n,e){var r,a,i;null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForView(t),Myna.log("Myna.BaseExperiment.view",this.id,null!=(a=r.variant)?a.id:void 0,null!=(i=r.viewed)?i.id:void 0),this.viewVariant(Myna.extend({success:n,error:e},r))},a.prototype.loadVariantsForView=function(t){return{variant:t instanceof Myna.Variant?t:this.variants[t],viewed:null}},a.prototype.viewVariant=function(t){var n,e,r,a,i,o;r=t.variant,a=t.viewed,e=null!=(i=t.success)?i:function(){},n=null!=(o=t.error)?o:function(){},Myna.log("Myna.BaseExperiment.viewVariant",this.id,null!=r?r.id:void 0,null!=a?a.id:void 0),null!=a?this.trigger("beforeView",a,!1)!==!1&&(e.call(this,a,!1),this.trigger("view",a,!1)):null!=r?this.trigger("beforeView",r,!0)!==!1&&(this.saveVariantFromView(r),e.call(this,r,!0),this.trigger("view",r,!0),this.trigger("recordView",r)):n(Myna.problem("no-variant"))},a.prototype.saveVariantFromView=function(t){return this.saveLastView(t),this.clearLastReward()},a.prototype.reward=function(t,n,e){var r,a,i;null==t&&(t=1),null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForReward(),Myna.log("Myna.BaseExperiment.reward",this.id,null!=(a=r.variant)?a.id:void 0,null!=(i=r.rewarded)?i.id:void 0,t),this.rewardVariant(Myna.extend({amount:t,success:n,error:e},r))},a.prototype.loadVariantsForReward=function(){return{variant:this.loadLastView(),rewarded:this.loadLastReward()}},a.prototype.rewardVariant=function(t){var n,e,a,i,o,s,u,l,c=this;null==t&&(t={}),Myna.log("Myna.BaseExperiment.rewardVariant",this.id,t),o=t.variant,a=t.rewarded,n=null!=(s=t.amount)?s:1,i=null!=(u=t.success)?u:function(){},e=null!=(l=t.error)?l:function(){},null!=a?this.trigger("beforeReward",a,n,!1)!==!1&&(i.call(this,a,n,!1),this.trigger("reward",a,n,!1)):null!=o?this.trigger("beforeReward",o,n,!0)!==!1&&this.triggerAsync("recordReward",o,n,function(){return c.saveVariantFromReward(o),i.call(c,o,n,!0),c.trigger("reward",o,n,!0)},function(){var t;return t=arguments.length>=1?r.call(arguments,0):[],e.call.apply(e,[c].concat(r.call(t)))}):e(Myna.problem("no-variant"))},a.prototype.saveVariantFromReward=function(t){return this.clearLastView(),this.saveLastReward(t)},a.prototype.totalWeight=function(){var t,n,e,r;t=0,r=this.variants;for(n in r)e=r[n],t+=e.weight;return t},a.prototype.randomVariant=function(){var t,n,e,r,a;e=this.totalWeight(),n=Math.random()*e,a=this.variants;for(t in a)if(r=a[t],e-=r.weight,n>=e)return Myna.log("Myna.BaseExperiment.randomVariant",this.id,r.id),r;return Myna.log("Myna.BaseExperiment.randomVariant",this.id,null),null},a.prototype.loadLastView=function(){return this.loadVariant("lastView")},a.prototype.saveLastView=function(t){return this.saveVariant("lastView",t),this.clearVariant("lastReward")},a.prototype.clearLastView=function(){return this.clearVariant("lastView")},a.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},a.prototype.saveLastReward=function(t){return this.saveVariant("lastReward",t)},a.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},a.prototype.loadVariant=function(t){var n,e;return n=null!=(e=this.load())?e[t]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",this.id,t,n),null!=n?this.variants[n]:null},a.prototype.saveVariant=function(t,n){var e=this;return this.loadAndSave(function(r){return Myna.log("Myna.BaseExperiment.saveVariant",e.id,t,n,r),null!=n?r[t]=n.id:delete r[t],r})},a.prototype.clearVariant=function(t){return this.saveVariant(t,null)},a.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},a.prototype.load=function(){return Myna.cache.load(this.uuid)},a.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},a}(Myna.Events)}.call(this),function(){var t,n=function(t,n){return function(){return t.apply(n,arguments)}},e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var a in n)e.call(n,a)&&(t[a]=n[a]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Experiment=function(e){function a(){return this.clearStickyReward=n(this.clearStickyReward,this),this.saveStickyReward=n(this.saveStickyReward,this),this.loadStickyReward=n(this.loadStickyReward,this),this.clearStickySuggestion=n(this.clearStickySuggestion,this),this.saveStickySuggestion=n(this.saveStickySuggestion,this),this.loadStickySuggestion=n(this.loadStickySuggestion,this),this.unstick=n(this.unstick,this),this.saveVariantFromReward=n(this.saveVariantFromReward,this),this.loadVariantsForReward=n(this.loadVariantsForReward,this),this.saveVariantFromView=n(this.saveVariantFromView,this),this.loadVariantsForView=n(this.loadVariantsForView,this),this.loadVariantsForSuggest=n(this.loadVariantsForSuggest,this),this.sticky=n(this.sticky,this),t=a.__super__.constructor.apply(this,arguments)}return r(a,e),a.prototype.sticky=function(){return!!this.settings.get("myna.js.sticky",!0)},a.prototype.loadVariantsForSuggest=function(){var t;return this.sticky()?(t=this.loadStickySuggestion(),{variant:null!=t?t:this.randomVariant(),viewed:t}):a.__super__.loadVariantsForSuggest.call(this)},a.prototype.loadVariantsForView=function(t){return a.__super__.loadVariantsForView.call(this,t)},a.prototype.saveVariantFromView=function(t){return this.sticky()&&this.saveStickySuggestion(t),a.__super__.saveVariantFromView.call(this,t)},a.prototype.loadVariantsForReward=function(){return this.sticky()?{variant:this.loadLastView(),rewarded:this.loadStickyReward()}:a.__super__.loadVariantsForReward.call(this)},a.prototype.saveVariantFromReward=function(t){return this.sticky()&&this.saveStickyReward(t),a.__super__.saveVariantFromReward.call(this,t)},a.prototype.unstick=function(){return Myna.log("Myna.Experiment.unstick",this.id),this.clearLastView(),this.clearLastReward(),this.clearStickySuggestion(),this.clearStickyReward()},a.prototype.loadStickySuggestion=function(){return this.loadVariant("stickySuggestion")},a.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t),this.clearVariant("stickyReward")},a.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},a.prototype.loadStickyReward=function(){return this.loadVariant("stickyReward")},a.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},a.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},a}(Myna.BaseExperiment)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var a in e)n.call(e,a)&&(t[a]=e[a]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},r=[].slice;Myna.Recorder=function(n){function a(n){var e,r,i,o,s;null==n&&(n={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearQueuedEvents=t(this.clearQueuedEvents,this),this.requeueEvents=t(this.requeueEvents,this),this.queueEvent=t(this.queueEvent,this),this.queuedEvents=t(this.queuedEvents,this),this.sync=t(this.sync,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),a.__super__.constructor.call(this,n),Myna.log("Myna.Recorder.constructor",n),this.apiKey=null!=(e=n.apiKey)?e:Myna.error("Myna.Recorder.constructor","no apiKey in options",n),this.apiRoot=null!=(r=n.apiRoot)?r:"//api.mynaweb.com",this.storageKey=null!=(i=n.storageKey)?i:"myna",this.timeout=null!=(o=n.timeout)?o:1e3,this.autoSync=null!=(s=n.autoSync)?s:!0,this.semaphore=0,this.waiting=[]}return e(a,n),a.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.Recorder.listenTo",t.id),t.on("recordView",function(e,r,a){return n.recordView(t,e,r,a)}),t.on("recordReward",function(e,r,a,i){return n.recordReward(t,e,r,a,i)})},a.prototype.recordView=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),Myna.log("Myna.Recorder.recordView",t.id,n.id),this.queueEvent({typename:"view",experiment:t.uuid,variant:n.id,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(e,r):e()},a.prototype.recordReward=function(t,n,e,r,a){return null==r&&(r=function(){}),null==a&&(a=function(){}),Myna.log("Myna.Recorder.recordReward",t.id,n.id,e),this.queueEvent({typename:"reward",experiment:t.uuid,variant:n.id,amount:e,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(r,a):r()},a.prototype.sync=function(t,n){var e,a,i,o,s,u=this;return null==t&&(t=function(){}),null==n&&(n=function(){}),this.waiting.push({success:t,error:n}),this.semaphore>0?Myna.log("Myna.Recorder.sync","queued"):(this.semaphore++,s=this.waiting,this.waiting=[],a=function(){var t;return t=u.clearQueuedEvents(),Myna.log("Myna.Recorder.sync.start",t,s.length),u.trigger("beforeSync",t)===!1?u.requeueEvents(t):i(t,[],[])},i=function(t,n,a){var i,s;return Myna.log("Myna.Recorder.sync.syncAll",t,n,a),0===t.length?e(n,a):(i=t[0],s=t.length>=2?r.call(t,1):[],o(i,s,n,a))},o=function(t,n,e,r){var a;return Myna.log("Myna.Recorder.sync.syncOne",t,n,e,r),a=Myna.deleteKeys(t,"experiment"),Myna.jsonp.request({url:""+u.apiRoot+"/v2/experiment/"+t.experiment+"/record",success:function(){return i(n,e.concat([t]),r)},error:function(){return i(n,e,r.concat([t]))},timeout:u.timeout,params:Myna.extend({},a,{apikey:u.apiKey})})},e=function(t,n){var e,r,a,i,o;if(Myna.log("Myna.Recorder.sync.finish",t,n),n.length>0)for(u.requeueEvents(n),r=0,i=s.length;i>r;r++)e=s[r],e.error(t,n);else for(a=0,o=s.length;o>a;a++)e=s[a],e.success(t,n);return u.trigger("afterSync",t,n),u.semaphore--,u.waiting.length>0?u.sync():void 0},a())},a.prototype.queuedEvents=function(){var t,n;return t=null!=(n=this.load().queuedEvents)?n:[],Myna.log("Myna.Recorder.queuedEvents",t),t},a.prototype.queueEvent=function(t){return Myna.log("Myna.Recorder.queueEvent",t),this.loadAndSave(function(n){var e;return n.queuedEvents=(null!=(e=n.queuedEvents)?e:[]).concat([t]),n})},a.prototype.requeueEvents=function(t){return Myna.log("Myna.Recorder.requeueEvents",t),this.loadAndSave(function(n){var e;return n.queuedEvents=t.concat(null!=(e=n.queuedEvents)?e:[]),n})},a.prototype.clearQueuedEvents=function(){var t;return Myna.log("Myna.Recorder.clearQueuedEvents"),t=[],this.loadAndSave(function(n){var e;return t=null!=(e=n.queuedEvents)?e:[],delete n.queuedEvents,n}),t},a.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},a.prototype.load=function(){return Myna.cache.load(this.storageKey)},a.prototype.save=function(t){return Myna.cache.save(this.storageKey,t)},a}(Myna.Events)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Client=function(){function n(n){var e,r,a,i,o,s;for(null==n&&(n={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),Myna.log("Myna.Client.constructor",n),this.experiments={},s=null!=(o=n.experiments)?o:[],a=0,i=s.length;i>a;a++)e=s[a],r=e instanceof Myna.Experiment?e:new Myna.Experiment(e),this.experiments[r.id]=r}return n.prototype.suggest=function(t,n,e){return null==n&&(n=function(){}),null==e&&(e=function(){}),this.experiments[t].suggest(n,e)},n.prototype.view=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].view(n,e,r)},n.prototype.reward=function(t,n,e,r){return null==n&&(n=1),null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].reward(n,e,r)},n}()}.call(this),function(){Myna.initLocal=function(t){var n,e,r,a,i,o,s,u,l,c,h,y;if(Myna.log("Myna.initLocal",t),n=null!=(u=t.apiKey)?u:Myna.error("Myna.initLocal","no apiKey in options",t),e=null!=(l=t.apiRoot)?l:"//api.mynaweb.com",a=null!=(c=t.debug)?c:"#debug"===window.location.hash,i=null!=(h=t.experiments)?h:[],r=new Myna.Client({apiKey:n,apiRoot:e,experiments:i}),a)r.toolbar=new Myna.Toolbar(r),Myna.$(r.toolbar.init);else{r.recorder=new Myna.Recorder(t),y=r.experiments;for(s in y)o=y[s],r.records.listenTo(o)}return r},Myna.initApi=function(t){var n,e,r,a,i,o,s,u;return Myna.log("Myna.initRemote",t),n=null!=(i=t.apiKey)?i:Myna.error("Myna.Client.initApi","no apiKey in options",t),e=null!=(o=t.apiRoot)?o:"//api.mynaweb.com",a=null!=(s=t.success)?s:function(){},r=null!=(u=t.error)?u:function(){},Myna.jsonp.request({url:""+e+"/v2/experiment",params:{apikey:n},success:function(t){return Myna.log("Myna.initRemote","response",t),a(Myna.initLocal({apiKey:n,apiRoot:e,experiments:t.results}))},error:r})}}.call(this);