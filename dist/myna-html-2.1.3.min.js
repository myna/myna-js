(function(){var t,n,e,r=[].slice;null==(t=window.Myna)&&(window.Myna={}),null==(n=Myna.debug)&&(Myna.debug=!1),Myna.log=function(){var t,n;t=arguments.length>=1?r.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.log(t)},Myna.error=function(){var t,n;throw t=arguments.length>=1?r.call(arguments,0):[],Myna.debug&&null!=(n=window.console)&&n.error(t),t},Myna.trim=function(t){return null===t?"":t.replace(/^\s+|\s+$/g,"")},Myna.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Myna.isObject=function(t){return t===Object(t)},Myna.extend=function(){var t,n,e,i,a,o,s;for(t=arguments[0],e=arguments.length>=2?r.call(arguments,1):[],o=0,s=e.length;s>o;o++){i=e[o];for(n in i)a=i[n],t[n]=a}return t},Myna.deleteKeys=function(){var t,n,e,i,a,o;for(i=arguments[0],e=arguments.length>=2?r.call(arguments,1):[],t=Myna.extend({},i),a=0,o=e.length;o>a;a++)n=e[a],delete t[n];return t},Myna.dateToString=function(t){var n,e,r,i,a,o,s,u;return Date.prototype.toISOString?t.toISOString():(o=function(t,n){var e;for(e=""+t;n>e.length;)e="0"+e;return e},u=o(t.getUTCFullYear(),4),a=o(t.getUTCMonth()+1,2),n=o(t.getUTCDate(),2),e=o(t.getUTCHours(),2),i=o(t.getUTCMinutes(),2),s=o(t.getUTCSeconds(),2),r=o(t.getUTCMilliseconds(),2),""+u+"-"+a+"-"+n+"T"+e+":"+i+":"+s+"."+r+"Z")},Myna.problem=function(t){return t},Myna.redirect=function(t){return window.location.replace(t)},Myna.$=null!=(e=window.jQuery)?e:null}).call(this),function(){Myna.parseHashParams=function(t){var n,e,r,i,a,o,s,u;for(null==t&&(t=window.location.hash),t=t?"#"===t[0]?t.substring(1):t:"",n={},s=t.split("&"),a=0,o=s.length;o>a;a++)r=s[a],""!==r&&(u=r.split("="),e=u[0],i=u[1],n[decodeURIComponent(e)]=decodeURIComponent(null!=i?i:e));return Myna.log("parseHashParams",n),n},Myna.hashParams=Myna.parseHashParams(),Myna.hashParams.debug&&(Myna.debug=!0),Myna.preview=function(){return Myna.hashParams.preview?(Myna.cache.save("myna-preview",!0),!0):!!Myna.cache.load("myna-preview")},Myna.setPreview=function(t){Myna.cache.save("myna-preview",!!t)}}.call(this),function(){Myna.jsonp={callbacks:{},counter:0,createScriptElem:function(t,n){var e;return e=document.createElement("script"),e.setAttribute("type","text/javascript"),e.setAttribute("async","true"),e.setAttribute("src",t),e.setAttribute("class","myna-jsonp"),e.setAttribute("data-callback",n),e.onload=e.onreadystatechange=function(){return Myna.jsonp.remove(n,e)},e},request:function(t){var n,e,r,i,a,o,s,u,l,c,h,y,d,p,g,f,v,M,w;null==t&&(t={}),d=null!=(g=t.url)?g:Myna.error("Myna.jsonp.request","no url in options",t),l=null!=(f=t.success)?f:function(){},e=null!=(v=t.error)?v:function(){},c=null!=(M=t.timeout)?M:1e4,o=null!=(w=t.params)?w:{},n="callback"+Myna.jsonp.counter++,s=!1,y=""+d+"?";for(r in o)p=o[r],y+=""+r+"="+p+"&";y+="callback=Myna.jsonp.callbacks."+n,Myna.log("Myna.jsonp.request",y,l,e,c),u=Myna.jsonp.createScriptElem(y,n),a=function(){return s?Myna.log("Myna.jsonp.request.onTimeout",n,c,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onTimeout",n,c),Myna.jsonp.remove(n,u),e({typename:"problem",status:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:n}]}))},h=c>0?window.setTimeout(a,c):null,i=function(t){return s?Myna.log("Myna.jsonp.request.onComplete",n,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onComplete",n,t.typename,"problem"===t.typename,t),window.clearTimeout(h),Myna.jsonp.remove(n,u),"problem"===t.typename?e(t):l(t))},Myna.jsonp.callbacks[n]=i,document.getElementsByTagName("head")[0].appendChild(u)},remove:function(t,n){var e;if(null==t&&(t=null),null==n&&(n=null),e=null!=n?n.readyState:void 0,!e||"complete"===e||"loaded"===e)try{n&&(n.onload=null,n.parentNode.removeChild(n))}finally{t&&delete Myna.jsonp.callbacks[t]}}}}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n=[].slice;Myna.Events=function(){function e(){this.off=t(this.off,this),this.on=t(this.on,this),this.triggerAsync=t(this.triggerAsync,this),this.trigger=t(this.trigger,this),this.eventHandlers={}}return e.prototype.trigger=function(){var t,e,r,i,a,o,s,u;for(r=arguments[0],t=arguments.length>=2?n.call(arguments,1):[],Myna.log.apply(Myna,["Myna.Events.trigger",r].concat(n.call(t))),e=!1,u=null!=(s=this.eventHandlers[r])?s:[],a=0,o=u.length;o>a;a++)i=u[a],e=e||i.apply(this,t)===!1;return e?!1:void 0},e.prototype.triggerAsync=function(){var t,e,r,i,a,o,s,u=this;return r=arguments[0],t=arguments.length>=4?n.call(arguments,1,o=arguments.length-2):(o=1,[]),i=arguments[o++],e=arguments[o++],Myna.log.apply(Myna,["Myna.Events.triggerAsync",r].concat(n.call(t))),a=function(r){var o,s;return Myna.log("Myna.Events.triggerAsync.triggerAll",r),0===r.length?i():(o=r[0],s=r.length>=2?n.call(r,1):[],o.call.apply(o,[u].concat(n.call(t),[function(){return a(s)}],[e])))},a(null!=(s=this.eventHandlers[r])?s:[])},e.prototype.on=function(t,n){var e;return this.eventHandlers[t]=(null!=(e=this.eventHandlers[t])?e:[]).concat([n]),Myna.log("Myna.Events.on",t,n,this.eventHandlers[t])},e.prototype.off=function(t,n){var e;switch(null==n&&(n=null),arguments.length){case 0:this.eventHandlers={};break;case 1:delete this.eventHandlers[arguments[0]];break;default:t=arguments[0],n=arguments[1],this.eventHandlers[t]=function(){var r,i,a,o;for(a=this.eventHandlers[t],o=[],r=0,i=a.length;i>r;r++)e=a[r],e!==n&&o.push(e);return o}.call(this)}return Myna.log("Myna.Events.off",t,n,this.eventHandlers[t])},e}()}.call(this),function(){"use strict";var t,n=function(t,n){return function(){return t.apply(n,arguments)}},e=[].slice,r={}.hasOwnProperty,i=function(t,n){function e(){this.constructor=t}for(var i in n)r.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};t=function(){function t(e){this.toString=n(this.toString,this),this.drop=n(this.drop,this),this.take=n(this.take,this),this.isPrefixOf=n(this.isPrefixOf,this),this.prefixes=n(this.prefixes,this),this.unset=n(this.unset,this),this.set=n(this.set,this),this.get=n(this.get,this),this.path=n(this.path,this),this.quote=n(this.quote,this),this.nodes="string"==typeof e?t.parse(e):e}return t.identifierRegex=/^[a-z_$][a-z0-9_$]*/i,t.integerRegex=/^[0-9]+/,t.completeIdentifierRegex=/^[a-z_$][a-z0-9_$]*$/i,t.permissiveIdentifierRegex=/^[^[.]+/,t.isValid=function(n){var e;try{return t.parse(n),!0}catch(r){return e=r,!1}},t.normalize=function(n){var e;try{return""+new t(n)}catch(r){return e=r,n}},t.parse=function(n){var e,r,i,a,o,s,u,l,c;return a=n,o=function(t){if(t>a.length)throw"bad settings path: "+n;a=a.substring(t)},u=function(t){var e;if(t>a.length)throw"bad settings path: "+n;return e=a.substring(0,t),a=a.substring(t),e},l=function(t){return a=a.substring(t.length),t},e=function(){var e;if(e=a.match(t.permissiveIdentifierRegex))return l(e[0]);throw"bad settings path: "+n},i=function(){var e;if(e=a.match(t.integerRegex))return parseInt(l(e[0]));throw"bad settings path: "+n},s=function(t){var n,e;for(o(1),n="",e=!1;!e;)a[0]===t?e=!0:"\\"===a[0]?(o(1),n+=u(1)):n+=u(1);return o(1),n},r=function(){var t;return o(1),t="'"===a[0]?s("'"):'"'===a[0]?s('"'):i(),o(1),t},c=function(){var t;for(t=[];a.length>0;)"."===a[0]?(o(1),t.push(e())):"["===a[0]?t.push(r()):t.push(e());return t},a=Myna.trim(a),""===a?[]:"."===a[0]||"["===a[0]?c():(a="."+a,c())},t.prototype.quote=function(t){return t.replace(/['\"\\]/g,function(t){return"\\"+t})},t.prototype.path=function(n){var e,r,i,a;for(null==n&&(n=this.nodes),e="",i=0,a=n.length;a>i;i++)r=n[i],e+="number"==typeof r?"["+r+"]":t.completeIdentifierRegex.test(r)?"."+r:'["'+this.quote(r)+'"]';return"."===e[0]?e.substring(1):e},t.prototype.get=function(t){var n,e,r,i;for(i=this.nodes,e=0,r=i.length;r>e;e++)n=i[e],t=null!=t?t[n]:void 0;return t},t.prototype.set=function(t,n){var r,i,a,o,s,u,l,c;if(null!=n){if(0===this.nodes.length)return n;for(o=t,c=this.nodes,r=c.length>=2?e.call(c,0,s=c.length-1):(s=0,[]),i=c[s++],u=0,l=r.length;l>u;u++)a=r[u],"object"!=typeof o[a]&&(o[a]={}),o=o[a];return o[i]=n,t}return this.unset(t)},t.prototype.unset=function(t){var n,r,i,a,o,s,u,l;if(0===this.nodes.length)return void 0;for(a=t,l=this.nodes,n=l.length>=2?e.call(l,0,o=l.length-1):(o=0,[]),r=l[o++],s=0,u=n.length;u>s;s++){if(i=n[s],null==a[i])return t;a=a[i]}return delete a[r],t},t.prototype.prefixes=function(){var t,n,e,r,i;for(e=this.nodes,t=[],n=r=1,i=e.length;i>=1?i>=r:r>=i;n=i>=1?++r:--r)t.push(this.path(e.slice(0,n)));return t},t.prototype.isPrefixOf=function(t){var n,e,r,i,a;if(n=this.nodes,e=t.nodes,n.length>e.length)return!1;for(r=i=0,a=n.length;a>=0?a>i:i>a;r=a>=0?++i:--i)if(n[r]!==e[r])return!1;return!0},t.prototype.take=function(n){return new t(_.take(this.nodes,n))},t.prototype.drop=function(n){return new t(_.drop(this.nodes,n))},t.prototype.toString=function(){return this.path()},t}.call(this),Myna.Settings=function(e){function r(t){null==t&&(t={}),this.toJSON=n(this.toJSON,this),this.triggerChange=n(this.triggerChange,this),this.paths=n(this.paths,this),this.pathValuePairs=n(this.pathValuePairs,this),this.unset=n(this.unset,this),this.set=n(this.set,this),this.get=n(this.get,this),r.__super__.constructor.call(this),this.data={},this.set(t)}return i(r,e),r.Path=t,r.defaultSetOptions={silent:!1},r.prototype.get=function(t,n){var e;return null==n&&(n=void 0),null!=(e=new Myna.Settings.Path(t).get(this.data))?e:n},r.prototype.set=function(){var t,n,e,r,i,a,o;if(0===arguments.length)throw["Myna.Settings.set","not enough arguments",arguments];if("object"==typeof arguments[0]){i=arguments[0],t=Myna.extend({},Myna.Settings.defaultSetOptions,null!=(o=arguments[1])?o:{}),r=[];for(e in i)a=i[e],n=new Myna.Settings.Path(e),this.data=n.set(this.data,a),r.push(n);t.silent||this.triggerChange(r)}else i={},i[arguments[0]]=arguments[1],t=arguments[2],this.set(i,t);return this},r.prototype.unset=function(t,n){var e;return e={},e[t]=void 0,this.set(e,n)},r.prototype.pathValuePairs=function(){var t,n,e;return t=[],n=function(t){return"."===t[0]?t.substring(1):t},e=function(r,i){var a,o,s,u,l,c,h;if(null==i&&(i=""),Myna.isArray(r)){for(c=[],s=u=0,l=r.length;l>u;s=++u)a=r[s],c.push(e(s,i+"["+a+"]"));return c}if(Myna.isObject(r)){h=[];for(o in r)s=r[o],h.push(e(s,i+"."+o));return h}return t.push({path:n(i),value:r})},e(this.data),t},r.prototype.paths=function(){return _.map(this.pathValuePairs(),function(t){return t.path})},r.prototype.triggerChange=function(t){var n,e,r,i,a,o,s;for(r=0,a=t.length;a>r;r++)for(n=t[r],s=n.prefixes(),i=0,o=s.length;o>i;i++)e=s[i],this.trigger("change:"+e,this.get(e));return this.trigger("change")},r.prototype.toJSON=function(t){return null==t&&(t={}),this.data},r}(Myna.Events)}.call(this),function(){var t,n,e,r,i,a,o,s,u,l;null==(l=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return e=t,!1}}(),Myna.cache.localStorageEnabled=!0,i=function(t){var n;if(n=window.localStorage.getItem("myna-"+t),null==n)return null;try{return JSON.parse(n)}catch(r){return e=r,null}},u=function(t,n){null!=n?window.localStorage.setItem("myna-"+t,JSON.stringify(n)):window.localStorage.removeItem("myna-"+t)},o=function(t){window.localStorage.removeItem("myna-"+t)},n=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return t=0===t.indexOf('"')?t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):t,JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},s=function(t,e,r){var i,a,o,s;null==r&&(r=365),s="myna-"+t+"="+n(e),a=r?(i=new Date,i.setTime(i.getTime()+1e3*60*60*24*r),"; expires="+i.toGMTString()):"",o="; path=/",document.cookie=""+s+a+o},r=function(n){var e,r,i,a,o,s,u,l;for(o="myna-"+n+"=",a=function(t){var n;return n=t.indexOf(o),n>=0&&t.substring(0,n).match("^\\s*$")},r=function(t){var n;return n=t.indexOf(o),t.substring(n+o.length,t.length)},i=document.cookie.split(";"),u=0,l=i.length;l>u;u++)if(e=i[u],a(e)&&null!=(s=r(e)))return t(s);return null},a=function(t){s(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?i(t):r(t)},Myna.cache.save=function(t,n){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,n):s(t,n)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?o(t):a(t)}}.call(this),function(){Myna.Variant=function(){function t(t){var n,e,r,i;null==t&&(t={}),this.id=null!=(n=t.id)?n:Myna.error("Myna.Variant.constructor","no id in options",t),this.name=null!=(e=t.name)?e:this.id,this.weight=null!=(r=t.weight)?r:Myna.error("Myna.Variant.constructor","no weight in options",t),this.settings=new Myna.Settings(null!=(i=t.settings)?i:{})}return t}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Myna.BaseExperiment=function(n){function r(n){var e,i,a,o,s,u,l,c;for(null==n&&(n={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearVariant=t(this.clearVariant,this),this.saveVariant=t(this.saveVariant,this),this.loadVariant=t(this.loadVariant,this),this.clearLastReward=t(this.clearLastReward,this),this.saveLastReward=t(this.saveLastReward,this),this.loadLastReward=t(this.loadLastReward,this),this.clearLastView=t(this.clearLastView,this),this.saveLastView=t(this.saveLastView,this),this.loadLastView=t(this.loadLastView,this),this.randomVariant=t(this.randomVariant,this),this.totalWeight=t(this.totalWeight,this),this.saveVariantFromReward=t(this.saveVariantFromReward,this),this.rewardVariant=t(this.rewardVariant,this),this.loadVariantsForReward=t(this.loadVariantsForReward,this),this.reward=t(this.reward,this),this.saveVariantFromView=t(this.saveVariantFromView,this),this.viewVariant=t(this.viewVariant,this),this.loadVariantsForView=t(this.loadVariantsForView,this),this.view=t(this.view,this),this.loadVariantsForSuggest=t(this.loadVariantsForSuggest,this),this.suggest=t(this.suggest,this),r.__super__.constructor.call(this,n),Myna.log("Myna.BaseExperiment.constructor",n),this.uuid=null!=(o=n.uuid)?o:Myna.error("Myna.BaseExperiment.constructor",this.id,"no uuid in options",n),this.id=null!=(s=n.id)?s:Myna.error("Myna.BaseExperiment.constructor",this.id,"no id in options",n),this.settings=new Myna.Settings(null!=(u=n.settings)?u:{}),this.variants={},c=null!=(l=n.variants)?l:[],i=0,a=c.length;a>i;i++)e=c[i],this.variants[e.id]=new Myna.Variant(e)}return e(r,n),r.prototype.suggest=function(t,n){var e,r,i;null==t&&(t=function(){}),null==n&&(n=function(){}),e=this.loadVariantsForSuggest(),Myna.log("Myna.BaseExperiment.suggest",this.id,null!=(r=e.variant)?r.id:void 0,null!=(i=e.viewed)?i.id:void 0),this.viewVariant(Myna.extend({success:t,error:n},e))},r.prototype.loadVariantsForSuggest=function(){return{variant:this.randomVariant(),viewed:this.loadLastView()}},r.prototype.view=function(t,n,e){var r,i,a;null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForView(t),Myna.log("Myna.BaseExperiment.view",this.id,null!=(i=r.variant)?i.id:void 0,null!=(a=r.viewed)?a.id:void 0),this.viewVariant(Myna.extend({success:n,error:e},r))},r.prototype.loadVariantsForView=function(t){return{variant:t instanceof Myna.Variant?t:this.variants[t],viewed:null}},r.prototype.viewVariant=function(t){var n,e,r,i,a,o;r=t.variant,i=t.viewed,e=null!=(a=t.success)?a:function(){},n=null!=(o=t.error)?o:function(){},Myna.log("Myna.BaseExperiment.viewVariant",this.id,null!=r?r.id:void 0,null!=i?i.id:void 0),null!=i?this.trigger("beforeView",i,!1)!==!1&&(e.call(this,i,!1),this.trigger("view",i,!1)):null!=r?this.trigger("beforeView",r,!0)!==!1&&(this.saveVariantFromView(r),e.call(this,r,!0),this.trigger("view",r,!0),this.trigger("recordView",r)):n(Myna.problem("no-variant"))},r.prototype.saveVariantFromView=function(t){return this.saveLastView(t),this.clearLastReward()},r.prototype.reward=function(t,n,e){var r,i,a;null==t&&(t=1),null==n&&(n=function(){}),null==e&&(e=function(){}),r=this.loadVariantsForReward(),Myna.log("Myna.BaseExperiment.reward",this.id,null!=(i=r.variant)?i.id:void 0,null!=(a=r.rewarded)?a.id:void 0,t),this.rewardVariant(Myna.extend({amount:t,success:n,error:e},r))},r.prototype.loadVariantsForReward=function(){return{variant:this.loadLastView(),rewarded:this.loadLastReward()}},r.prototype.rewardVariant=function(t){var n,e,r,i,a,o,s,u,l=this;null==t&&(t={}),Myna.log("Myna.BaseExperiment.rewardVariant",this.id,t),a=t.variant,r=t.rewarded,n=null!=(o=t.amount)?o:1,i=null!=(s=t.success)?s:function(){},e=null!=(u=t.error)?u:function(){},null!=r?this.trigger("beforeReward",r,n,!1)!==!1&&(i.call(this,r,n,!1),this.trigger("reward",r,n,!1)):null!=a?this.trigger("beforeReward",a,n,!0)!==!1&&this.triggerAsync("recordReward",a,n,function(){return l.saveVariantFromReward(a),i.call(l,a,n,!0),l.trigger("reward",a,n,!0)},function(){l.saveVariantFromReward(a),e.call(l)}):e(Myna.problem("no-variant"))},r.prototype.saveVariantFromReward=function(t){return this.clearLastView(),this.saveLastReward(t)},r.prototype.totalWeight=function(){var t,n,e,r;t=0,r=this.variants;for(n in r)e=r[n],t+=e.weight;return t},r.prototype.randomVariant=function(){var t,n,e,r,i;e=this.totalWeight(),n=Math.random()*e,i=this.variants;for(t in i)if(r=i[t],e-=r.weight,n>=e)return Myna.log("Myna.BaseExperiment.randomVariant",this.id,r.id),r;return Myna.log("Myna.BaseExperiment.randomVariant",this.id,null),null},r.prototype.loadLastView=function(){return this.loadVariant("lastView")},r.prototype.saveLastView=function(t){return this.saveVariant("lastView",t),this.clearVariant("lastReward")},r.prototype.clearLastView=function(){return this.clearVariant("lastView")},r.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},r.prototype.saveLastReward=function(t){return this.saveVariant("lastReward",t)},r.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},r.prototype.loadVariant=function(t){var n,e;return n=null!=(e=this.load())?e[t]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",this.id,t,n),null!=n?this.variants[n]:null},r.prototype.saveVariant=function(t,n){var e=this;return this.loadAndSave(function(r){return Myna.log("Myna.BaseExperiment.saveVariant",e.id,t,n,r),null!=n?r[t]=n.id:delete r[t],r})},r.prototype.clearVariant=function(t){return this.saveVariant(t,null)},r.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},r.prototype.load=function(){return Myna.cache.load(this.uuid)},r.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},r}(Myna.Events)}.call(this),function(){var t,n=function(t,n){return function(){return t.apply(n,arguments)}},e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Experiment=function(e){function i(){return this.clearStickyReward=n(this.clearStickyReward,this),this.saveStickyReward=n(this.saveStickyReward,this),this.loadStickyReward=n(this.loadStickyReward,this),this.clearStickySuggestion=n(this.clearStickySuggestion,this),this.saveStickySuggestion=n(this.saveStickySuggestion,this),this.loadStickySuggestion=n(this.loadStickySuggestion,this),this.unstick=n(this.unstick,this),this.saveVariantFromReward=n(this.saveVariantFromReward,this),this.loadVariantsForReward=n(this.loadVariantsForReward,this),this.saveVariantFromView=n(this.saveVariantFromView,this),this.loadVariantsForView=n(this.loadVariantsForView,this),this.loadVariantsForSuggest=n(this.loadVariantsForSuggest,this),this.sticky=n(this.sticky,this),t=i.__super__.constructor.apply(this,arguments)}return r(i,e),i.prototype.sticky=function(){return!!this.settings.get("myna.web.sticky",!0)},i.prototype.loadVariantsForSuggest=function(){var t;return t=this.loadStickySuggestion(),{variant:null!=t?t:this.randomVariant(),viewed:null!=t?t:null}},i.prototype.loadVariantsForView=function(t){return i.__super__.loadVariantsForView.call(this,t)},i.prototype.saveVariantFromView=function(t){return this.sticky()&&this.saveStickySuggestion(t),i.__super__.saveVariantFromView.call(this,t)},i.prototype.loadVariantsForReward=function(){return this.sticky()?{variant:this.loadLastView(),rewarded:this.loadStickyReward()}:i.__super__.loadVariantsForReward.call(this)},i.prototype.saveVariantFromReward=function(t){return this.sticky()&&this.saveStickyReward(t),i.__super__.saveVariantFromReward.call(this,t)},i.prototype.unstick=function(){return Myna.log("Myna.Experiment.unstick",this.id),this.clearLastView(),this.clearLastReward(),this.clearStickySuggestion(),this.clearStickyReward()},i.prototype.loadStickySuggestion=function(){return this.sticky()?this.loadVariant("stickySuggestion"):null},i.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t),this.clearVariant("stickyReward")},i.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},i.prototype.loadStickyReward=function(){return this.sticky()?this.loadVariant("stickyReward"):null},i.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},i.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},i}(Myna.BaseExperiment)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},r=[].slice;Myna.Recorder=function(n){function i(n){this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearQueuedEvents=t(this.clearQueuedEvents,this),this.requeueEvents=t(this.requeueEvents,this),this.queueEvent=t(this.queueEvent,this),this.queuedEvents=t(this.queuedEvents,this),this.sync=t(this.sync,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),this.init=t(this.init,this);var e,r;i.__super__.constructor.call(this),Myna.log("Myna.Recorder.constructor",n),this.client=n,this.apiKey=null!=(e=n.apiKey)?e:Myna.error("Myna.Recorder.constructor","no apiKey in options",options),this.apiRoot=null!=(r=n.apiRoot)?r:"//api.mynaweb.com",this.storageKey=n.settings.get("myna.web.storageKey","myna"),this.timeout=n.settings.get("myna.web.timeout",1e3),this.autoSync=n.settings.get("myna.web.autoSync",!0),this.semaphore=0,this.waiting=[]}return e(i,n),i.prototype.init=function(){var t,n,e,r;e=this.client.experiments,r=[];for(n in e)t=e[n],r.push(this.listenTo(t));return r},i.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.Recorder.listenTo",t.id),t.on("recordView",function(e,r,i){return n.recordView(t,e,r,i)}),t.on("recordReward",function(e,r,i,a){return n.recordReward(t,e,r,i,a)})},i.prototype.recordView=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),Myna.log("Myna.Recorder.recordView",t.id,n.id),this.queueEvent({typename:"view",experiment:t.uuid,variant:n.id,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(e,r):e()},i.prototype.recordReward=function(t,n,e,r,i){return null==r&&(r=function(){}),null==i&&(i=function(){}),Myna.log("Myna.Recorder.recordReward",t.id,n.id,e),this.queueEvent({typename:"reward",experiment:t.uuid,variant:n.id,amount:e,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(r,i):r()},i.prototype.sync=function(t,n){var e,i,a,o,s,u=this;return null==t&&(t=function(){}),null==n&&(n=function(){}),this.waiting.push({success:t,error:n}),this.semaphore>0?Myna.log("Myna.Recorder.sync","queued",this.waiting.length):(this.semaphore++,s=this.waiting,this.waiting=[],i=function(){var t;return t=u.clearQueuedEvents(),Myna.log("Myna.Recorder.sync.start",t,s.length),u.trigger("beforeSync",t)===!1?e([],[],t,!0):a(t,[],[],[])},a=function(t,n,i,a){var s,u;return Myna.log("Myna.Recorder.sync.syncAll",t,n,i,a),0===t.length?e(n,i,a):(s=t[0],u=t.length>=2?r.call(t,1):[],o(s,u,n,i,a))},o=function(t,n,e,r,i){var o;return Myna.log("Myna.Recorder.sync.syncOne",t,n,e,r,i),o=Myna.extend({},t,{apikey:u.apiKey}),o=Myna.deleteKeys(o,"experiment"),Myna.jsonp.request({url:""+u.apiRoot+"/v2/experiment/"+t.experiment+"/record",success:function(){return a(n,e.concat([t]),r,i)},error:function(o){return o.status&&o.status>=500?a(n,e,r,i.concat([t])):a(n,e,r.concat([t]),i)},timeout:u.timeout,params:o})},e=function(t,n,e,r){var i,a,o,l,c;if(null==r&&(r=!1),Myna.log("Myna.Recorder.sync.finish",t,n,e,u.waiting.length),e.length>0&&u.requeueEvents(e),n.length>0||e.length>0)for(a=0,l=s.length;l>a;a++)i=s[a],i.error(t,n,e);else for(o=0,c=s.length;c>o;o++)i=s[o],i.success(t,n,e);return r||u.trigger("sync",t,n,e),u.semaphore--,!r&&u.waiting.length>0?u.sync():void 0},i())},i.prototype.queuedEvents=function(){var t,n;return t=null!=(n=this.load().queuedEvents)?n:[],Myna.log("Myna.Recorder.queuedEvents",t),t},i.prototype.queueEvent=function(t){return Myna.log("Myna.Recorder.queueEvent",t),this.loadAndSave(function(n){var e;return n.queuedEvents=(null!=(e=n.queuedEvents)?e:[]).concat([t]),n})},i.prototype.requeueEvents=function(t){return Myna.log("Myna.Recorder.requeueEvents",t),this.loadAndSave(function(n){var e;return n.queuedEvents=t.concat(null!=(e=n.queuedEvents)?e:[]),n})},i.prototype.clearQueuedEvents=function(){var t;return Myna.log("Myna.Recorder.clearQueuedEvents"),t=[],this.loadAndSave(function(n){var e;return t=null!=(e=n.queuedEvents)?e:[],delete n.queuedEvents,n}),t},i.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},i.prototype.load=function(){return Myna.cache.load(this.storageKey)},i.prototype.save=function(t){return Myna.cache.save(this.storageKey,t)},i}(Myna.Events)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Myna.GoogleAnalytics=function(n){function r(n){this.rewardMultiplier=t(this.rewardMultiplier,this),this.eventName=t(this.eventName,this),this.enabled=t(this.enabled,this),this.rewardEvent=t(this.rewardEvent,this),this.viewEvent=t(this.viewEvent,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),this.init=t(this.init,this),Myna.log("Myna.GoogleAnalytics.constructor",n),this.client=n}return e(r,n),r.prototype.init=function(){var t,n,e,r;e=this.client.experiments,r=[];for(n in e)t=e[n],r.push(this.listenTo(t));return r},r.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.GoogleAnalytics.listenTo",t.id),t.on("recordView",function(e,r,i){return n.recordView(t,e,r,i)}),t.on("recordReward",function(e,r,i,a){return n.recordReward(t,e,r,i,a)})},r.prototype.recordView=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),Myna.log("Myna.GoogleAnalytics.recordView",t,n,e,r),this.enabled(t)&&"undefined"!=typeof _gaq&&null!==_gaq&&_gaq.push(this.viewEvent(t,n)),e()},r.prototype.recordReward=function(t,n,e,r,i){return null==r&&(r=function(){}),null==i&&(i=function(){}),Myna.log("Myna.GoogleAnalytics.recordReward",t,n,r,i),this.enabled(t)&&"undefined"!=typeof _gaq&&null!==_gaq&&_gaq.push(this.rewardEvent(t,n,e)),r()},r.prototype.viewEvent=function(t,n){return["_trackEvent","myna",this.eventName(t,"view"),n.id,null,!1]},r.prototype.rewardEvent=function(t,n,e){var r;return r=this.rewardMultiplier(t),["_trackEvent","myna",this.eventName(t,"reward"),n.id,Math.round(r*e),!0]},r.prototype.enabled=function(t){return t.settings.get("myna.web.googleAnalytics.enabled",!0)},r.prototype.eventName=function(t,n){var e;return null!=(e=t.settings.get("myna.web.googleAnalytics."+n+"Event"))?e:""+t.id+"-"+n},r.prototype.rewardMultiplier=function(t){return t.settings.get("myna.web.googleAnalytics.rewardMultiplier",100)},r}(Myna.Events)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Client=function(){function n(n){var e,r,i,a,o,s,u,l,c;for(null==n&&(n={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),Myna.log("Myna.Client.constructor",n),this.uuid=null!=(a=n.uuid)?a:null,this.apiKey=null!=(o=n.apiKey)?o:Myna.error("Myna.Deployment.constructor","no apiKey in options",n),this.apiRoot=null!=(s=n.apiRoot)?s:"//api.mynaweb.com",this.settings=new Myna.Settings(null!=(u=n.settings)?u:{}),this.experiments={},c=null!=(l=n.experiments)?l:[],r=0,i=c.length;i>r;r++)e=c[r],this.experiments[e.id]=e}return n.prototype.suggest=function(t,n,e){return null==n&&(n=function(){}),null==e&&(e=function(){}),this.experiments[t].suggest(n,e)},n.prototype.view=function(t,n,e,r){return null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].view(n,e,r)},n.prototype.reward=function(t,n,e,r){return null==n&&(n=1),null==e&&(e=function(){}),null==r&&(r=function(){}),this.experiments[t].reward(n,e,r)},n}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n=[].slice;Myna.Binder=function(){function e(n){this.createClickHandler=t(this.createClickHandler,this),this.bindGoal=t(this.bindGoal,this),this.bindRedirect=t(this.bindRedirect,this),this.bindBind=t(this.bindBind,this),this.bindHide=t(this.bindHide,this),this.bindShow=t(this.bindShow,this),this.unbind=t(this.unbind,this),this.bind=t(this.bind,this),this.detect=t(this.detect,this),this.listenTo=t(this.listenTo,this),this.init=t(this.init,this),Myna.log("Myna.Binder.constructor",n),this.client=n,this.boundHandlers=[]}return e.prototype.init=function(t){var n,e,r,i;null==t&&(t={}),i=this.client.experiments;for(e in i)n=i[e],(t.all||this.detect(n))&&(this.listenTo(n),r=Myna.hashParams[n.id],r&&n.variants[r]?n.view(r):n.suggest())},e.prototype.listenTo=function(t){var n=this;return Myna.log("Myna.Binder.listenTo",t),t.on("view",function(e){return n.bind(t,e)})},e.prototype.detect=function(t){var n,e;return n=null!=(e=t.settings.get("myna.html.cssClass"))?e:"myna-"+t.id,Myna.$("."+n).length>0},e.prototype.bind=function(t,n){var e,r,i,a,o,s,u,l,c,h,y,d,p,g,f,v=this;return Myna.log("Myna.Binder.bind",t),this.unbind(),i=null!=(g=t.settings.get("myna.html.cssClass"))?g:"myna-"+t.id,u=null!=(f=t.settings.get("myna.html.dataPrefix"))?f:null,c=u?""+this.dataPrefix+"-show":"show",s=u?""+this.dataPrefix+"-hide":"hide",a=u?""+this.dataPrefix+"-bind":"bind",o=u?""+this.dataPrefix+"-goal":"goal",l=u?""+this.dataPrefix+"-redirect":"redirect",Myna.log("Myna.Binder.bind","searchParams",i,c,s,a,o),e=i?Myna.$("."+i):null,p=i?e.filter("[data-"+c+"]"):Myna.$("[data-"+c+"]"),y=i?e.filter("[data-"+s+"]"):Myna.$("[data-"+s+"]"),r=i?e.filter("[data-"+a+"]"):Myna.$("[data-"+a+"]"),d=i?e.filter("[data-"+l+"]"):Myna.$("[data-"+l+"]"),h=i?e.filter("[data-"+o+"]"):Myna.$("[data-"+o+"]"),Myna.log("Myna.Binder.bind","elements",e,p,y,r,h),p.each(function(e,r){return v.bindShow(t,n,c,r)}),y.each(function(e,r){return v.bindHide(t,n,s,r)}),r.each(function(e,r){return v.bindBind(t,n,a,r)}),d.each(function(e,r){return v.bindRedirect(t,n,l,r)}),h.each(function(e,r){return v.bindGoal(t,n,o,r)})},e.prototype.unbind=function(){var t,n,e,r,i,a,o,s;for(Myna.log("Myna.Binder.unbind",this.boundHandlers),a=this.boundHandlers,s=[],r=0,i=a.length;i>r;r++)o=a[r],t=o[0],n=o[1],e=o[2],Myna.log("Myna.Binder.unbind",t,n,e),s.push(Myna.$(t).off(n,e));return s},e.prototype.bindShow=function(t,n,e,r){var i,a;return Myna.log("Myna.Binder.bindShow",t,e,r),a=Myna.$(r),i=a.data(e),n.id===i||n.settings.get(i)?a.show():a.hide()
},e.prototype.bindHide=function(t,n,e,r){var i,a;return Myna.log("Myna.Binder.bindHide",t,e,r),a=Myna.$(r),i=a.data(e),n.id===i||n.settings.get(i)?a.hide():a.show()},e.prototype.bindBind=function(t,n,e,r){var i,a,o,s,u,l;if(Myna.log("Myna.Binder.bindBind",t,e,r),u=Myna.$(r),i=u.data(e),l=i.split("="),a=l[0],o=l[1],s=function(){switch(o){case"id":return n.id;case"name":case"":case null:case void 0:return n.name;default:return n.settings.get(o,"")}}(),a)switch(a){case"text":return u.text(s);case"html":return u.html(s);case"class":return u.addClass(s);default:if("@"===a[0])return u.attr(a.substring(1),s)}},e.prototype.bindRedirect=function(t,n,e,r){var i,a,o;return Myna.log("Myna.Binder.bindRedirect",t,e,r),o=Myna.$(r),i=o.data(e),a=function(){switch(i){case"id":return n.id;case"name":return n.name;default:return n.settings.get(i,!1)}}(),a?window.location.replace(a):void 0},e.prototype.bindGoal=function(t,n,e,r){var i,a,o;if(Myna.log("Myna.Binder.bindGoal",t,e,r),o=Myna.$(r),i=o.data(e))switch(i){case"load":return Myna.$(function(){return t.reward()});case"click":return a=this.createClickHandler(t),this.boundHandlers.push([r,"click",a]),Myna.log("Myna.Binder.bindGoal","attach",r,"click",a,this.boundHandlers),o.on("click",a)}},e.prototype.createClickHandler=function(t,e){var r;return null==e&&(e=function(){}),Myna.log("Myna.Binder.createClickHandler",t,e),r=function(){var r,i,a,o,s,u;o=arguments[0],r=arguments.length>=2?n.call(arguments,1):[],Myna.log.apply(Myna,["Myna.Binder.clickHandler",o].concat(n.call(r))),a=this,u=Myna.$(a),s=t.loadStickyReward()||t.loadLastReward(),null!=s?(Myna.log("Myna.Binder.clickHandler","pass-through"),e.call.apply(e,[this,o].concat(n.call(r)))):(Myna.log("Myna.Binder.clickHandler","pass-through"),o.stopPropagation(),o.preventDefault(),i=function(){a[o.type]?window.setTimeout(function(){return a[o.type]()},0):u.trigger(o.type)},t.reward(1,i,i))}},e}()}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Inspector=function(){function n(n,e){null==e&&(e=null),this.addExperiment=t(this.addExperiment,this),this.initInspector=t(this.initInspector,this),this.initNavbar=t(this.initNavbar,this),this.initStylesheet=t(this.initStylesheet,this),this.remove=t(this.remove,this),this.init=t(this.init,this),Myna.log("Myna.Inspector.constructor"),this.client=n,this.binder=e}return n.prototype.init=function(){var t,n,e;Myna.log("Myna.Inspector.init"),this.initStylesheet(),this.initInspector(),this.initNavbar(),Myna.cache.save("myna-inspector",{visible:!0}),e=this.client.experiments;for(n in e)t=e[n],(null===this.binder||this.binder.detect(t))&&this.addExperiment(t)},n.prototype.remove=function(){return window.location.hash="",Myna.cache.remove("myna-inspector"),window.location.reload()},n.prototype.initStylesheet=function(){Myna.log("Myna.Inspector.initStylesheet"),this.stylesheet||(this.stylesheet=Myna.$('<style id="myna-stylesheet">\n  html {\n    margin-top: 40px;\n  }\n\n  /* Clearfix */\n\n  .myna-overlay-inner {\n    *zoom: 1;\n  }\n\n  .myna-overlay-inner:before,\n  .myna-overlay-inner:after {\n    display: table;\n    content: "";\n    line-height: 0;\n  }\n\n  .myna-overlay-inner:after {\n    clear: both;\n  }\n\n  /* Structure */\n\n  .myna-overlay-inner {\n    font-size: 16px;\n    line-height: 20px;\n  }\n\n  .myna-overlay-inner .pull-left {\n    float: left;\n  }\n\n  .myna-overlay-inner .pull-right {\n    float: right;\n  }\n\n  .myna-overlay-title {\n    padding: 5px 10px;\n    cursor: pointer;\n    font-weight: bold;\n    line-height: 150%;\n  }\n\n  .myna-overlay-field {\n    padding: 0 10px 5px;\n    white-space: nowrap;\n  }\n\n  .myna-overlay-inner label,\n  .myna-overlay-inner select,\n  .myna-overlay-inner button {\n    display: inline-block;\n    box-sizing: border-box;\n    height: 30px;\n    margin: 0 5px;\n    padding: 0 8px;\n    font-size: 16px;\n    line-height: 30px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n    border-radius: 5px;\n  }\n\n  .myna-overlay-inner label {\n    width: 160px;\n    padding: 0;\n  }\n\n  .myna-overlay-inner select {\n    width: 200px;\n  }\n\n  /* Navbar specifics */\n\n  #myna-navbar {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n  }\n\n  #myna-navbar .myna-overlay-inner {\n    padding: 5px 10px;\n  }\n\n  /* Inspector specifics */\n\n  #myna-inspector {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    -webkit-border-radius: 10px;\n    -moz-border-radius: 10px;\n    border-radius: 10px;\n  }\n\n  #myna-inspector .myna-overlay-inner {\n    padding: 0 0 5px;\n  }\n\n  /* Highlight */\n\n  .myna-inspector-highlight-hover,\n  .myna-inspector-highlight-toggle {\n    outline: 5px solid #55f;\n  }\n\n  /* Themes */\n\n  .myna-overlay-outer {\n    -webkit-box-shadow: 0px 0px 10px rgba(50, 50, 50, 0.5);\n    -moz-box-shadow:    0px 0px 10px rgba(50, 50, 50, 0.5);\n    box-shadow:         0px 0px 10px rgba(50, 50, 50, 0.5);\n  }\n\n  .myna-overlay-outer {\n    background: #000;\n    background: rgba(0, 0, 0, 0.75);\n    color: #fff;\n  }\n\n  .myna-overlay-inner select,\n  .myna-overlay-inner button {\n    background: #333;\n    background: -moz-linear-gradient(top, #444 0%, #222 100%);\n    background: -webkit-linear-gradient(top, #444 0%, #222 100%);\n    background: -o-linear-gradient(top, #444 0%, #222 100%);\n    background: -ms-linear-gradient(top, #444 0%, #222 100%);\n    background: linear-gradient(to bottom, #444 0%, #222 100%);\n    border: 1px solid #555;\n    color: #fff;\n  }\n\n  .myna-overlay-inner select.active,\n  .myna-overlay-inner button.active,\n  .myna-overlay-inner select:active,\n  .myna-overlay-inner button:active {\n    background: -moz-linear-gradient(top, #222 0%, #444 100%);\n    background: -webkit-linear-gradient(top, #222 0%, #444 100%);\n    background: -o-linear-gradient(top, #222 0%, #444 100%);\n    background: -ms-linear-gradient(top, #222 0%, #444 100%);\n    background: linear-gradient(to bottom, #222 0%, #444 100%);\n  }\n\n  .myna-overlay-outer a {\n    color: #fff;\n    text-decoration: none;\n  }\n\n  .myna-overlay-outer.myna-overlay-light {\n    background: #fff;\n    background: rgba(255, 255, 255, 0.75);\n    color: #000;\n  }\n\n  .myna-overlay-outer.myna-overlay-light a {\n    color: #000;\n    text-decoration: none;\n  }\n</style>').appendTo("head"))},n.prototype.initNavbar=function(){var t,n,e,r,i,a,o=this;Myna.log("Myna.Inspector.initNavbar"),this.Inspector||(this.navbar=Myna.$("<div id='myna-navbar' class='myna-overlay-outer'>").appendTo("body"),e=Myna.$("<div class='myna-overlay-inner'>").appendTo(this.navbar),i=Myna.$("<div class='pull-left'>").appendTo(e),t=Myna.$("<label><a href='http://mynaweb.com'>Myna</a></label>").appendTo(i),a=Myna.$("<div class='pull-right'>").appendTo(e),r=Myna.$("<button class='inspector'>").text(this.inspector.is(":visible")?"Hide inspector":"Show inspector").appendTo(a),n=Myna.$("<button class='close'>Close</button>").appendTo(a),r.on("click",function(){return o.inspector.is(":visible")?(o.inspector.hide(),r.text("Show inspector")):(o.inspector.show(),r.text("Hide inspector"))}),n.on("click",function(){return Myna.setPreview(!1),o.remove()}))},n.prototype.initInspector=function(){var t,n,e,r=this;Myna.log("Myna.Inspector.initInspector"),this.inspector||(this.inspector=Myna.$("<div id='myna-inspector' class='myna-overlay-outer'>").appendTo("body"),this.inspectorInner=Myna.$("<div class='myna-overlay-inner'>").appendTo(this.inspector),this.inspectorTitle=Myna.$("<div class='myna-overlay-title'>Experiments</div>").appendTo(this.inspectorInner),n=null,t=null,e=function(e){var i,a;return e.stopPropagation(),e.preventDefault(),Myna.log("Myna.Inspector.initInspector.mouseMove",e,n),i={x:e.clientX,y:e.clientY},a=r.inspector.position(),r.inspector.css({top:a.top+i.y-n.y,left:a.left+i.x-n.x,bottom:"auto",right:"auto",width:t.width,height:t.height}),n=i},this.inspectorTitle.on("mousedown",function(i){return i.stopPropagation(),i.preventDefault(),Myna.log("Myna.Inspector.initInspector.mouseDown",i,n),n={x:i.clientX,y:i.clientY},null==t&&(t=r.inspector.size()),Myna.$("html").on("mousemove",e)}),this.inspectorTitle.on("mouseup",function(t){return t.stopPropagation(),t.preventDefault(),Myna.log("Myna.Inspector.initInspector.mouseUp",t,n),Myna.$("html").off("mousemove",e)}))},n.prototype.addExperiment=function(t){var n,e,r,i,a,o,s,u,l,c,h,y;Myna.log("Myna.Inspector.addExperiment",t),c=Myna.$("<div class='myna-overlay-field'>").appendTo(this.inspectorInner),e=Myna.$("<label>").text(t.id).appendTo(c),l=Myna.$("<select>").appendTo(c),i=Myna.$("<button>").text("Show").appendTo(c),a=Myna.$("<button>").text("Suggest").appendTo(c),r=Myna.$("<button>").text("Reward").attr("disabled",null==("function"==typeof t.sticky?t.sticky():void 0)).appendTo(c),o=Myna.$("<button>").text("Unstick").attr("disabled",null==("function"==typeof t.sticky?t.sticky():void 0)).appendTo(c),h=t.variants;for(u in h)s=h[u],Myna.$("<option>").attr("value",u).text("View "+u).appendTo(l);l.on("change",function(n){n.stopPropagation(),n.preventDefault(),t.view(l.find("option:selected").attr("value"))}),n=null!=(y=t.settings.get("myna.html.cssClass"))?y:"myna-"+t.id,i.on("click",function(){var t;return t=Myna.$(this),t.is(".active")?(t.removeClass("active"),Myna.$("."+n).removeClass("myna-inspector-highlight-toggle")):(Myna.$("."+n).addClass("myna-inspector-highlight-toggle"),t.addClass("active"))}),c.hover(function(){return Myna.$("."+n).addClass("myna-inspector-highlight-hover")},function(){return Myna.$("."+n).removeClass("myna-inspector-highlight-hover")}),a.on("click",function(){t.suggest()}),r.on("click",function(){t.reward()}),o.on("click",function(){t.unstick()}),t.on("view",function(t){Myna.log(" - inspector view",t),l.find("[value="+t.id+"]").prop("selected",!0)})},n}()}.call(this),function(){Myna.readyHandlers=[],Myna.ready=function(t){Myna.client?t(Myna.client):Myna.readyHandlers.push(t)},Myna.triggerReady=function(t){var n,e,r,i,a;for(i=Myna.readyHandlers,a=[],e=0,r=i.length;r>e;e++)n=i[e],a.push(n.call(Myna,t));return a},Myna.init=function(t){Myna.log("Myna.init",t),Myna.preview()&&t.latest?Myna.initRemote({url:t.latest}):Myna.initLocal(t)},Myna.initLocal=function(t){var n,e,r,i,a,o;return Myna.log("Myna.init",t),n=null!=(a=t.apiKey)?a:Myna.error("Myna.init","no apiKey in options",t),e=null!=(o=t.apiRoot)?o:"//api.mynaweb.com",r=function(){var n,e,r,a,o;for(a=null!=(r=t.experiments)?r:[],o=[],n=0,e=a.length;e>n;n++)i=a[n],o.push(new Myna.Experiment(i));return o}(),Myna.client=new Myna.Client({apiKey:n,apiRoot:e,experiments:r}),Myna.recorder=new Myna.Recorder(Myna.client),Myna.binder=new Myna.Binder(Myna.client),Myna.googleAnalytics=new Myna.GoogleAnalytics(Myna.client),Myna.preview()?(Myna.inspector=new Myna.Inspector(Myna.client,Myna.binder),Myna.$(function(){return Myna.triggerReady(Myna.client),Myna.inspector.init(),Myna.binder.init()})):Myna.$(function(){return Myna.triggerReady(Myna.client),Myna.recorder.init(),Myna.googleAnalytics.init(),Myna.binder.init()}),Myna.client},Myna.initRemote=function(t){var n,e,r,i,a,o;Myna.log("Myna.initRemote",t),r=null!=(i=t.url)?i:Myna.error("Myna.Client.initRemote","no url specified in options",t),e=null!=(a=t.success)?a:function(){},n=null!=(o=t.error)?o:function(){},Myna.jsonp.request({url:r,success:function(t){return Myna.log("Myna.initRemote","response",t),e(Myna.initLocal(t))},error:n})}}.call(this);