!function(){var a,b=[].slice;null==window.Myna&&(window.Myna={}),Myna.debug=!0,Myna.log=function(){var a,c;a=1<=arguments.length?b.call(arguments,0):[],Myna.debug&&null!=(c=window.console)&&c.log(a)},Myna.error=function(){var a,c;throw a=1<=arguments.length?b.call(arguments,0):[],Myna.debug&&null!=(c=window.console)&&c.error(a),a},Myna.trim=function(a){return null===a?"":a.replace(/^\s+|\s+$/g,"")},Myna.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},Myna.isObject=function(a){return a===Object(a)},Myna.extend=function(){var a,c,d,e,f,g,h;for(a=arguments[0],d=2<=arguments.length?b.call(arguments,1):[],g=0,h=d.length;h>g;g++){e=d[g];for(c in e)f=e[c],a[c]=f}return a},Myna.deleteKeys=function(){var a,c,d,e,f,g;for(e=arguments[0],d=2<=arguments.length?b.call(arguments,1):[],a=Myna.extend({},e),f=0,g=d.length;g>f;f++)c=d[f],delete a[c];return a},Myna.dateToString=function(a){var b,c,d,e,f,g,h,i;return Date.prototype.toISOString?a.toISOString():(g=function(a,b){var c;for(c=""+a;c.length<b;)c="0"+c;return c},i=g(a.getUTCFullYear(),4),f=g(a.getUTCMonth()+1,2),b=g(a.getUTCDate(),2),c=g(a.getUTCHours(),2),e=g(a.getUTCMinutes(),2),h=g(a.getUTCSeconds(),2),d=g(a.getUTCMilliseconds(),2),""+i+"-"+f+"-"+b+"T"+c+":"+e+":"+h+"."+d+"Z")},Myna.problem=function(a){return a},Myna.$=null!=(a=window.jQuery)?a:null}.call(this),function(){Myna.jsonp={callbacks:{},counter:0,createScriptElem:function(a,b){var c;return c=document.createElement("script"),c.setAttribute("type","text/javascript"),c.setAttribute("async","true"),c.setAttribute("src",a),c.setAttribute("class","myna-jsonp"),c.setAttribute("data-callback",b),c.onload=c.onreadystatechange=function(){return Myna.jsonp.remove(b,c)},c},request:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;null==a&&(a={}),n=null!=(p=a.url)?p:Myna.error("Myna.jsonp.request","no url in options",a),j=null!=(q=a.success)?q:function(){},c=null!=(r=a.error)?r:function(){},k=null!=(s=a.timeout)?s:0,g=null!=(t=a.params)?t:{},b="callback"+Myna.jsonp.counter++,h=!1,m=""+n+"?";for(d in g)o=g[d],m+=""+d+"="+o+"&";m+="callback=Myna.jsonp.callbacks."+b,Myna.log("Myna.jsonp.request",m,j,c,k),i=Myna.jsonp.createScriptElem(m,b),f=function(){return h?Myna.log("Myna.jsonp.request.onTimeout",b,k,"already returned"):(h=!0,Myna.log("Myna.jsonp.request.onTimeout",b,k),Myna.jsonp.remove(b,i),c({typename:"problem",subtype:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:b}]}))},l=k>0?window.setTimeout(f,k):null,e=function(a){return h?Myna.log("Myna.jsonp.request.onComplete",b,"already returned"):(h=!0,Myna.log("Myna.jsonp.request.onComplete",b,a.typename,"problem"===a.typename,a),window.clearTimeout(l),Myna.jsonp.remove(b,i),"problem"===a.typename?c(a):j(a))},Myna.jsonp.callbacks[b]=e,document.getElementsByTagName("head")[0].appendChild(i)},remove:function(a,b){var c;if(null==a&&(a=null),null==b&&(b=null),c=null!=b?b.readyState:void 0,!c||"complete"===c||"loaded"===c)try{b&&(b.onload=null,b.parentNode.removeChild(b))}finally{a&&delete Myna.jsonp.callbacks[a]}}}}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Myna.Events=function(){function c(){this.off=a(this.off,this),this.on=a(this.on,this),this.triggerAsync=a(this.triggerAsync,this),this.trigger=a(this.trigger,this),this.eventHandlers={}}return c.prototype.trigger=function(){var a,c,d,e,f,g,h,i;for(d=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],Myna.log.apply(Myna,["Myna.Events.trigger",d].concat(b.call(a))),c=!1,i=null!=(h=this.eventHandlers[d])?h:[],f=0,g=i.length;g>f;f++)e=i[f],c=c||e.apply(this,a)===!1;return c?!1:void 0},c.prototype.triggerAsync=function(){var a,c,d,e,f,g,h,i=this;return d=arguments[0],a=4<=arguments.length?b.call(arguments,1,g=arguments.length-2):(g=1,[]),e=arguments[g++],c=arguments[g++],Myna.log.apply(Myna,["Myna.Events.triggerAsync",d].concat(b.call(a))),f=function(d){var g,h;return Myna.log("Myna.Events.triggerAsync.triggerAll",d),0===d.length?e():(g=d[0],h=2<=d.length?b.call(d,1):[],g.call.apply(g,[i].concat(b.call(a),[function(){return f(h)}],[c])))},f(null!=(h=this.eventHandlers[d])?h:[])},c.prototype.on=function(a,b){var c;return this.eventHandlers[a]=(null!=(c=this.eventHandlers[a])?c:[]).concat([b]),Myna.log("Myna.Events.on",a,b,this.eventHandlers[a])},c.prototype.off=function(a,b){var c;switch(null==b&&(b=null),arguments.length){case 0:this.eventHandlers={};break;case 1:delete this.eventHandlers[arguments[0]];break;default:a=arguments[0],b=arguments[1],this.eventHandlers[a]=function(){var d,e,f,g;for(f=this.eventHandlers[a],g=[],d=0,e=f.length;e>d;d++)c=f[d],c!==b&&g.push(c);return g}.call(this)}return Myna.log("Myna.Events.off",a,b,this.eventHandlers[a])},c}()}.call(this),function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=function(){function a(a){this.toString=b(this.toString,this),this.prefixes=b(this.prefixes,this),this.unset=b(this.unset,this),this.set=b(this.set,this),this.get=b(this.get,this),this.path=b(this.path,this),this.quote=b(this.quote,this),this.parse=b(this.parse,this),this.nodes="string"==typeof a?this.parse(a):a}return a.identifierRegex=/^[a-z_$][a-z0-9_$]*/i,a.integerRegex=/^[0-9]+/,a.completeIdentifierRegex=/^[a-z_$][a-z0-9_$]*$/i,a.prototype.parse=function(b){var c,d,e,f,g,h,i,j,k;return f=b,g=function(a){if(f.length<a)throw"bad settings path: "+b;f=f.substring(a)},i=function(a){var c;if(f.length<a)throw"bad settings path: "+b;return c=f.substring(0,a),f=f.substring(a),c},j=function(a){return f=f.substring(a.length),a},c=function(){var c;if(c=f.match(a.identifierRegex))return j(c[0]);throw"bad settings path: "+b},e=function(){var c;if(c=f.match(a.integerRegex))return parseInt(j(c[0]));throw"bad settings path: "+b},h=function(a){var b,c;for(g(1),b="",c=!1;!c;)f[0]===a?c=!0:"\\"===f[0]?(g(1),b+=i(1)):b+=i(1);return g(1),b},d=function(){var a;return g(1),a="'"===f[0]?h("'"):'"'===f[0]?h('"'):e(),g(1),a},k=function(){var a;for(a=[];f.length>0;)"."===f[0]?(g(1),a.push(c())):"["===f[0]?a.push(d()):a.push(c());return a},f=Myna.trim(f),""===f?[]:"."===f[0]||"["===f[0]?k():(f="."+f,k())},a.prototype.quote=function(a){return a.replace(/['\"\\]/g,function(a){return"\\"+a})},a.prototype.path=function(b){var c,d,e,f;for(null==b&&(b=this.nodes),c="",e=0,f=b.length;f>e;e++)d=b[e],c+="number"==typeof d?"["+d+"]":a.completeIdentifierRegex.test(d)?"."+d:'["'+this.quote(d)+'"]';return"."===c[0]?c.substring(1):c},a.prototype.get=function(a){var b,c,d,e;for(e=this.nodes,c=0,d=e.length;d>c;c++)b=e[c],a=null!=a?a[b]:void 0;return a},a.prototype.set=function(a,b){var d,e,f,g,h,i,j,k;if(null!=b){if(0===this.nodes.length)return b;for(g=a,k=this.nodes,d=2<=k.length?c.call(k,0,h=k.length-1):(h=0,[]),e=k[h++],i=0,j=d.length;j>i;i++)f=d[i],"object"!=typeof g[f]&&(g[f]={}),g=g[f];return g[e]=b,a}return this.unset(a)},a.prototype.unset=function(a){var b,d,e,f,g,h,i,j;if(0===this.nodes.length)return void 0;for(f=a,j=this.nodes,b=2<=j.length?c.call(j,0,g=j.length-1):(g=0,[]),d=j[g++],h=0,i=b.length;i>h;h++){if(e=b[h],null==f[e])return a;f=f[e]}return delete f[d],a},a.prototype.prefixes=function(){var a,b,c,d,e;for(c=this.nodes,a=[],b=d=1,e=c.length;e>=1?e>=d:d>=e;b=e>=1?++d:--d)a.push(this.path(c.slice(0,b)));return a},a.prototype.toString=function(){return this.path()},a}(),Myna.Settings=function(c){function d(a){null==a&&(a={}),this.toJSON=b(this.toJSON,this),this.triggerChange=b(this.triggerChange,this),this.paths=b(this.paths,this),this.pathValuePairs=b(this.pathValuePairs,this),this.unset=b(this.unset,this),this.set=b(this.set,this),this.get=b(this.get,this),d.__super__.constructor.call(this),this.data={},this.set(a)}return e(d,c),d.Path=a,d.defaultSetOptions={silent:!1},d.prototype.get=function(a,b){var c,d;return null==b&&(b=void 0),c=null!=(d=new Myna.Settings.Path(a).get(this.data))?d:b,Myna.log("Myna.Settings.get",a,b,c),c},d.prototype.set=function(){var a,b,c,d,e,f,g;if(0===arguments.length)throw["Myna.Settings.set","not enough arguments",arguments];if("object"==typeof arguments[0]){e=arguments[0],a=Myna.extend({},Myna.Settings.defaultSetOptions,null!=(g=arguments[1])?g:{}),Myna.log("Myna.Settings.set",e,a),d=[];for(c in e)f=e[c],b=new Myna.Settings.Path(c),this.data=b.set(this.data,f),d.push(b);a.silent||this.triggerChange(d)}else e={},e[arguments[0]]=arguments[1],a=arguments[2],this.set(e,a);return this},d.prototype.unset=function(a,b){var c;return c={},c[a]=void 0,this.set(c,b)},d.prototype.pathValuePairs=function(){var a,b,c;return a=[],b=function(a){return"."===a[0]?a.substring(1):a},c=function(d,e){var f,g,h,i,j,k,l;if(null==e&&(e=""),Myna.isArray(d)){for(k=[],h=i=0,j=d.length;j>i;h=++i)f=d[h],k.push(c(h,e+"["+f+"]"));return k}if(Myna.isObject(d)){l=[];for(g in d)h=d[g],l.push(c(h,e+"."+g));return l}return a.push({path:b(e),value:d})},c(this.data),Myna.log("Myna.Settings.pathValuePairs",a),a},d.prototype.paths=function(){return _.map(this.pathValuePairs(),function(a){return a.path})},d.prototype.triggerChange=function(a){var b,c,d,e,f,g,h;for(Myna.log("Myna.Settings.triggerChange",a,this.data,this._events),d=0,f=a.length;f>d;d++)for(b=a[d],h=b.prefixes(),e=0,g=h.length;g>e;e++)c=h[e],this.trigger("change:"+c,this.get(c));return this.trigger("change")},d.prototype.toJSON=function(a){return null==a&&(a={}),this.data},d}(Myna.Events)}.call(this),function(){var a,b,c,d,e,f,g,h,i;null==Myna.cache&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(a){return c=a,!1}}(),Myna.cache.localStorageEnabled=!0,e=function(a){var b;if(b=window.localStorage.getItem("myna-"+a),null==b)return null;try{return JSON.parse(b)}catch(d){return c=d,null}},i=function(a,b){null!=b?window.localStorage.setItem("myna-"+a,JSON.stringify(b)):window.localStorage.removeItem("myna-"+a)},g=function(a){window.localStorage.removeItem("myna-"+a)},b=function(a){return encodeURIComponent(JSON.stringify(a))},a=function(a){return 0===a.indexOf('"')?JSON.parse(a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(a),JSON.parse(decodeURIComponent(a.replace(/\+/g," ")))},h=function(a,c,d){var e,f,g,h;null==d&&(d=365),h="myna-"+a+"="+b(c),f=d?(e=new Date,e.setTime(e.getTime()+1e3*60*60*24*d),"; expires="+e.toGMTString()):"",g="; path=/",document.cookie=""+h+f+g},d=function(b){var c,d,e,f,g,h,i,j;for(g="myna-"+b+"=",f=function(a){var b;return b=a.indexOf(g),b>=0&&a.substring(0,b).match("^\\s*$")},d=function(a){var b;return b=a.indexOf(g),a.substring(b+g.length,a.length)},e=document.cookie.split(";"),i=0,j=e.length;j>i;i++)if(c=e[i],f(c)&&null!=(h=d(c)))return a(h);return null},f=function(a){h(a,"",-1)},Myna.cache.load=function(a){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?e(a):d(a)},Myna.cache.save=function(a,b){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?i(a,b):h(a,b)},Myna.cache.remove=function(a){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?g(a):f(a)}}.call(this),function(){Myna.Variant=function(){function a(a){var b,c,d;null==a&&(a={}),this.id=null!=(b=a.id)?b:Myna.error("Myna.Variant.constructor","no id in options",a),this.weight=null!=(c=a.weight)?c:Myna.error("Myna.Variant.constructor","no weight in options",a),this.settings=new Myna.Settings(null!=(d=a.settings)?d:{})}return a}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},d=[].slice;Myna.BaseExperiment=function(b){function e(b){var c,d,f,g,h,i,j,k;for(null==b&&(b={}),this.save=a(this.save,this),this.load=a(this.load,this),this.loadAndSave=a(this.loadAndSave,this),this.clearVariant=a(this.clearVariant,this),this.saveVariant=a(this.saveVariant,this),this.loadVariant=a(this.loadVariant,this),this.clearLastReward=a(this.clearLastReward,this),this.saveLastReward=a(this.saveLastReward,this),this.loadLastReward=a(this.loadLastReward,this),this.clearLastView=a(this.clearLastView,this),this.saveLastView=a(this.saveLastView,this),this.loadLastView=a(this.loadLastView,this),this.randomVariant=a(this.randomVariant,this),this.totalWeight=a(this.totalWeight,this),this.saveVariantFromReward=a(this.saveVariantFromReward,this),this.rewardVariant=a(this.rewardVariant,this),this.loadVariantsForReward=a(this.loadVariantsForReward,this),this.reward=a(this.reward,this),this.saveVariantFromView=a(this.saveVariantFromView,this),this.viewVariant=a(this.viewVariant,this),this.loadVariantsForView=a(this.loadVariantsForView,this),this.view=a(this.view,this),this.loadVariantsForSuggest=a(this.loadVariantsForSuggest,this),this.suggest=a(this.suggest,this),e.__super__.constructor.call(this,b),Myna.log("Myna.BaseExperiment.constructor",b),this.uuid=null!=(g=b.uuid)?g:Myna.error("Myna.BaseExperiment.constructor",this.id,"no uuid in options",b),this.id=null!=(h=b.id)?h:Myna.error("Myna.BaseExperiment.constructor",this.id,"no id in options",b),this.settings=new Myna.Settings(null!=(i=b.settings)?i:{}),this.variants={},k=null!=(j=b.variants)?j:[],d=0,f=k.length;f>d;d++)c=k[d],this.variants[c.id]=new Myna.Variant(c)}return c(e,b),e.prototype.suggest=function(a,b){var c,d,e;null==a&&(a=function(){}),null==b&&(b=function(){}),c=this.loadVariantsForSuggest(),Myna.log("Myna.BaseExperiment.suggest",this.id,null!=(d=c.variant)?d.id:void 0,null!=(e=c.viewed)?e.id:void 0),this.viewVariant(Myna.extend({success:a,error:b},c))},e.prototype.loadVariantsForSuggest=function(){return{variant:this.randomVariant(),viewed:this.loadLastView()}},e.prototype.view=function(a,b,c){var d,e,f;null==b&&(b=function(){}),null==c&&(c=function(){}),d=this.loadVariantsForView(a),Myna.log("Myna.BaseExperiment.view",this.id,null!=(e=d.variant)?e.id:void 0,null!=(f=d.viewed)?f.id:void 0),this.viewVariant(Myna.extend({success:b,error:c},d))},e.prototype.loadVariantsForView=function(a){return{variant:a instanceof Myna.Variant?a:this.variants[a],viewed:null}},e.prototype.viewVariant=function(a){var b,c,d,e,f,g;d=a.variant,e=a.viewed,c=null!=(f=a.success)?f:function(){},b=null!=(g=a.error)?g:function(){},Myna.log("Myna.BaseExperiment.viewVariant",this.id,null!=d?d.id:void 0,null!=e?e.id:void 0),null!=e?this.trigger("beforeView",e,!1)!==!1&&(c.call(this,e,!1),this.trigger("view",e,!1)):null!=d?this.trigger("beforeView",d,!0)!==!1&&(this.saveVariantFromView(d),c.call(this,d,!0),this.trigger("view",d,!0),this.trigger("recordView",d)):b(Myna.problem("no-variant"))},e.prototype.saveVariantFromView=function(a){return this.saveLastView(a),this.clearLastReward()},e.prototype.reward=function(a,b,c){var d,e,f;null==a&&(a=1),null==b&&(b=function(){}),null==c&&(c=function(){}),d=this.loadVariantsForReward(),Myna.log("Myna.BaseExperiment.reward",this.id,null!=(e=d.variant)?e.id:void 0,null!=(f=d.rewarded)?f.id:void 0,a),this.rewardVariant(Myna.extend({amount:a,success:b,error:c},d))},e.prototype.loadVariantsForReward=function(){return{variant:this.loadLastView(),rewarded:this.loadLastReward()}},e.prototype.rewardVariant=function(a){var b,c,e,f,g,h,i,j,k=this;null==a&&(a={}),Myna.log("Myna.BaseExperiment.rewardVariant",this.id,a),g=a.variant,e=a.rewarded,b=null!=(h=a.amount)?h:1,f=null!=(i=a.success)?i:function(){},c=null!=(j=a.error)?j:function(){},null!=e?this.trigger("beforeReward",e,b,!1)!==!1&&(f.call(this,e,b,!1),this.trigger("reward",e,b,!1)):null!=g?this.trigger("beforeReward",g,b,!0)!==!1&&this.triggerAsync("recordReward",g,b,function(){return k.saveVariantFromReward(g),f.call(k,g,b,!0),k.trigger("reward",g,b,!0)},function(){var a;return a=1<=arguments.length?d.call(arguments,0):[],c.call.apply(c,[k].concat(d.call(a)))}):c(Myna.problem("no-variant"))},e.prototype.saveVariantFromReward=function(a){return this.clearLastView(),this.saveLastReward(a)},e.prototype.totalWeight=function(){var a,b,c,d;a=0,d=this.variants;for(b in d)c=d[b],a+=c.weight;return a},e.prototype.randomVariant=function(){var a,b,c,d,e;c=this.totalWeight(),b=Math.random()*c,e=this.variants;for(a in e)if(d=e[a],c-=d.weight,b>=c)return Myna.log("Myna.BaseExperiment.randomVariant",this.id,d.id),d;return Myna.log("Myna.BaseExperiment.randomVariant",this.id,null),null},e.prototype.loadLastView=function(){return this.loadVariant("lastView")},e.prototype.saveLastView=function(a){return this.saveVariant("lastView",a),this.clearVariant("lastReward")},e.prototype.clearLastView=function(){return this.clearVariant("lastView")},e.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},e.prototype.saveLastReward=function(a){return this.saveVariant("lastReward",a)},e.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},e.prototype.loadVariant=function(a){var b,c;return b=null!=(c=this.load())?c[a]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",this.id,a,b),null!=b?this.variants[b]:null},e.prototype.saveVariant=function(a,b){var c=this;return this.loadAndSave(function(d){return Myna.log("Myna.BaseExperiment.saveVariant",c.id,a,b,d),null!=b?d[a]=b.id:delete d[a],d})},e.prototype.clearVariant=function(a){return this.saveVariant(a,null)},e.prototype.loadAndSave=function(a){var b;return this.save(a(null!=(b=this.load())?b:{}))},e.prototype.load=function(){return Myna.cache.load(this.uuid)},e.prototype.save=function(a){return Myna.cache.save(this.uuid,a)},e}(Myna.Events)}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Myna.Experiment=function(c){function e(){return this.clearStickyReward=b(this.clearStickyReward,this),this.saveStickyReward=b(this.saveStickyReward,this),this.loadStickyReward=b(this.loadStickyReward,this),this.clearStickySuggestion=b(this.clearStickySuggestion,this),this.saveStickySuggestion=b(this.saveStickySuggestion,this),this.loadStickySuggestion=b(this.loadStickySuggestion,this),this.unstick=b(this.unstick,this),this.saveVariantFromReward=b(this.saveVariantFromReward,this),this.loadVariantsForReward=b(this.loadVariantsForReward,this),this.saveVariantFromView=b(this.saveVariantFromView,this),this.loadVariantsForView=b(this.loadVariantsForView,this),this.loadVariantsForSuggest=b(this.loadVariantsForSuggest,this),this.sticky=b(this.sticky,this),a=e.__super__.constructor.apply(this,arguments)}return d(e,c),e.prototype.sticky=function(){return!!this.settings.get("myna.js.sticky",!0)},e.prototype.loadVariantsForSuggest=function(){var a;return this.sticky()?(a=this.loadStickySuggestion(),{variant:null!=a?a:this.randomVariant(),viewed:a}):e.__super__.loadVariantsForSuggest.call(this)},e.prototype.loadVariantsForView=function(a){return e.__super__.loadVariantsForView.call(this,a)},e.prototype.saveVariantFromView=function(a){return this.sticky()&&this.saveStickySuggestion(a),e.__super__.saveVariantFromView.call(this,a)},e.prototype.loadVariantsForReward=function(){return this.sticky()?{variant:this.loadLastView(),rewarded:this.loadStickyReward()}:e.__super__.loadVariantsForReward.call(this)},e.prototype.saveVariantFromReward=function(a){return this.sticky()&&this.saveStickyReward(a),e.__super__.saveVariantFromReward.call(this,a)},e.prototype.unstick=function(){return Myna.log("Myna.Experiment.unstick",this.id),this.clearLastView(),this.clearLastReward(),this.clearStickySuggestion(),this.clearStickyReward()},e.prototype.loadStickySuggestion=function(){return this.loadVariant("stickySuggestion")},e.prototype.saveStickySuggestion=function(a){return this.saveVariant("stickySuggestion",a),this.clearVariant("stickyReward")},e.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},e.prototype.loadStickyReward=function(){return this.loadVariant("stickyReward")},e.prototype.saveStickyReward=function(a){return this.saveVariant("stickyReward",a)},e.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},e}(Myna.BaseExperiment)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},d=[].slice;Myna.Recorder=function(b){function e(b){this.save=a(this.save,this),this.load=a(this.load,this),this.loadAndSave=a(this.loadAndSave,this),this.clearQueuedEvents=a(this.clearQueuedEvents,this),this.requeueEvents=a(this.requeueEvents,this),this.queueEvent=a(this.queueEvent,this),this.queuedEvents=a(this.queuedEvents,this),this.sync=a(this.sync,this),this.recordReward=a(this.recordReward,this),this.recordView=a(this.recordView,this),this.listenTo=a(this.listenTo,this),this.init=a(this.init,this);var c,d;Myna.log("Myna.Recorder.constructor",b),this.client=b,this.apiKey=null!=(c=b.apiKey)?c:Myna.error("Myna.Recorder.constructor","no apiKey in options",options),this.apiRoot=null!=(d=b.apiRoot)?d:"//api.mynaweb.com",this.storageKey=b.settings.get("myna.web.storageKey","myna"),this.timeout=b.settings.get("myna.web.timeout",1e3),this.autoSync=b.settings.get("myna.web.autoSync",!0),this.semaphore=0,this.waiting=[]}return c(e,b),e.prototype.init=function(){var a,b,c,d;c=this.client.experiments,d=[];for(b in c)a=c[b],d.push(this.listenTo(a));return d},e.prototype.listenTo=function(a){var b=this;return Myna.log("Myna.Recorder.listenTo",a.id),a.on("recordView",function(c,d,e){return b.recordView(a,c,d,e)}),a.on("recordReward",function(c,d,e,f){return b.recordReward(a,c,d,e,f)})},e.prototype.recordView=function(a,b,c,d){return null==c&&(c=function(){}),null==d&&(d=function(){}),Myna.log("Myna.Recorder.recordView",a.id,b.id),this.queueEvent({typename:"view",experiment:a.uuid,variant:b.id,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(c,d):c()},e.prototype.recordReward=function(a,b,c,d,e){return null==d&&(d=function(){}),null==e&&(e=function(){}),Myna.log("Myna.Recorder.recordReward",a.id,b.id,c),this.queueEvent({typename:"reward",experiment:a.uuid,variant:b.id,amount:c,timestamp:Myna.dateToString(new Date)}),Myna.log("Myna.Recorder.recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(d,e):d()},e.prototype.sync=function(a,b){var c,e,f,g,h,i=this;return null==a&&(a=function(){}),null==b&&(b=function(){}),this.waiting.push({success:a,error:b}),this.semaphore>0?Myna.log("Myna.Recorder.sync","queued"):(this.semaphore++,h=this.waiting,this.waiting=[],e=function(){var a;return a=i.clearQueuedEvents(),Myna.log("Myna.Recorder.sync.start",a,h.length),i.trigger("beforeSync",a)===!1?i.requeueEvents(a):f(a,[],[])},f=function(a,b,e){var f,h;return Myna.log("Myna.Recorder.sync.syncAll",a,b,e),0===a.length?c(b,e):(f=a[0],h=2<=a.length?d.call(a,1):[],g(f,h,b,e))},g=function(a,b,c,d){var e;return Myna.log("Myna.Recorder.sync.syncOne",a,b,c,d),e=Myna.deleteKeys(a,"experiment"),Myna.jsonp.request({url:""+i.apiRoot+"/v2/experiment/"+a.experiment+"/record",success:function(){return f(b,c.concat([a]),d)},error:function(){return f(b,c,d.concat([a]))},timeout:i.timeout,params:Myna.extend({},e,{apikey:i.apiKey})})},c=function(a,b){var c,d,e,f,g;if(Myna.log("Myna.Recorder.sync.finish",a,b),b.length>0)for(i.requeueEvents(b),d=0,f=h.length;f>d;d++)c=h[d],c.error(a,b);else for(e=0,g=h.length;g>e;e++)c=h[e],c.success(a,b);return i.trigger("afterSync",a,b),i.semaphore--,i.waiting.length>0?i.sync():void 0},e())},e.prototype.queuedEvents=function(){var a,b;return a=null!=(b=this.load().queuedEvents)?b:[],Myna.log("Myna.Recorder.queuedEvents",a),a},e.prototype.queueEvent=function(a){return Myna.log("Myna.Recorder.queueEvent",a),this.loadAndSave(function(b){var c;return b.queuedEvents=(null!=(c=b.queuedEvents)?c:[]).concat([a]),b})},e.prototype.requeueEvents=function(a){return Myna.log("Myna.Recorder.requeueEvents",a),this.loadAndSave(function(b){var c;return b.queuedEvents=a.concat(null!=(c=b.queuedEvents)?c:[]),b})},e.prototype.clearQueuedEvents=function(){var a;return Myna.log("Myna.Recorder.clearQueuedEvents"),a=[],this.loadAndSave(function(b){var c;return a=null!=(c=b.queuedEvents)?c:[],delete b.queuedEvents,b}),a},e.prototype.loadAndSave=function(a){var b;return this.save(a(null!=(b=this.load())?b:{}))},e.prototype.load=function(){return Myna.cache.load(this.storageKey)},e.prototype.save=function(a){return Myna.cache.save(this.storageKey,a)},e}(Myna.Events)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Myna.GoogleAnalytics=function(b){function d(b){this.rewardMultiplier=a(this.rewardMultiplier,this),this.eventName=a(this.eventName,this),this.enabled=a(this.enabled,this),this.rewardEvent=a(this.rewardEvent,this),this.viewEvent=a(this.viewEvent,this),this.recordReward=a(this.recordReward,this),this.recordView=a(this.recordView,this),this.listenTo=a(this.listenTo,this),this.init=a(this.init,this),Myna.log("Myna.GoogleAnalytics.constructor",b),this.client=b}return c(d,b),d.prototype.init=function(){var a,b,c,d;c=this.client.experiments,d=[];for(b in c)a=c[b],d.push(this.listenTo(a));return d},d.prototype.listenTo=function(a){var b=this;return Myna.log("Myna.GoogleAnalytics.listenTo",a.id),a.on("recordView",function(c,d,e){return b.recordView(a,c,d,e)}),a.on("recordReward",function(c,d,e,f){return b.recordReward(a,c,d,e,f)})},d.prototype.recordView=function(a,b,c,d){return null==c&&(c=function(){}),null==d&&(d=function(){}),Myna.log("Myna.GoogleAnalytics.recordView",a,b,c,d),this.enabled(a)&&"undefined"!=typeof _gaq&&null!==_gaq&&_gaq.push(this.viewEvent(a,b)),c()},d.prototype.recordReward=function(a,b,c,d,e){return null==d&&(d=function(){}),null==e&&(e=function(){}),Myna.log("Myna.GoogleAnalytics.recordReward",a,b,d,e),this.enabled(a)&&"undefined"!=typeof _gaq&&null!==_gaq&&_gaq.push(this.rewardEvent(a,b,c)),d()},d.prototype.viewEvent=function(a,b){return["_trackEvent","myna",this.eventName(a,"view"),b.id]},d.prototype.rewardEvent=function(a,b,c){var d;return d=this.rewardMultiplier(a),["_trackEvent","myna",this.eventName(a,"reward"),b.id,Math.round(d*c)]},d.prototype.enabled=function(a){return a.settings.get("myna.web.googleAnalytics.enabled",!0)},d.prototype.eventName=function(a,b){var c;return null!=(c=a.settings.get("myna.web.googleAnalytics."+b+"Event"))?c:""+a.id+"-"+b},d.prototype.rewardMultiplier=function(a){return a.settings.get("myna.web.googleAnalytics.rewardMultiplier",100)},d}(Myna.Events)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Myna.Client=function(){function b(b){var c,d,e,f,g,h,i,j,k;for(null==b&&(b={}),this.reward=a(this.reward,this),this.view=a(this.view,this),this.suggest=a(this.suggest,this),Myna.log("Myna.Client.constructor",b),this.uuid=null!=(f=b.uuid)?f:null,this.apiKey=null!=(g=b.apiKey)?g:Myna.error("Myna.Deployment.constructor","no apiKey in options",b),this.apiRoot=null!=(h=b.apiRoot)?h:"//api.mynaweb.com",this.settings=new Myna.Settings(null!=(i=b.settings)?i:{}),this.experiments={},k=null!=(j=b.experiments)?j:[],d=0,e=k.length;e>d;d++)c=k[d],this.experiments[c.id]=c}return b.prototype.suggest=function(a,b,c){return null==b&&(b=function(){}),null==c&&(c=function(){}),this.experiments[a].suggest(b,c)},b.prototype.view=function(a,b,c,d){return null==c&&(c=function(){}),null==d&&(d=function(){}),this.experiments[a].view(b,c,d)},b.prototype.reward=function(a,b,c,d){return null==b&&(b=1),null==c&&(c=function(){}),null==d&&(d=function(){}),this.experiments[a].reward(b,c,d)},b}()}.call(this),function(){Myna.init=function(a){var b,c,d,e,f,g;return Myna.log("Myna.init",a),b=null!=(f=a.apiKey)?f:Myna.error("Myna.init","no apiKey in options",a),c=null!=(g=a.apiRoot)?g:"//api.mynaweb.com",d=function(){var b,c,d,f,g;for(f=null!=(d=a.experiments)?d:[],g=[],b=0,c=f.length;c>b;b++)e=f[b],g.push(new Myna.Experiment(e));return g}(),Myna.client=new Myna.Client({apiKey:b,apiRoot:c,experiments:d}),Myna.Inspector.active()?(Myna.inspector=new Myna.Inspector(Myna.client),Myna.$(function(){return Myna.inspector.init()})):(Myna.recorder=new Myna.Recorder(Myna.client),Myna.recorder.init(),Myna.googleAnalytics=new Myna.GoogleAnalytics(Myna.client),Myna.googleAnalytics.init()),Myna.client},Myna.initRemote=function(a){var b,c,d,e,f,g;return Myna.log("Myna.initRemote",a),d=null!=(e=a.url)?e:Myna.error("Myna.Client.initRemote","no url specified in options",a),c=null!=(f=a.success)?f:function(){},b=null!=(g=a.error)?g:function(){},Myna.jsonp.request({url:d,success:function(a){return Myna.log("Myna.initRemote","response",a),c(Myna.init(a))},error:b})}}.call(this);