(function(){var t,n=[].slice;null==(t=window.Myna)&&(window.Myna={}),Myna.log=function(){var t,i,e;t=arguments.length>=1?n.call(arguments,0):[],null!=(e=window.console)&&e.log(function(){var n,e,r;for(r=[],n=0,e=t.length;e>n;n++)i=t[n],r.push(JSON.stringify(i));return r}())},Myna.error=function(){var t;throw t=arguments.length>=1?n.call(arguments,0):[]},Myna.extend=function(t,n){var i,e;for(i in n)e=n[i],t[i]||(t[i]=e);return t}}).call(this),function(){}.call(this),function(){var t,n,i,e,r,a=function(t,n){return function(){return t.apply(n,arguments)}},s={}.hasOwnProperty,o=function(t,n){function i(){this.constructor=t}for(var e in n)s.call(n,e)&&(t[e]=n[e]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};i=function(){function t(t){null==t&&(t=null),this.next=t}return t}(),e=function(t){function n(t){this.set=a(this.set,this),this.get=a(this.get,this),this.path=a(this.path,this),n.__super__.constructor.call(this,t)}return o(n,t),n.prototype.path=function(){return this.next.path().substring(1)},n.prototype.get=function(t){return this.next.get(t)},n.prototype.set=function(t,n){return this.next.set(t,n)},n}(i),t=function(t){function n(t,i){this.set=a(this.set,this),this.get=a(this.get,this),this.path=a(this.path,this),n.__super__.constructor.call(this,t),this.name=i}return o(n,t),n.prototype.path=function(){return"."+this.name+this.next.path()},n.prototype.get=function(t){return this.next.get(null!=t?t[this.name]:void 0)},n.prototype.set=function(t,n){var i,e,r;i={};for(e in t)r=t[e],i[e]=r;return i[this.name]=this.next.set(i[this.name],n),i},n}(i),n=function(t){function n(){n.__super__.constructor.call(this,null)}return o(n,t),n.prototype.path=function(){return""},n.prototype.get=function(t){return t},n.prototype.set=function(t,n){return n},n}(i),r=new n,Myna.Settings=function(){function n(t){null==t&&(t={}),this.toJson=a(this.toJson,this),this.parse=a(this.parse,this),this.set=a(this.set,this),this.get=a(this.get,this),this.data={},this.set(t)}return n.prototype.get=function(t,n){var i,e;return null==n&&(n=null),i=null!=(e=this.parse(t).get(this.data))?e:n,Myna.log("Myna.Settings.get",t,i),i},n.prototype.set=function(){var t,n,i;switch(arguments.length){case 2:t=arguments[0],n=arguments[1],Myna.log("Myna.Settings.set",t,n),this.data=this.parse(t).set(this.data,n);break;case 1:i=arguments[0];for(t in i)n=i[t],Myna.log("Myna.Settings.set",t,n),this.data=this.parse(t).set(this.data,n);break;default:throw["wrong number of arguments",arguments]}return this},n.prototype.parse=function(n){var i,a,s,o;for(i=r,o=n.split("."),s=o.length-1;s>=0;s+=-1)a=o[s],i=new t(i,a);return new e(i)},n.prototype.toJson=function(){return this.data},n}(),Myna.cache=new Myna.Settings}.call(this),function(){var t,n,i,e,r,a,s,o,u,c;null==(c=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return i=t,!1}}(),Myna.cache.localStorageEnabled=!0,r=function(t){var n;if(n=window.localStorage.getItem("myna-"+t),null==n)return null;try{return JSON.parse(n)}catch(e){return i=e,null}},u=function(t,n){null!=n?window.localStorage.setItem("myna-"+t,JSON.stringify(n)):window.localStorage.removeItem("myna-"+t)},s=function(t){window.localStorage.removeItem("myna-"+t)},n=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return 0===t.indexOf('"')?JSON.parse(t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(t),JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},o=function(t,i,e){var r,a,s,o;null==e&&(e=365),o="myna-"+t+"="+n(i),a=e?(r=new Date,r.setTime(r.getTime()+1e3*60*60*24*e),"; expires="+r.toGMTString()):"",s="; path=/",document.cookie=""+o+a+s},e=function(n){var i,e,r,a,s,o,u,c;for(s="myna-"+n+"=",a=function(t){var n;return n=t.indexOf(s),n>=0&&t.substring(0,n).match("^\\s*$")},e=function(t){var n;return n=t.indexOf(s),t.substring(n+s.length,t.length)},r=document.cookie.split(";"),u=0,c=r.length;c>u;u++)if(i=r[u],a(i)&&null!=(o=e(i)))return t(o);return null},a=function(t){o(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?r(t):e(t)},Myna.cache.save=function(t,n){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,n):o(t,n)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?s(t):a(t)}}.call(this),function(){Myna.Variant=function(){function t(t,n){var i,e;this.id=t,null==n&&(n={}),this.settings=new Myna.Settings(null!=(i=n.settings)?i:{}),this.weight=function(){if(null!=(e=n.weight))return e;throw"no weight provided"}(),this.views=0,this.reward=0}return t}()}.call(this),function(){var t,n=function(t,n){return function(){return t.apply(n,arguments)}},i={}.hasOwnProperty,e=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};Myna.BaseExperiment=function(){function t(t){var i,e,r,a,s,o,u,c;null==t&&(t={}),this.save=n(this.save,this),this.load=n(this.load,this),this.loadAndSave=n(this.loadAndSave,this),this.clearVariant=n(this.clearVariant,this),this.saveVariant=n(this.saveVariant,this),this.loadVariant=n(this.loadVariant,this),this.clearLastSuggestion=n(this.clearLastSuggestion,this),this.saveLastSuggestion=n(this.saveLastSuggestion,this),this.loadLastSuggestion=n(this.loadLastSuggestion,this),this.recordReward=n(this.recordReward,this),this.recordView=n(this.recordView,this),this.randomVariant=n(this.randomVariant,this),this.totalWeight=n(this.totalWeight,this),this.rewardVariant=n(this.rewardVariant,this),this.reward=n(this.reward,this),this.view=n(this.view,this),this.suggest=n(this.suggest,this),Myna.log("Myna.BaseExperiment.constructor",t),this.uuid=null!=(a=t.uuid)?a:Myna.error("Myna.Experiment.constructor","no UUID in options",t),this.id=null!=(s=t.id)?s:Myna.error("Myna.Experiment.constructor","no ID in options",t),this.settings=new Myna.Settings(null!=(o=t.settings)?o:{}),this.variants={},c=null!=(u=t.variants)?u:{};for(e in c)i=c[e],r=new Myna.Variant(e,i),this.variants[e]=r}return t.prototype.suggest=function(t,n){var i,e;null==t&&(t=function(){}),null==n&&(n=function(){});try{return Myna.log("Myna.BaseExperiment.suggest",this.id),e=this.randomVariant(),this.view(e.id,t,n)}catch(r){return i=r,this.error(i)}},t.prototype.view=function(t,n,i){var e,r;null==n&&(n=function(){}),null==i&&(i=function(){});try{return Myna.log("Myna.BaseExperiment.view",this.id,t),r=this.variants[t],this.saveLastSuggestion(r),this.recordView(r),n(r)}catch(a){return e=a,i(e)}},t.prototype.reward=function(t,n,i){var e,r;null==t&&(t=1),null==n&&(n=function(){}),null==i&&(i=function(){});try{return Myna.log("Myna.BaseExperiment.reward",this.id,t),r=this.loadLastSuggestion(),null!=r?this.rewardVariant(r,t,n,i):i()}catch(a){return e=a,i(e)}},t.prototype.rewardVariant=function(t,n,i,e){var r;null==n&&(n=1),null==i&&(i=function(){}),null==e&&(e=function(){});try{return Myna.log("Myna.BaseExperiment.rewardVariant",this.id,t.id,n),this.clearLastSuggestion(),this.recordReward(t,n),i(t)}catch(a){return r=a,e(r)}},t.prototype.totalWeight=function(){var t,n,i,e;t=0,e=this.variants;for(n in e)i=e[n],t+=i.weight;return t},t.prototype.randomVariant=function(){var t,n,i,e,r;Myna.log("Myna.BaseExperiment.randomVariant"),i=this.totalWeight(),n=Math.random()*i,r=this.variants;for(t in r)if(e=r[t],i-=e.weight,n>=i)return Myna.log("Myna.BaseExperiment.randomVariant",e.id),e;return Myna.log("Myna.BaseExperiment.randomVariant",null),null},t.prototype.recordView=function(t){return Myna.log("Myna.BaseExperiment.recordView",this.id,t)},t.prototype.recordReward=function(t,n){return Myna.log("Myna.BaseExperiment.recordReward",this.id,t,n)},t.prototype.loadLastSuggestion=function(){return this.loadVariant("lastSuggestion")},t.prototype.saveLastSuggestion=function(t){return this.saveVariant("lastSuggestion",t)},t.prototype.clearLastSuggestion=function(){return this.clearVariant("lastSuggestion")},t.prototype.loadVariant=function(t){var n,i;return n=null!=(i=this.load())?i[t]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",t,n),null!=n?this.variants[n]:null},t.prototype.saveVariant=function(t,n){return this.loadAndSave(function(i){return Myna.log("Myna.BaseExperiment.saveVariant",t,n,i),null!=n?i[t]=n.id:delete i[t],i})},t.prototype.clearVariant=function(t){return this.saveVariant(t,null)},t.prototype.loadAndSave=function(t){var n;return this.save(t(null!=(n=this.load())?n:{}))},t.prototype.load=function(){return Myna.cache.load(this.uuid)},t.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},t}(),Myna.Experiment=function(i){function r(){return this.clearStickyReward=n(this.clearStickyReward,this),this.saveStickyReward=n(this.saveStickyReward,this),this.loadStickyReward=n(this.loadStickyReward,this),this.clearStickySuggestion=n(this.clearStickySuggestion,this),this.saveStickySuggestion=n(this.saveStickySuggestion,this),this.loadStickySuggestion=n(this.loadStickySuggestion,this),this.unstick=n(this.unstick,this),this.sticky=n(this.sticky,this),this.reward=n(this.reward,this),this.suggest=n(this.suggest,this),t=r.__super__.constructor.apply(this,arguments)}return e(r,i),r.prototype.suggest=function(t,n){var i,e,r;null==t&&(t=function(){}),null==n&&(n=function(){});try{return Myna.log("Myna.Experiment.suggest",this.id),this.sticky()?(e=null!=(r=this.loadStickySuggestion())?r:this.randomVariant(),this.saveStickySuggestion(e)):e=this.randomVariant(),null!=e?this.view(e.id,t,n):n()}catch(a){return i=a,n(i)}},r.prototype.reward=function(t,n,i){var e,r,a;null==t&&(t=1),null==n&&(n=function(){}),null==i&&(i=function(){});try{return Myna.log("Myna.Experiment.reward",this.id,t),this.sticky()?(r=null!=(a=this.loadStickyReward())?a:this.loadLastSuggestion(),this.saveStickyReward(r)):r=this.loadLastSuggestion(),null!=r?this.rewardVariant(r,t,n,i):i()}catch(s){return e=s,i(e)}},r.prototype.sticky=function(){return!!this.settings.get("myna.sticky",!0)},r.prototype.unstick=function(){return this.clearStickySuggestion(),this.clearStickyReward()},r.prototype.loadStickySuggestion=function(){return this.loadVariant("stickySuggestion")},r.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t)},r.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion")},r.prototype.loadStickyReward=function(){return this.loadVariant("stickyReward")},r.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},r.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},r}(Myna.BaseExperiment)}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};Myna.Client=function(){function n(n){var i,e,r,a,s,o,u,c;for(null==n&&(n={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),this.apiRoot=null!=(s=n.apiRoot)?s:"//api.mynaweb.com",this.apiKey=null!=(o=n.apiKey)?o:Myna.error("Myna.Client.constructor","no apiKey in options",n),this.experiments={},c=null!=(u=n.experiments)?u:[],r=0,a=c.length;a>r;r++)e=c[r],i=new Myna.Experiment(e),this.experiments[i.id]=i}return n.prototype.suggest=function(t,n,i){return null==n&&(n=function(){}),null==i&&(i=function(){}),this.experiments[t].suggest(n,i)},n.prototype.view=function(t,n,i,e){return null==i&&(i=function(){}),null==e&&(e=function(){}),this.experiments[t].view(n,i,e)},n.prototype.reward=function(t,n,i,e){return null==n&&(n=1),null==i&&(i=function(){}),null==e&&(e=function(){}),this.experiments[t].reward(n,i,e)},n}()}.call(this),function(){}.call(this);