(function(){var t,e=[].slice;null==(t=window.Myna)&&(window.Myna={}),Myna.debug=!1,Myna.log=function(){var t,n,i;t=arguments.length>=1?e.call(arguments,0):[],Myna.debug&&null!=(i=window.console)&&i.log(function(){var e,i,a;for(a=[],e=0,i=t.length;i>e;e++)n=t[e],a.push(JSON.stringify(n));return a}())},Myna.extend=function(){var t,n,i,a,r,s,o;for(t=arguments[0],i=arguments.length>=2?e.call(arguments,1):[],s=0,o=i.length;o>s;s++){a=i[s];for(n in a)r=a[n],t[n]||(t[n]=r)}return t},Myna.dateToString=function(t){var e,n,i,a,r,s,o,u;return s=function(t,e){var n;for(n=""+t;e>n.length;)n="0"+n;return n},u=s(t.getUTCFullYear(),4),r=s(t.getUTCMonth()+1,2),e=s(t.getUTCDate(),2),n=s(t.getUTCHours(),2),a=s(t.getUTCMinutes(),2),o=s(t.getUTCSeconds(),2),i=s(t.getUTCMilliseconds(),2),""+u+"-"+r+"-"+e+"T"+n+":"+a+":"+o+"."+i+"Z"},Myna.problem=function(t){return t}}).call(this),function(){Myna.jsonp={callbacks:{},counter:0,request:function(t){var e,n,i,a,r,s,o,u,l,c,h,p,y,d,g,f,m,v,w;null==t&&(t={}),y=function(){if(null!=(g=t.url))return g;throw"no URL specified"}(),l=null!=(f=t.success)?f:function(){},n=null!=(m=t.error)?m:function(){},c=null!=(v=t.timeout)?v:0,s=null!=(w=t.params)?w:{},e="callback"+Myna.jsonp.counter++,o=!1,p=""+y+"?";for(i in s)d=s[i],p+=""+i+"="+d+"&";p+="callback=Myna.jsonp.callbacks."+e,Myna.log("Myna.jsonp.request",p,l,n,c),u=document.createElement("script"),u.setAttribute("type","text/javascript"),u.setAttribute("async","true"),u.setAttribute("src",p),u.setAttribute("class","myna-jsonp"),u.setAttribute("data-callback",e),u.onload=u.onreadystatechange=function(){return Myna.jsonp.remove(e,u)},r=function(){return o?Myna.log("Myna.jsonp.request.onTimeout",e,c,"already returned"):(o=!0,Myna.log("Myna.jsonp.request.onTimeout",e,c),Myna.jsonp.remove(e,u),n({typename:"problem",subtype:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:e}]}))},h=c>0?window.setTimeout(r,c):null,a=function(t){return o?Myna.log("Myna.jsonp.request.onComplete",e,"already returned"):(o=!0,Myna.log("Myna.jsonp.request.onComplete",e,t.typename,"problem"===t.typename,t),window.clearTimeout(h),Myna.jsonp.remove(e,u),"problem"===t.typename?n(t):l(t))},Myna.jsonp.callbacks[e]=a,document.getElementsByTagName("head")[0].appendChild(u)},remove:function(t,e){var n;if(null==t&&(t=null),null==e&&(e=null),n=null!=e?e.readyState:void 0,!n||"complete"===n||"loaded"===n)try{e&&(e.onload=null,e.parentNode.removeChild(e))}finally{t&&delete Myna.jsonp.callbacks[t]}}}}.call(this),function(){var t,e,n,i,a,r=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(){function t(t){null==t&&(t=null),this.next=t}return t}(),i=function(t){function e(t){this.set=r(this.set,this),this.get=r(this.get,this),this.path=r(this.path,this),e.__super__.constructor.call(this,t)}return o(e,t),e.prototype.path=function(){return this.next.path().substring(1)},e.prototype.get=function(t){return this.next.get(t)},e.prototype.set=function(t,e){return this.next.set(t,e)},e}(n),t=function(t){function e(t,n){this.set=r(this.set,this),this.get=r(this.get,this),this.path=r(this.path,this),e.__super__.constructor.call(this,t),this.name=n}return o(e,t),e.prototype.path=function(){return"."+this.name+this.next.path()},e.prototype.get=function(t){return this.next.get(null!=t?t[this.name]:void 0)},e.prototype.set=function(t,e){var n,i,a;n={};for(i in t)a=t[i],n[i]=a;return n[this.name]=this.next.set(n[this.name],e),n},e}(n),e=function(t){function e(){e.__super__.constructor.call(this,null)}return o(e,t),e.prototype.path=function(){return""},e.prototype.get=function(t){return t},e.prototype.set=function(t,e){return e},e}(n),a=new e,Myna.Settings=function(){function e(t){null==t&&(t={}),this.toJson=r(this.toJson,this),this.parse=r(this.parse,this),this.set=r(this.set,this),this.get=r(this.get,this),this.data={},this.set(t)}return e.prototype.get=function(t,e){var n,i;return null==e&&(e=null),n=null!=(i=this.parse(t).get(this.data))?i:e,Myna.log("Myna.Settings.get",t,n),n},e.prototype.set=function(){var t,e,n;switch(arguments.length){case 2:t=arguments[0],e=arguments[1],Myna.log("Myna.Settings.set",t,e),this.data=this.parse(t).set(this.data,e);break;case 1:n=arguments[0];for(t in n)e=n[t],Myna.log("Myna.Settings.set",t,e),this.data=this.parse(t).set(this.data,e);break;default:throw["wrong number of arguments",arguments]}return this},e.prototype.parse=function(e){var n,r,s,o;for(n=a,o=e.split("."),s=o.length-1;s>=0;s+=-1)r=o[s],n=new t(n,r);return new i(n)},e.prototype.toJson=function(){return this.data},e}()}.call(this),function(){var t,e,n,i,a,r,s,o,u,l;null==(l=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return n=t,!1}}(),Myna.cache.localStorageEnabled=!0,a=function(t){var e;if(e=window.localStorage.getItem("myna-"+t),null==e)return null;try{return JSON.parse(e)}catch(i){return n=i,null}},u=function(t,e){null!=e?window.localStorage.setItem("myna-"+t,JSON.stringify(e)):window.localStorage.removeItem("myna-"+t)},s=function(t){window.localStorage.removeItem("myna-"+t)},e=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return 0===t.indexOf('"')?JSON.parse(t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(t),JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},o=function(t,n,i){var a,r,s,o;null==i&&(i=365),o="myna-"+t+"="+e(n),r=i?(a=new Date,a.setTime(a.getTime()+1e3*60*60*24*i),"; expires="+a.toGMTString()):"",s="; path=/",document.cookie=""+o+r+s},i=function(e){var n,i,a,r,s,o,u,l;for(s="myna-"+e+"=",r=function(t){var e;return e=t.indexOf(s),e>=0&&t.substring(0,e).match("^\\s*$")},i=function(t){var e;return e=t.indexOf(s),t.substring(e+s.length,t.length)},a=document.cookie.split(";"),u=0,l=a.length;l>u;u++)if(n=a[u],r(n)&&null!=(o=i(n)))return t(o);return null},r=function(t){o(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?a(t):i(t)},Myna.cache.save=function(t,e){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,e):o(t,e)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?s(t):r(t)}}.call(this),function(){Myna.Variant=function(){function t(t){var e,n,i;null==t&&(t={}),this.id=function(){if(null!=(e=t.id))return e;throw"no id specified"}(),this.weight=function(){if(null!=(n=t.weight))return n;throw"no weight specified"}(),this.settings=new Myna.Settings(null!=(i=t.settings)?i:{})}return t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].slice;Myna.BaseExperiment=function(){function n(e){var n,i,a,r,s,o,u,l,c,h,p;for(null==e&&(e={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.enqueueReward=t(this.enqueueReward,this),this.enqueueView=t(this.enqueueView,this),this.requeueEvents=t(this.requeueEvents,this),this.enqueueEvent=t(this.enqueueEvent,this),this.clearQueuedEvents=t(this.clearQueuedEvents,this),this.loadQueuedEvents=t(this.loadQueuedEvents,this),this.clearVariant=t(this.clearVariant,this),this.saveVariant=t(this.saveVariant,this),this.loadVariant=t(this.loadVariant,this),this.clearLastReward=t(this.clearLastReward,this),this.saveLastReward=t(this.saveLastReward,this),this.loadLastReward=t(this.loadLastReward,this),this.clearLastSuggestion=t(this.clearLastSuggestion,this),this.saveLastSuggestion=t(this.saveLastSuggestion,this),this.loadLastSuggestion=t(this.loadLastSuggestion,this),this.callback=t(this.callback,this),this.randomVariant=t(this.randomVariant,this),this.totalWeight=t(this.totalWeight,this),this.record=t(this.record,this),this.rewardVariant=t(this.rewardVariant,this),this.reward=t(this.reward,this),this.viewVariant=t(this.viewVariant,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),this.timeout=t(this.timeout,this),Myna.log("Myna.BaseExperiment.constructor",e),this.uuid=null!=(r=e.uuid)?r:Myna.error("Myna.BaseExperiment.constructor",this.id,"no uuid in options",e),this.id=null!=(s=e.id)?s:Myna.error("Myna.BaseExperiment.constructor",this.id,"no id in options",e),this.apiKey=null!=(o=e.apiKey)?o:Myna.error("Myna.BaseExperiment.constructor",this.id,"no apiKey in options",e),this.apiRoot=null!=(u=e.apiRoot)?u:"//api.mynaweb.com",this.settings=new Myna.Settings(null!=(l=e.settings)?l:{}),this.callbacks=null!=(c=e.callbacks)?c:{},this.variants={},p=null!=(h=e.variants)?h:[],i=0,a=p.length;a>i;i++)n=p[i],this.variants[n.id]=new Myna.Variant(n);this.recordSemaphore=0,this.waitingToRecord=[]}return n.prototype.timeout=function(){return this.settings.get("myna.web.timeout",1e3)},n.prototype.suggest=function(t,e){var n;return null==t&&(t=function(){}),null==e&&(e=function(){}),Myna.log("Myna.BaseExperiment.suggest",this.id),n=this.randomVariant(),this.callback("beforeSuggest").call(this,n)===!1?!1:(this.viewVariant({variant:n,success:t,error:e}),this.callback("afterSuggest").call(this,n),void 0)},n.prototype.view=function(t,e,n){return null==e&&(e=function(){}),null==n&&(n=function(){}),Myna.log("Myna.BaseExperiment.view",this.id,t),this.viewVariant({variant:this.variants[t],success:e,error:n})===!1?!1:void 0},n.prototype.viewVariant=function(t){var n,i,a,r,s,o,u,l;return Myna.log("Myna.BaseExperiment.viewVariant",this.id,t),s=t.variant,r=null!=(o=t.success)?o:function(){},i=null!=(u=t.error)?u:function(){},a=null!=(l=t.otherArgs)?l:[],n=[s].concat(e.call(a)),this.callback("beforeView").apply(this,n)===!1?!1:(this.saveLastSuggestion(s),this.clearLastReward(),this.enqueueView(s),r.apply(this,n),this.callback("afterView").apply(this,n),void 0)},n.prototype.reward=function(t,e,n){var i;return null==t&&(t=1),null==e&&(e=function(){}),null==n&&(n=function(){}),Myna.log("Myna.BaseExperiment.reward",this.id,t),i=this.loadLastSuggestion(),null==i?(n.call(this,Myna.problem("no-suggestion")),!1):this.callback("beforeReward").call(this,i,t)===!1?!1:this.rewardVariant(i,t,e,n)===!1?!1:(this.callback("afterReward").call(this,i,t),void 0)},n.prototype.rewardVariant=function(t){var n,i,a,r,s,o,u,l,c,h,p,y;null==t&&(t={}),Myna.log("Myna.BaseExperiment.rewardVariant",this.id,t),u=function(){if(null!=(l=t.variant))return l;throw"no variant specified"}(),n=null!=(c=t.amount)?c:1,o=null!=(h=t.success)?h:function(){},a=null!=(p=t.error)?p:function(){},r=null!=(y=t.otherArgs)?y:[],i=[u,n].concat(e.call(r)),s=this.loadLastReward(),null!=s?a.call(this,Myna.problem("already-rewarded")):(this.clearLastSuggestion(),this.saveLastReward(u),this.enqueueReward(u,n),o.apply(this,i))},n.prototype.record=function(t,n){var i,a,r,s,o,u=this;return null==t&&(t=function(){}),null==n&&(n=function(){}),this.waitingToRecord.push({success:t,error:n}),this.recordSemaphore>0?Myna.log("Myna.BaseExperiment.record","queued"):(this.recordSemaphore++,i=this.waitingToRecord,this.waitingToRecord=[],Myna.log("Myna.BaseExperiment.record","starting",i.length),s=function(t,n,i){var a,s;return Myna.log("Myna.BaseExperiment.record.recordAll",t,n,i),0===t.length?r(n,i):(a=t[0],s=t.length>=2?e.call(t,1):[],o(a,s,n,i))},o=function(t,e,n,i){return Myna.log("Myna.BaseExperiment.record.recordOne",t,e,n,i),Myna.jsonp.request({url:""+u.apiRoot+"/v2/experiment/"+u.uuid+"/record",success:function(){return s(e,n.concat([t]),i)},error:function(){return s(e,n,i.concat([t]))},timeout:u.timeout(),params:Myna.extend({},t,{apikey:u.apiKey})})},r=function(t,e){var n,a,r,s,o;if(Myna.log("Myna.BaseExperiment.record.finish",t,e),e.length>0)for(u.requeueEvents(e),a=0,s=i.length;s>a;a++)n=i[a],n.error(t,e);else for(r=0,o=i.length;o>r;r++)n=i[r],n.success(t,e);return u.callback("afterRecord").call(u,t,e),u.recordSemaphore--,u.waitingToRecord.length>0?u.record():void 0},a=this.clearQueuedEvents(),this.callback("beforeRecord").call(this,a)===!1?this.requeueEvents(a):s(a,[],[]))},n.prototype.totalWeight=function(){var t,e,n,i;t=0,i=this.variants;for(e in i)n=i[e],t+=n.weight;return t},n.prototype.randomVariant=function(){var t,e,n,i,a;Myna.log("Myna.BaseExperiment.randomVariant",this.id),n=this.totalWeight(),e=Math.random()*n,a=this.variants;for(t in a)if(i=a[t],n-=i.weight,e>=n)return Myna.log("Myna.BaseExperiment.randomVariant",this.id,i.id),i;return Myna.log("Myna.BaseExperiment.randomVariant",this.id,null),null},n.prototype.callback=function(t){var e;return e=this.callbacks[t],Myna.log("Myna.BaseExperiment.callback",this.id,t,null!=e),null!=e?e:function(){}},n.prototype.loadLastSuggestion=function(){return this.loadVariant("lastSuggestion")},n.prototype.saveLastSuggestion=function(t){return this.saveVariant("lastSuggestion",t),this.clearVariant("lastReward")},n.prototype.clearLastSuggestion=function(){return this.clearVariant("lastSuggestion")},n.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},n.prototype.saveLastReward=function(t){return this.saveVariant("lastReward",t)},n.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},n.prototype.loadVariant=function(t){var e,n;return e=null!=(n=this.load())?n[t]:void 0,Myna.log("Myna.BaseExperiment.loadVariant",this.id,t,e),null!=e?this.variants[e]:null},n.prototype.saveVariant=function(t,e){return this.loadAndSave(function(n){return Myna.log("Myna.BaseExperiment.saveVariant",this.id,t,e,n),null!=e?n[t]=e.id:delete n[t],n})},n.prototype.clearVariant=function(t){return this.saveVariant(t,null)},n.prototype.loadQueuedEvents=function(){var t,e;return t=null!=(e=this.load().queuedEvents)?e:[],Myna.log("Myna.BaseExperiment.loadQueuedEvents",this.id,t),t},n.prototype.clearQueuedEvents=function(){var t;return Myna.log("Myna.BaseExperiment.clearQueuedEvents",this.id),t=[],this.loadAndSave(function(e){var n;return t=null!=(n=e.queuedEvents)?n:[],delete e.queuedEvents,e}),t},n.prototype.enqueueEvent=function(t){return Myna.log("Myna.BaseExperiment.enqueueEvent",this.id,t),this.loadAndSave(function(e){return null!=e.queuedEvents?e.queuedEvents.push(t):e.queuedEvents=[t],e})},n.prototype.requeueEvents=function(t){return Myna.log("Myna.BaseExperiment.requeueEvents",this.id,t),this.loadAndSave(function(e){return e.queuedEvents=null!=e.queuedEvents?t.concat(e.queuedEvents):t,e})},n.prototype.enqueueView=function(t){return Myna.log("Myna.BaseExperiment.enqueueView",this.id,t),this.enqueueEvent({typename:"view",variant:t.id,timestamp:Myna.dateToString(new Date)})},n.prototype.enqueueReward=function(t,e){return Myna.log("Myna.BaseExperiment.enqueueReward",this.id,t,e),this.enqueueEvent({typename:"reward",variant:t.id,amount:e,timestamp:Myna.dateToString(new Date)})},n.prototype.loadAndSave=function(t){var e;return this.save(t(null!=(e=this.load())?e:{}))},n.prototype.load=function(){return Myna.cache.load(this.uuid)},n.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},n}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var a in e)n.call(e,a)&&(t[a]=e[a]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Myna.Experiment=function(n){function a(){return this.clearStickyReward=e(this.clearStickyReward,this),this.saveStickyReward=e(this.saveStickyReward,this),this.loadStickyReward=e(this.loadStickyReward,this),this.clearStickySuggestion=e(this.clearStickySuggestion,this),this.saveStickySuggestion=e(this.saveStickySuggestion,this),this.loadStickySuggestion=e(this.loadStickySuggestion,this),this.unstick=e(this.unstick,this),this.reward=e(this.reward,this),this.suggest=e(this.suggest,this),this.autoRecord=e(this.autoRecord,this),this.sticky=e(this.sticky,this),t=a.__super__.constructor.apply(this,arguments)}return i(a,n),a.prototype.sticky=function(){return!!this.settings.get("myna.web.sticky",!0)},a.prototype.autoRecord=function(){return!!this.settings.get("myna.web.autoRecord",!0)},a.prototype.suggest=function(t,e){var n,i,a;if(null==t&&(t=function(){}),null==e&&(e=function(){}),Myna.log("Myna.Experiment.suggest",this.id),n=this.sticky(),n?(i=this.loadStickySuggestion(),a=null!=i?i:this.randomVariant()):(i=null,a=this.randomVariant()),this.callback("beforeSuggest").call(this,a,!!i)===!1)return!1;if(null!=i)t.call(this,i,!!i);else{if(null==a)return e.call(this,Myna.problem("no-variants")),!1;if(n&&this.saveStickySuggestion(a),this.viewVariant({variant:a,success:t,error:e,otherArgs:[!!i]})===!1)return!1}this.callback("afterSuggest").call(this,a,!!i),this.autoRecord()&&this.record()},a.prototype.reward=function(t,e,n){var i,a,r,s,o,u=this;if(null==t&&(t=1),null==e&&(e=function(){}),null==n&&(n=function(){}),Myna.log("Myna.Experiment.reward",this.id,t),r=this.sticky(),r?(a=this.loadStickyReward(),s=null!=a?a:this.loadLastSuggestion()):(a=null,s=this.loadLastSuggestion()),this.callback("beforeReward").call(this,s,t,!!a)===!1)return!1;if(o=function(){return e.call(u,s,t,!!a),u.callback("afterReward").call(u,s,t,!!a)},null!=a)o();else{if(null==s)return n.call(this,Myna.problem("no-suggestion")),!1;if(r&&this.saveStickyReward(s,t,!!a),i=function(){return u.autoRecord()?u.record(o,n):o()},this.rewardVariant({variant:s,amount:t,success:i,error:n,otherArgs:[!!a]})===!1)return!1}},a.prototype.unstick=function(){return Myna.log("Myna.Experiment.unstick",this.id),this.clearLastSuggestion(),this.clearLastReward(),this.clearStickySuggestion()},a.prototype.loadStickySuggestion=function(){return this.loadVariant("stickySuggestion")},a.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t),this.clearVariant("stickyReward")},a.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},a.prototype.loadStickyReward=function(){return this.loadVariant("stickyReward")},a.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},a.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},a}(Myna.BaseExperiment)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Myna.Client=function(){function e(e){var n,i,a,r,s,o,u;for(null==e&&(e={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),this.apiKey=function(){if(null!=(r=e.apiKey))return r;throw"apiKey not specified in options"}(),this.apiRoot=null!=(s=e.apiRoot)?s:"//api.mynaweb.com",this.experiments={},u=null!=(o=e.experiments)?o:[],i=0,a=u.length;a>i;i++)n=u[i],this.experiments[n.id]=n instanceof Myna.Experiment?n:new Myna.Experiment(Myna.extend(n,{apiKey:this.apiKey,apiRoot:this.apiRoot}))}return e.prototype.suggest=function(t,e,n){return null==e&&(e=function(){}),null==n&&(n=function(){}),this.experiments[t].suggest(e,n)},e.prototype.view=function(t,e,n,i){return null==n&&(n=function(){}),null==i&&(i=function(){}),this.experiments[t].view(e,n,i)},e.prototype.reward=function(t,e,n,i){return null==e&&(e=1),null==n&&(n=function(){}),null==i&&(i=function(){}),this.experiments[t].reward(e,n,i)},e}()}.call(this),function(){Myna.initLocal=function(t){var e,n,i,a,r,s;return Myna.log("Myna.initLocal",t),e=function(){if(null!=(a=t.apiKey))return a;throw"no apiKey specified"}(),n=null!=(r=t.apiRoot)?r:"//api.mynaweb.com",i=null!=(s=t.experiments)?s:[],new Myna.Client({apiKey:e,apiRoot:n,experiments:i})},Myna.initApi=function(t){var e,n,i,a,r,s,o,u;return Myna.log("Myna.initRemote",t),e=function(){if(null!=(r=t.apiKey))return r;throw"no apiKey specified"}(),n=null!=(s=t.apiRoot)?s:"//api.mynaweb.com",a=null!=(o=t.success)?o:function(){},i=null!=(u=t.error)?u:function(){},Myna.jsonp.request({url:""+n+"/v2/experiment",params:{apikey:e},success:function(t){return Myna.log("Myna.initRemote","response",t),a(Myna.initLocal({apiKey:e,apiRoot:n,experiments:t.results}))},error:i})}}.call(this),function(){}.call(this);