window.Myna=window.Myna!=null?window.Myna:{};var Log,LogLevel;LogLevel={SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},Log=function(){function e(e){this.loglevel=e}return e.prototype.log=function(e,t){if(window.console&&this.loglevel>=e)return window.console.log(t)},e}(),window.Myna.LogLevel=LogLevel;var extend;extend=function(e,t){var n,r;for(n in t)r=t[n],e[n]||(e[n]=r);return e};var Config;Config=function(){function e(e){var t;t="https:"===document.location.protocol?"https":"http",this.cookieLifespan=365,this.cookieName="myna"+e,this.timeout=400,this.baseurl=""+t+"://api.mynaweb.com",this.loglevel=LogLevel.ERROR,this.rewardSuccess=function(e){return void 0},this.error=function(e){return void 0}}return e.prototype.extend=function(e){return extend(extend({},e),this)},e}();var Cookie;Cookie={create:function(e,t,n){var r,i;return i=n?(r=new Date,r.setTime(r.getTime()+n*24*60*60*1e3),"; expires="+r.toGMTString()):"",document.cookie=""+e+"="+(t+i)+"; path=/"},read:function(e){var t,n,r,i,s,o,u,a;o=e+"=",s=function(e){var t;return t=e.indexOf(o),t>=0&&e.substring(0,t).match("^\\s*$")},n=function(e){var t;return t=e.indexOf(o),e.substring(t+o.length,e.length)},r=document.cookie.split(";");for(u=0,a=r.length;u<a;u++)t=r[u],s(t)&&(i=n(t));return i},erase:function(e){return Cookie.create(e,"",-1)}};var JsonP;window.Myna.callbacks=[],JsonP={callbackCounter:0,removeCallback:function(e){if(!this.readyState||this.readyState==="complete"||this.readyState==="loaded"){this.onload=null;try{return this.parentNode.removeChild(this)}catch(t){}finally{window.Myna.callbacks[e]=null}}},doJsonP:function(e){var t,n,r,i,s,o,u;i=!1,t="callback"+JsonP.callbackCounter++,window.Myna.callbacks[t]=function(t){if(!i)return i=!0,e.success.apply(this,arguments)},s=e.url+"?",u=e.data;for(r in u)o=u[r],s+=""+r+"="+o+"&";return s+="callback=window.Myna.callbacks."+t,e.timeout>0&&window.setTimeout(function(){if(!i)return i=!0,JsonP.removeCallback.call(n,t),e.error({typename:"problem",subtype:500,messages:[{typename:"timeout",item:"The server took longer than "+e.timeout+" ms to reply"}]})},e.timeout),n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.setAttribute("async","true"),n.onload=n.onreadystatechange=function(){return JsonP.removeCallback.call(n,t)},n.setAttribute("src",s),document.getElementsByTagName("head")[0].appendChild(n)}};var Experiment,__bind=function(e,t){return function(){return e.apply(t,arguments)}};Experiment=function(){function e(e,t){this.uuid=e,t==null&&(t={}),this.recallOrSuggest=__bind(this.recallOrSuggest,this),this.forget=__bind(this.forget,this),this.recall=__bind(this.recall,this),this.suggest=__bind(this.suggest,this),this.config=(new Config(this.uuid)).extend(t),this.logger=new Log(this.config.loglevel)}return e.prototype.suggest=function(e,t){var n,r,i,s,o=this;return t==null&&(t=this.config.error),n=function(e){var t,n,r,i,s;i=Myna.onsuggest,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t(o,e));return s},s=function(t){var i;return o.logger.log(LogLevel.DEBUG,"Experiment.suggest successWrapper called"),o.logger.log(LogLevel.DEBUG,t),t.typename==="suggestion"?(o.logger.log(LogLevel.INFO,"Myna suggested "+t.choice),o.logger.log(LogLevel.DEBUG,"Response token is "+t.token),i=new Suggestion(o,t.choice,t.token),n(i),e?e(i):o.logger.log(LogLevel.WARN,"You should pass a success function to Experiment.suggest. See the docs for details.")):t.typename==="problem"?(o.logger.log(LogLevel.ERROR,"Experiment.suggest returned an API error: "+t.subtype+" "+t.messages),r(t)):(o.logger.log(LogLevel.ERROR,"Experiment.suggest did something unexpected"),o.logger.log(LogLevel.ERROR,t),r({typename:"problem",subtype:400,messages:[{typename:"unexpected",item:t}]}))},r=function(e){o.logger.log(LogLevel.ERROR,"Experiment.suggest errorWrapper called"),o.logger.log(LogLevel.ERROR,e),n(e);if(t)return t(e)},i={url:this.config.baseurl+("/v1/experiment/"+this.uuid+"/suggest"),data:{},success:s,error:r},JsonP.doJsonP(extend(i,this.config))},e.prototype.recall=function(){var e,t,n,r;return t=Cookie.read(this.config.cookieName),t?(n=t.indexOf(":"),n>=0?(r=t.substring(0,n),e=t.substring(n+1,t.length),new Suggestion(this,e,r)):void 0):void 0},e.prototype.forget=function(){return Cookie.erase(this.config.cookieName)},e.prototype.recallOrSuggest=function(e,t){var n;return t==null&&(t=this.config.error),n=this.recall(),n?e(n):this.suggest(e,t)},e}(),window.Myna.Experiment=Experiment;var Suggestion;Suggestion=function(){function e(e,t,n){this.experiment=e,this.choice=t,this.token=n}return e.prototype.reward=function(e,t,n){var r,i,s,o,u,a=this;return e==null&&(e=1),t==null&&(t=this.experiment.config.rewardSuccess),n==null&&(n=this.experiment.config.error),i=function(t){var n,r,i,s,o;s=Myna.onreward,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n(a,e,t));return o},r={token:this.token,amount:e},u=function(e){return i(e),t(e)},s=function(e){a.experiment.logger.log(LogLevel.ERROR,"Suggestion.reward errorWrapper called"),a.experiment.logger.log(LogLevel.ERROR,e),i(e);if(n)return n(e)},o={url:this.experiment.config.baseurl+("/v1/experiment/"+this.experiment.uuid+"/reward"),data:r,success:u,error:s},JsonP.doJsonP(extend(o,this.experiment.config))},e.prototype.remember=function(){return Cookie.create(this.experiment.config.cookieName,""+this.token+":"+this.choice,this.experiment.config.cookieLifespan)},e.prototype.rewardOnClick=function(e,t,n){var r,i,s=this;return n==null&&(n=1),i=function(){return window.location=t},r=function(e){return e||(e=window.event),e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),s.reward(n,i,i),!1},e.onclick=r},e}();var f,_i,_len,_ref,__slice=[].slice;extend(window.Myna,{onload:[],onsuggest:[],onreward:[]}),window.Myna.onload.push=function(){var e,t,n,r,i;e=1<=arguments.length?__slice.call(arguments,0):[],i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(t());return i},_ref=window.Myna.onload;for(_i=0,_len=_ref.length;_i<_len;_i++)f=_ref[_i],f();