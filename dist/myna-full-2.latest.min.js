(function(){var t,e,n=[].slice;null==(t=window.Myna)&&(window.Myna={}),Myna.debug=!0,Myna.trim=function(t){return String.prototype.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},Myna.extend=function(){var t,e,r,i,o,a,s;for(t=arguments[0],r=arguments.length>=2?n.call(arguments,1):[],a=0,s=r.length;s>a;a++){i=r[a];for(e in i)o=i[e],t[e]=o}return t},Myna.deleteKeys=function(){var t,e,r,i,o,a;for(i=arguments[0],r=arguments.length>=2?n.call(arguments,1):[],t=Myna.extend({},i),o=0,a=r.length;a>o;o++)e=r[o],delete t[e];return t},Myna.dateToString=function(t){var e,n,r,i,o,a,s,u,l;Myna.log("Myna.dateToString",t);try{return Date.prototype.toISOString?t.toISOString():(s=function(t,e){var n;for(n=""+t;e>n.length;)n="0"+n;return n},l=s(t.getUTCFullYear(),4),a=s(t.getUTCMonth()+1,2),e=s(t.getUTCDate(),2),r=s(t.getUTCHours(),2),o=s(t.getUTCMinutes(),2),u=s(t.getUTCSeconds(),2),i=s(t.getUTCMilliseconds(),2),""+l+"-"+a+"-"+e+"T"+r+":"+o+":"+u+"."+i+"Z")}catch(c){return n=c,null}},Myna.stringToDate=function(t){var e,n,r,i,o,a,s,u,l,c,h;Myna.log("Myna.stringToDate",t);try{return t instanceof Date?t:(h=t.match(/([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2}).([0-9]{3})Z/),c=h[0],l=h[1],a=h[2],e=h[3],r=h[4],o=h[5],u=h[6],i=h[7],l&&a&&e&&r&&o&&u&&i?(s=function(t){return"0"===t[0]?s(t.substring(1)):parseInt(t)},new Date(Date.UTC(s(l),s(a)-1,s(e),s(r),s(o),s(u),s(i)))):null)}catch(p){return n=p,Myna.log(n),null}},Myna.problem=function(t){return t},Myna.$=null!=(e=window.jQuery)?e:null}).call(this),function(){var t=[].slice,e=function(t,e){return function(){return t.apply(e,arguments)}};Myna.phantomJs=/PhantomJS/.test(navigator.userAgent),Myna.log=function(){var e,n,r;e=arguments.length>=1?t.call(arguments,0):[],Myna.debug&&(Myna.phantomJs?null!=(n=window.console)&&n.log(JSON.stringify(e)):null!=(r=window.console)&&r.log(e))},Myna.error=function(){var e;throw e=arguments.length>=1?t.call(arguments,0):[],Myna.phantomJs?JSON.stringify(e):e},Myna.Logging=function(){function n(){this.error=e(this.error,this),this.log=e(this.log,this)}return n.prototype.logEnabled=!0,n.prototype.log=function(){var e,n;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],this.logEnabled?Myna.log.apply(Myna,[""+this.constructor.name+"."+n].concat(t.call(e))):void 0},n.prototype.error=function(){var e,n;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],Myna.error.apply(Myna,[""+this.constructor.name+"."+n].concat(t.call(e)))},n}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i=[].slice;Myna.Events=function(n){function o(){return this.off=e(this.off,this),this.on=e(this.on,this),this.triggerAsync=e(this.triggerAsync,this),this.trigger=e(this.trigger,this),this.setCustom=e(this.setCustom,this),this.set=e(this.set,this),this.getCustom=e(this.getCustom,this),this.get=e(this.get,this),t=o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.directAttributes=[],o.prototype.get=function(t){return this.constructor.prototype.directAttributes.indexOf(t)>=0?this[t]:this.getCustom(t)},o.prototype.getCustom=function(t){return this.error("get","property not found: "+t)},o.prototype.set=function(t,e){var n,r,i,o,a=this;if(r=function(t,e){return a[t]=e,a.trigger("change:"+t,a,e)},i=function(t,e){return a.constructor.prototype.directAttributes.indexOf(t)>=0?(a[t]=e,a.trigger("change:"+t,a,e)):a.setCustom(t,e)},"object"==typeof t)for(n in t)o=t[n],i(n,o);else i(t,e);return this.trigger("change",this),this},o.prototype.setCustom=function(t){return this.error("set","property not found: "+t)},o.prototype.trigger=function(){var t,e,n,r,o,a,s,u,l;for(n=arguments[0],t=arguments.length>=2?i.call(arguments,1):[],this.log.apply(this,["trigger",n].concat(i.call(t))),this.eventHandlers||(this.eventHandlers={}),e=!1,l=null!=(s=null!=(u=this.eventHandlers)?u[n]:void 0)?s:[],o=0,a=l.length;a>o;o++)r=l[o],e=e||r.apply(this,t)===!1;return e?!1:void 0},o.prototype.triggerAsync=function(){var t,e,n,r,o,a,s,u=this;return n=arguments[0],t=arguments.length>=4?i.call(arguments,1,a=arguments.length-2):(a=1,[]),r=arguments[a++],e=arguments[a++],this.log.apply(this,["triggerAsync",n].concat(i.call(t))),this.eventHandlers||(this.eventHandlers={}),o=function(n){var a,s;return u.log("triggerAsync.triggerAll",n),0===n.length?r():(a=n[0],s=n.length>=2?i.call(n,1):[],a.call.apply(a,[u].concat(i.call(t),[function(){return o(s)}],[e])))},o(null!=(s=this.eventHandlers[n])?s:[])},o.prototype.on=function(t,e){var n,r,i,o,a,s;for(this.eventHandlers||(this.eventHandlers={}),a=t.split(/[ ]+/),i=0,o=a.length;o>i;i++)n=a[i],r=null!=(s=this.eventHandlers[n])?s:[],this.eventHandlers[n]=r.concat([e]),this.log("on",n,e,this.eventHandlers[n])},o.prototype.off=function(t,e){var n,r,i,o,a,s;if(this.eventHandlers||(this.eventHandlers={}),null!=t)for(s=t.split(/[ ]+/),o=0,a=s.length;a>o;o++){switch(n=s[o],arguments.length){case 1:delete this.eventHandlers[arguments[0]];break;default:n=arguments[0],e=arguments[1],(i=this.eventHandlers[n])&&(this.eventHandlers[n]=function(){var t,n,o;for(o=[],t=0,n=i.length;n>t;t++)r=i[t],r!==e&&o.push(r);return o}())}this.log("off",n,e,this.eventHandlers[n])}else this.eventHandlers={},this.log("off","all")},o}(Myna.Logging)}.call(this),function(){Myna.jsonp={callbacks:{},counter:0,request:function(t){var e,n,r,i,o,a,s,u,l,c,h,p,d,f,g,y,m,v,w;null==t&&(t={}),d=null!=(g=t.url)?g:Myna.error("Myna.jsonp.request","no url in options",t),l=null!=(y=t.success)?y:function(){},n=null!=(m=t.error)?m:function(){},c=null!=(v=t.timeout)?v:0,a=null!=(w=t.params)?w:{},e="callback"+Myna.jsonp.counter++,s=!1,p=""+d+"?";for(r in a)f=a[r],p+=""+r+"="+f+"&";p+="callback=Myna.jsonp.callbacks."+e,Myna.log("Myna.jsonp.request",p,l,n,c),u=document.createElement("script"),u.setAttribute("type","text/javascript"),u.setAttribute("async","true"),u.setAttribute("src",p),u.setAttribute("class","myna-jsonp"),u.setAttribute("data-callback",e),u.onload=u.onreadystatechange=function(){return Myna.jsonp.remove(e,u)},o=function(){return s?Myna.log("Myna.jsonp.request.onTimeout",e,c,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onTimeout",e,c),Myna.jsonp.remove(e,u),n({typename:"problem",subtype:500,messages:[{typename:"timeout",message:"request timed out after #{timeout}ms",callback:e}]}))},h=c>0?window.setTimeout(o,c):null,i=function(t){return s?Myna.log("Myna.jsonp.request.onComplete",e,"already returned"):(s=!0,Myna.log("Myna.jsonp.request.onComplete",e,t.typename,"problem"===t.typename,t),window.clearTimeout(h),Myna.jsonp.remove(e,u),"problem"===t.typename?n(t):l(t))},Myna.jsonp.callbacks[e]=i,document.getElementsByTagName("head")[0].appendChild(u)},remove:function(t,e){var n;if(null==t&&(t=null),null==e&&(e=null),n=null!=e?e.readyState:void 0,!n||"complete"===n||"loaded"===n)try{e&&(e.onload=null,e.parentNode.removeChild(e))}finally{t&&delete Myna.jsonp.callbacks[t]}}}}.call(this),function(){"use strict";var t,e,n,r,i,o,a=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l=[].slice;n=function(){function t(t){null==t&&(t=null),this.next=t}return t}(),r=function(t){function e(t){this.prefixes=a(this.prefixes,this),this.unset=a(this.unset,this),this.set=a(this.set,this),this.get=a(this.get,this),this.path=a(this.path,this),e.__super__.constructor.call(this,t)}return u(e,t),e.prototype.path=function(){return this.next.path().substring(1)},e.prototype.get=function(t){return this.next.get(t)},e.prototype.set=function(t,e){return null!=e?this.next.set(t,e):this.next.unset(t)},e.prototype.unset=function(t){return this.next.unset(t)},e.prototype.prefixes=function(){return this.next.prefixes()},e}(n),t=function(t){function e(t,n){this.prefixes=a(this.prefixes,this),this.unset=a(this.unset,this),this.set=a(this.set,this),this.get=a(this.get,this),this.path=a(this.path,this),e.__super__.constructor.call(this,t),this.name=n}return u(e,t),e.prototype.path=function(){return"."+this.name+this.next.path()},e.prototype.get=function(t){return this.next.get(null!=t?t[this.name]:void 0)},e.prototype.set=function(t,e){var n,r,i;n={};for(r in t)i=t[r],n[r]=i;return n[this.name]=this.next.set(n[this.name],e),n},e.prototype.unset=function(t){var e,n,r,i;e={};for(n in t)i=t[n],e[n]=i;return r=this.next.unset(e[this.name]),null!=this.next.unset(e[this.name])?e[this.name]=r:delete e[this.name],e},e.prototype.prefixes=function(){var t;return[this.name].concat(l.call(function(){var e,n,r,i;for(r=this.next.prefixes(),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(""+this.name+"."+t);return i}.call(this)))},e}(n),e=function(t){function e(){e.__super__.constructor.call(this,null)}return u(e,t),e.prototype.path=function(){return""},e.prototype.get=function(t){return t},e.prototype.set=function(t,e){return e},e.prototype.unset=function(){return void 0},e.prototype.prefixes=function(){return[]},e}(n),o=new e,i=function(){function n(t){null==t&&(t={}),this.toJson=a(this.toJson,this),this.unset=a(this.unset,this),this.set=a(this.set,this),this.get=a(this.get,this),this.data={},this.set(t)}return n.ast={Root:r,Field:t,Nil:e,nil:o},n.parse=function(e){var n,i,a,s;if(e=Myna.trim(e),n=o,""!==e)for(s=e.split("."),a=s.length-1;a>=0;a+=-1)i=s[a],n=new t(n,i);return new r(n)},n.prototype.get=function(t,e){var r;return null==e&&(e=null),null!=(r=n.parse(t).get(this.data))?r:e},n.prototype.set=function(){var t,e,r;switch(arguments.length){case 0:throw["Settings.set","not enough arguments",arguments];case 1:r=arguments[0];for(t in r)e=r[t],this.data=n.parse(t).set(this.data,e);break;default:t=arguments[0],e=arguments[1],this.data=n.parse(t).set(this.data,e)}return this},n.prototype.unset=function(t){return this.data=n.parse(t).unset(this.data),this},n.prototype.toJson=function(){return this.data},n}.call(this),Myna.Settings=i}.call(this),function(){var t,e,n,r,i,o,a,s,u,l;null==(l=Myna.cache)&&(Myna.cache={}),Myna.cache.localStorageSupported=function(){try{return localStorage.setItem("modernizer","modernizer"),localStorage.removeItem("modernizer"),!0}catch(t){return n=t,!1}}(),Myna.cache.localStorageEnabled=!0,i=function(t){var e;if(e=window.localStorage.getItem("myna-"+t),null==e)return null;try{return JSON.parse(e)}catch(r){return n=r,null}},u=function(t,e){null!=e?window.localStorage.setItem("myna-"+t,JSON.stringify(e)):window.localStorage.removeItem("myna-"+t)},a=function(t){window.localStorage.removeItem("myna-"+t)},e=function(t){return encodeURIComponent(JSON.stringify(t))},t=function(t){return 0===t.indexOf('"')?JSON.parse(t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")):JSON.parse(t),JSON.parse(decodeURIComponent(t.replace(/\+/g," ")))},s=function(t,n,r){var i,o,a,s;null==r&&(r=365),s="myna-"+t+"="+e(n),o=r?(i=new Date,i.setTime(i.getTime()+1e3*60*60*24*r),"; expires="+i.toGMTString()):"",a="; path=/",document.cookie=""+s+o+a},r=function(e){var n,r,i,o,a,s,u,l;for(a="myna-"+e+"=",o=function(t){var e;return e=t.indexOf(a),e>=0&&t.substring(0,e).match("^\\s*$")},r=function(t){var e;return e=t.indexOf(a),t.substring(e+a.length,t.length)},i=document.cookie.split(";"),u=0,l=i.length;l>u;u++)if(n=i[u],o(n)&&null!=(s=r(n)))return t(s);return null},o=function(t){s(t,"",-1)},Myna.cache.load=function(t){return Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?i(t):r(t)},Myna.cache.save=function(t,e){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?u(t,e):s(t,e)},Myna.cache.remove=function(t){Myna.cache.localStorageSupported&&Myna.cache.localStorageEnabled?a(t):o(t)}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.VariantSummary=function(e){function r(e){var n,r,i;null==e&&(e={}),this.setCustom=t(this.setCustom,this),this.getCustom=t(this.getCustom,this),this.id=null!=(n=e.id)?n:this.error("constructor","no id in options",e),this.weight=null!=(r=e.weight)?r:this.error("constructor","no weight in options",e),this.settings=new Myna.Settings(null!=(i=e.settings)?i:{})}return n(r,e),r.prototype.directAttributes=["id","weight"],r.prototype.getCustom=function(t){var e,n,i;return i=t.match(/^settings[.](.*)$/),n=i[0],e=i[1],i?this.settings.get(e):r.__super__.getCustom.call(this,t)},r.prototype.setCustom=function(t,e){var n,i,o,a,s;if(n=t.match(/^settings[.](.*)$/)){for(i=n[1],this.settings.set(i,e),s=this.settings.constructor.parse(i).prefixes(),a=s.length-1;a>=0;a+=-1)o=s[a],this.trigger("change:settings."+o,this,this.settings.get(o));return this.trigger("change:settings",this,this.settings.data)}return r.__super__.setCustom.call(this,t,e)},r}(Myna.Events)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Myna.ExperimentBase=function(e){function i(e){var n,r,o,a,s,u,l,c;for(null==e&&(e={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearVariant=t(this.clearVariant,this),this.saveVariant=t(this.saveVariant,this),this.loadVariant=t(this.loadVariant,this),this.clearLastReward=t(this.clearLastReward,this),this.saveLastReward=t(this.saveLastReward,this),this.loadLastReward=t(this.loadLastReward,this),this.clearLastView=t(this.clearLastView,this),this.saveLastView=t(this.saveLastView,this),this.loadLastView=t(this.loadLastView,this),this.setCustom=t(this.setCustom,this),this.getCustom=t(this.getCustom,this),this.createVariant=t(this.createVariant,this),this.randomVariant=t(this.randomVariant,this),this.totalWeight=t(this.totalWeight,this),this.saveVariantFromReward=t(this.saveVariantFromReward,this),this.rewardVariant=t(this.rewardVariant,this),this.loadVariantsForReward=t(this.loadVariantsForReward,this),this.reward=t(this.reward,this),this.saveVariantFromView=t(this.saveVariantFromView,this),this.viewVariant=t(this.viewVariant,this),this.loadVariantsForView=t(this.loadVariantsForView,this),this.view=t(this.view,this),this.loadVariantsForSuggest=t(this.loadVariantsForSuggest,this),this.suggest=t(this.suggest,this),i.__super__.constructor.call(this,e),this.log("constructor",e),this.id=null!=(a=e.id)?a:this.error("constructor",this.id,"no id in options",e),this.uuid=null!=(s=e.uuid)?s:void 0,this.settings=new Myna.Settings(null!=(u=e.settings)?u:{}),this.variants={},c=null!=(l=e.variants)?l:[],r=0,o=c.length;o>r;r++)n=c[r],this.variants[n.id]=this.createVariant(n)}return n(i,e),i.prototype.directAttributes=["uuid","id"],i.prototype.suggest=function(t,e){var n,r,i;null==t&&(t=function(){}),null==e&&(e=function(){}),n=this.loadVariantsForSuggest(),this.log("suggest",this.id,null!=(r=n.variant)?r.id:void 0,null!=(i=n.viewed)?i.id:void 0),this.viewVariant(Myna.extend({success:t,error:e},n))},i.prototype.loadVariantsForSuggest=function(){return{variant:this.randomVariant(),viewed:this.loadLastView()}},i.prototype.view=function(t,e,n){var r,i,o;null==e&&(e=function(){}),null==n&&(n=function(){}),r=this.loadVariantsForView(t),this.log("view",this.id,null!=(i=r.variant)?i.id:void 0,null!=(o=r.viewed)?o.id:void 0),this.viewVariant(Myna.extend({success:e,error:n},r))},i.prototype.loadVariantsForView=function(t){return{variant:t instanceof Myna.VariantSummary?t:this.variants[t],viewed:null}},i.prototype.viewVariant=function(t){var e,n,r,i,o,a;r=t.variant,i=t.viewed,n=null!=(o=t.success)?o:function(){},e=null!=(a=t.error)?a:function(){},this.log("viewVariant",this.id,null!=r?r.id:void 0,null!=i?i.id:void 0),null!=i?this.trigger("beforeView",i,!1)!==!1&&(n.call(this,i,!1),this.trigger("view",i,!1)):null!=r?this.trigger("beforeView",r,!0)!==!1&&(this.saveVariantFromView(r),n.call(this,r,!0),this.trigger("view",r,!0),this.trigger("recordView",r)):e(Myna.problem("no-variant"))},i.prototype.saveVariantFromView=function(t){return this.saveLastView(t),this.clearLastReward()},i.prototype.reward=function(t,e,n){var r,i,o;null==t&&(t=1),null==e&&(e=function(){}),null==n&&(n=function(){}),r=this.loadVariantsForReward(),this.log("reward",this.id,null!=(i=r.variant)?i.id:void 0,null!=(o=r.rewarded)?o.id:void 0,t),this.rewardVariant(Myna.extend({amount:t,success:e,error:n},r))},i.prototype.loadVariantsForReward=function(){return{variant:this.loadLastView(),rewarded:this.loadLastReward()}},i.prototype.rewardVariant=function(t){var e,n,i,o,a,s,u,l,c=this;null==t&&(t={}),this.log("rewardVariant",this.id,t),a=t.variant,i=t.rewarded,e=null!=(s=t.amount)?s:1,o=null!=(u=t.success)?u:function(){},n=null!=(l=t.error)?l:function(){},null!=i?this.trigger("beforeReward",i,e,!1)!==!1&&(o.call(this,i,e,!1),this.trigger("reward",i,e,!1)):null!=a?this.trigger("beforeReward",a,e,!0)!==!1&&this.triggerAsync("recordReward",a,e,function(){return c.saveVariantFromReward(a),o.call(c,a,e,!0),c.trigger("reward",a,e,!0)},function(){var t;return t=arguments.length>=1?r.call(arguments,0):[],n.call.apply(n,[c].concat(r.call(t)))}):n(Myna.problem("no-variant"))},i.prototype.saveVariantFromReward=function(t){return this.clearLastView(),this.saveLastReward(t)},i.prototype.totalWeight=function(){var t,e,n,r;t=0,r=this.variants;for(e in r)n=r[e],t+=n.weight;return t},i.prototype.randomVariant=function(){var t,e,n,r,i;n=this.totalWeight(),e=Math.random()*n,i=this.variants;for(t in i)if(r=i[t],n-=r.weight,e>=n)return this.log("randomVariant",this.id,r.id),r;return this.log("randomVariant",this.id,null),null},i.prototype.createVariant=function(t){return new Myna.VariantSummary(t)},i.prototype.getCustom=function(t){var e,n,r;return r=t.match(/^settings[.](.*)$/),n=r[0],e=r[1],r?this.settings.get(e):i.__super__.getCustom.call(this,t)},i.prototype.setCustom=function(t,e){var n,r,o,a,s;if(n=t.match(/^settings[.](.*)$/)){for(r=n[1],this.settings.set(r,e),s=this.settings.constructor.parse(r).prefixes(),a=s.length-1;a>=0;a+=-1)o=s[a],this.trigger("change:settings."+o,this,this.settings.get(o));return this.trigger("change:settings",this,this.settings.data)}return i.__super__.setCustom.call(this,t,e)},i.prototype.loadLastView=function(){return this.loadVariant("lastView")},i.prototype.saveLastView=function(t){return this.saveVariant("lastView",t),this.clearVariant("lastReward")},i.prototype.clearLastView=function(){return this.clearVariant("lastView")},i.prototype.loadLastReward=function(){return this.loadVariant("lastReward")},i.prototype.saveLastReward=function(t){return this.saveVariant("lastReward",t)},i.prototype.clearLastReward=function(){return this.clearVariant("lastReward")},i.prototype.loadVariant=function(t){var e,n;return e=null!=(n=this.load())?n[t]:void 0,this.log("loadVariant",this.id,t,e),null!=e?this.variants[e]:null},i.prototype.saveVariant=function(t,e){var n=this;return this.loadAndSave(function(r){return n.log("saveVariant",n.id,t,e,r),null!=e?r[t]=e.id:delete r[t],r})},i.prototype.clearVariant=function(t){return this.saveVariant(t,null)},i.prototype.loadAndSave=function(t){var e;return this.save(t(null!=(e=this.load())?e:{}))},i.prototype.load=function(){return Myna.cache.load(this.uuid)},i.prototype.save=function(t){return Myna.cache.save(this.uuid,t)},i}(Myna.Events)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Myna.ExperimentSummary=function(n){function i(){return this.clearStickyReward=e(this.clearStickyReward,this),this.saveStickyReward=e(this.saveStickyReward,this),this.loadStickyReward=e(this.loadStickyReward,this),this.clearStickySuggestion=e(this.clearStickySuggestion,this),this.saveStickySuggestion=e(this.saveStickySuggestion,this),this.loadStickySuggestion=e(this.loadStickySuggestion,this),this.unstick=e(this.unstick,this),this.saveVariantFromReward=e(this.saveVariantFromReward,this),this.loadVariantsForReward=e(this.loadVariantsForReward,this),this.saveVariantFromView=e(this.saveVariantFromView,this),this.loadVariantsForView=e(this.loadVariantsForView,this),this.loadVariantsForSuggest=e(this.loadVariantsForSuggest,this),this.sticky=e(this.sticky,this),t=i.__super__.constructor.apply(this,arguments)}return r(i,n),i.prototype.sticky=function(){return!!this.settings.get("myna.js.sticky",!0)},i.prototype.loadVariantsForSuggest=function(){var t;return this.sticky()?(t=this.loadStickySuggestion(),{variant:null!=t?t:this.randomVariant(),viewed:t}):i.__super__.loadVariantsForSuggest.call(this)},i.prototype.loadVariantsForView=function(t){return i.__super__.loadVariantsForView.call(this,t)},i.prototype.saveVariantFromView=function(t){return this.sticky()&&this.saveStickySuggestion(t),i.__super__.saveVariantFromView.call(this,t)},i.prototype.loadVariantsForReward=function(){return this.sticky()?{variant:this.loadLastView(),rewarded:this.loadStickyReward()}:i.__super__.loadVariantsForReward.call(this)},i.prototype.saveVariantFromReward=function(t){return this.sticky()&&this.saveStickyReward(t),i.__super__.saveVariantFromReward.call(this,t)},i.prototype.unstick=function(){return this.log("unstick",this.id),this.clearLastView(),this.clearLastReward(),this.clearStickySuggestion(),this.clearStickyReward()},i.prototype.loadStickySuggestion=function(){return this.loadVariant("stickySuggestion")},i.prototype.saveStickySuggestion=function(t){return this.saveVariant("stickySuggestion",t),this.clearVariant("stickyReward")},i.prototype.clearStickySuggestion=function(){return this.clearVariant("stickySuggestion"),this.clearVariant("stickyReward")},i.prototype.loadStickyReward=function(){return this.loadVariant("stickyReward")},i.prototype.saveStickyReward=function(t){return this.saveVariant("stickyReward",t)},i.prototype.clearStickyReward=function(){return this.clearVariant("stickyReward")},i}(Myna.ExperimentBase)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Myna.Recorder=function(e){function i(e){var n,r,o,a,s;null==e&&(e={}),this.save=t(this.save,this),this.load=t(this.load,this),this.loadAndSave=t(this.loadAndSave,this),this.clearQueuedEvents=t(this.clearQueuedEvents,this),this.requeueEvents=t(this.requeueEvents,this),this.queueEvent=t(this.queueEvent,this),this.queuedEvents=t(this.queuedEvents,this),this.sync=t(this.sync,this),this.recordReward=t(this.recordReward,this),this.recordView=t(this.recordView,this),this.listenTo=t(this.listenTo,this),i.__super__.constructor.call(this,e),this.log("constructor",e),this.apiKey=null!=(n=e.apiKey)?n:Myna.error("Myna.Recorder.constructor","no apiKey in options",e),this.apiRoot=null!=(r=e.apiRoot)?r:"//api.mynaweb.com",this.storageKey=null!=(o=e.storageKey)?o:"myna",this.timeout=null!=(a=e.timeout)?a:1e3,this.autoSync=null!=(s=e.autoSync)?s:!0,this.semaphore=0,this.waiting=[]}return n(i,e),i.prototype.listenTo=function(t){var e=this;return this.log("listenTo",t.id),t.on("recordView",function(n,r,i){return e.recordView(t,n,r,i)}),t.on("recordReward",function(n,r,i,o){return e.recordReward(t,n,r,i,o)})},i.prototype.recordView=function(t,e,n,r){return null==n&&(n=function(){}),null==r&&(r=function(){}),this.log("recordView",t.id,e.id),null!=t.uuid?(this.queueEvent({typename:"view",experiment:t.uuid,variant:e.id,timestamp:Myna.dateToString(new Date)}),this.log("recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(n,r):n()):void 0},i.prototype.recordReward=function(t,e,n,r,i){return null==r&&(r=function(){}),null==i&&(i=function(){}),this.log("recordReward",t.id,e.id,n),null!=t.uuid?(this.queueEvent({typename:"reward",experiment:t.uuid,variant:e.id,amount:n,timestamp:Myna.dateToString(new Date)}),this.log("recordReward","aboutToSync",this.autoSync),this.autoSync?this.sync(r,i):r()):void 0},i.prototype.sync=function(t,e){var n,i,o,a,s,u=this;return null==t&&(t=function(){}),null==e&&(e=function(){}),this.waiting.push({success:t,error:e}),this.semaphore>0?this.log("sync","queued"):(this.semaphore++,s=this.waiting,this.waiting=[],i=function(){var t;return t=u.clearQueuedEvents(),u.log("sync.start",t,s.length),u.trigger("beforeSync",t)===!1?u.requeueEvents(t):o(t,[],[])},o=function(t,e,i){var o,s;return u.log("sync.syncAll",t,e,i),0===t.length?n(e,i):(o=t[0],s=t.length>=2?r.call(t,1):[],a(o,s,e,i))},a=function(t,e,n,r){var i;return u.log("sync.syncOne",t,e,n,r),i=Myna.deleteKeys(t,"experiment"),Myna.jsonp.request({url:""+u.apiRoot+"/v2/experiment/"+t.experiment+"/record",success:function(){return o(e,n.concat([t]),r)},error:function(){return o(e,n,r.concat([t]))},timeout:u.timeout,params:Myna.extend({},i,{apikey:u.apiKey})})},n=function(t,e){var n,r,i,o,a;if(u.log("sync.finish",t,e),e.length>0)for(u.requeueEvents(e),r=0,o=s.length;o>r;r++)n=s[r],n.error(t,e);else for(i=0,a=s.length;a>i;i++)n=s[i],n.success(t,e);return u.trigger("afterSync",t,e),u.semaphore--,u.waiting.length>0?u.sync():void 0},i())},i.prototype.queuedEvents=function(){var t,e;return t=null!=(e=this.load().queuedEvents)?e:[],this.log("queuedEvents",t),t},i.prototype.queueEvent=function(t){return this.log("queueEvent",t),this.loadAndSave(function(e){var n;return e.queuedEvents=(null!=(n=e.queuedEvents)?n:[]).concat([t]),e})},i.prototype.requeueEvents=function(t){return this.log("requeueEvents",t),this.loadAndSave(function(e){var n;return e.queuedEvents=t.concat(null!=(n=e.queuedEvents)?n:[]),e})},i.prototype.clearQueuedEvents=function(){var t;return this.log("clearQueuedEvents"),t=[],this.loadAndSave(function(e){var n;return t=null!=(n=e.queuedEvents)?n:[],delete e.queuedEvents,e}),t},i.prototype.loadAndSave=function(t){var e;return this.save(t(null!=(e=this.load())?e:{}))},i.prototype.load=function(){return Myna.cache.load(this.storageKey)},i.prototype.save=function(t){return Myna.cache.save(this.storageKey,t)},i}(Myna.Events)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Client=function(e){function r(e){var n,r,i,o,a,s;for(null==e&&(e={}),this.reward=t(this.reward,this),this.view=t(this.view,this),this.suggest=t(this.suggest,this),this.log("constructor",e),this.experiments={},s=null!=(a=e.experiments)?a:[],i=0,o=s.length;o>i;i++)n=s[i],r=n instanceof Myna.ExperimentBase?n:new Myna.ExperimentSummary(n),this.experiments[r.id]=r}return n(r,e),r.prototype.suggest=function(t,e,n){return null==e&&(e=function(){}),null==n&&(n=function(){}),this.experiments[t].suggest(e,n)},r.prototype.view=function(t,e,n,r){return null==n&&(n=function(){}),null==r&&(r=function(){}),this.experiments[t].view(e,n,r)},r.prototype.reward=function(t,e,n,r){return null==e&&(e=1),null==n&&(n=function(){}),null==r&&(r=function(){}),this.experiments[t].reward(e,n,r)},r}(Myna.Logging)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Variant=function(e){function r(e){var n,i,o;null==e&&(e={}),this.toJSON=t(this.toJSON,this),this.averageReward=t(this.averageReward,this),r.__super__.constructor.call(this,e),this.name=null!=(n=e.name)?n:void 0,this.views=null!=(i=e.views)?i:void 0,this.totalReward=null!=(o=e.totalReward)?o:void 0}return n(r,e),r.prototype.directAttributes=["id","name","views","totalReward","weight"],r.prototype.averageReward=function(){return null!=this.views&&null!=this.totalReward?0===this.views?1:this.totalReward/this.views:void 0},r.prototype.toJSON=function(){var t;return t=Myna.extend({"":null},this.settings.data),{typename:"variant",id:this.id,name:this.name,views:this.views,totalReward:this.totalReward,weight:this.weight,settings:t}},r}(Myna.VariantSummary)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Myna.Experiment=function(e){function r(e){var n,i,o;null==e&&(e={}),this.toJSON=t(this.toJSON,this),r.__super__.constructor.call(this,e),this.accountId=null!=(n=e.accountId)?n:void 0,this.name=null!=(i=e.name)?i:void 0,this.visibility=null!=(o=e.visibility)?o:"draft",this.created=null!=e.created?Myna.stringToDate(e.created):new Date}return n(r,e),r.prototype.directAttributes=["uuid","id","accountId","name","visibility","created"],r.prototype.createVariant=function(t){return new Myna.Variant(t)},r.prototype.toJSON=function(){var t,e,n,r,i;e=Myna.extend({"":null},this.settings.data),r={},i=this.variants;for(t in i)n=i[t],r[t]=n.toJSON();return{typename:"experiment",uuid:this.uuid,id:this.id,accountId:this.accountId,name:this.name,visibility:this.visibility,created:this.created?Myna.dateToString(this.created):null,settings:e,variants:r}},r}(Myna.ExperimentSummary)}.call(this);